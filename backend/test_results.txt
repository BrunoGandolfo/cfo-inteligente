============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- /home/brunogandolfo/cfo-inteligente/backend/venv/bin/python3
cachedir: .pytest_cache
rootdir: /home/brunogandolfo/cfo-inteligente/backend
configfile: pytest.ini
plugins: asyncio-1.2.0, timeout-2.4.0, cov-7.0.0, mock-3.15.1, anyio-4.10.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 560 items

tests/test_ai_components.py::test_parse_insights_json_directo PASSED     [  0%]
tests/test_ai_components.py::test_parse_insights_json_markdown PASSED    [  0%]
tests/test_ai_components.py::test_parse_insights_texto_plano PASSED      [  0%]
tests/test_ai_components.py::test_parse_insights_response_vacia PASSED   [  0%]
tests/test_ai_components.py::test_validate_insights_valid PASSED         [  0%]
tests/test_ai_components.py::test_validate_insights_required_keys PASSED [  1%]
tests/test_ai_components.py::test_validate_insights_invalid PASSED       [  1%]
tests/test_ai_components.py::test_fallback_operativo_genera_insights PASSED [  1%]
tests/test_ai_components.py::test_fallback_operativo_menciona_numeros PASSED [  1%]
tests/test_ai_components.py::test_fallback_estrategico_genera_insights FAILED [  1%]
tests/test_ai_components.py::test_fallback_estrategico_identifica_disparidad FAILED [  1%]
tests/test_ai_orchestrator.py::TestAIOrchestatorInit::test_init_con_claude_disponible PASSED [  2%]
tests/test_ai_orchestrator.py::TestAIOrchestatorInit::test_init_con_openai_disponible PASSED [  2%]
tests/test_ai_orchestrator.py::TestAIOrchestatorInit::test_init_con_gemini_disponible PASSED [  2%]
tests/test_ai_orchestrator.py::TestAIOrchestatorInit::test_init_sin_proveedores_disponibles PASSED [  2%]
tests/test_ai_orchestrator.py::TestAIOrchestatorInit::test_init_con_todos_proveedores PASSED [  2%]
tests/test_ai_orchestrator.py::TestAIOrchestatorHelpers::test_get_available_providers_retorna_lista PASSED [  3%]
tests/test_ai_orchestrator.py::TestAIOrchestatorHelpers::test_is_available_true_con_al_menos_uno PASSED [  3%]
tests/test_ai_orchestrator.py::TestAIOrchestatorHelpers::test_is_available_false_sin_proveedores PASSED [  3%]
tests/test_ai_orchestrator.py::TestAIOrchestatorComplete::test_complete_usa_claude_primero PASSED [  3%]
tests/test_ai_orchestrator.py::TestAIOrchestatorComplete::test_complete_con_system_prompt PASSED [  3%]
tests/test_ai_orchestrator.py::TestAIOrchestatorComplete::test_complete_respeta_max_tokens PASSED [  3%]
tests/test_ai_orchestrator.py::TestAIOrchestatorComplete::test_complete_respeta_temperature PASSED [  4%]
tests/test_ai_orchestrator.py::TestAIOrchestatorFallback::test_complete_fallback_a_openai_si_claude_falla PASSED [  4%]
tests/test_ai_orchestrator.py::TestAIOrchestatorFallback::test_complete_fallback_a_gemini_si_openai_falla PASSED [  4%]
tests/test_ai_orchestrator.py::TestAIOrchestatorFallback::test_complete_retorna_none_si_todos_fallan PASSED [  4%]
tests/test_ai_orchestrator.py::TestAIOrchestatorFallback::test_complete_sin_proveedores_retorna_none PASSED [  4%]
tests/test_ai_orchestrator.py::TestAIOrchestatorErrors::test_claude_timeout_dispara_fallback PASSED [  5%]
tests/test_ai_orchestrator.py::TestAIOrchestatorErrors::test_claude_rate_limit_dispara_fallback PASSED [  5%]
tests/test_ai_orchestrator.py::TestAIOrchestatorErrors::test_respuesta_vacia_de_claude_intenta_siguiente PASSED [  5%]
tests/test_ai_orchestrator.py::TestAIOrchestatorErrors::test_api_key_invalida_no_crashea PASSED [  5%]
tests/test_ai_orchestrator.py::TestAIOrchestatorOpenAI::test_openai_recibe_system_prompt_correcto PASSED [  5%]
tests/test_ai_orchestrator.py::TestAIOrchestatorGemini::test_gemini_combina_system_y_user_prompt PASSED [  5%]
tests/test_ai_orchestrator.py::TestAIOrchestatorGemini::test_gemini_sin_system_prompt PASSED [  6%]
tests/test_ai_orchestrator.py::TestAIOrchestatorModels::test_claude_usa_modelo_correcto PASSED [  6%]
tests/test_ai_orchestrator.py::TestAIOrchestatorModels::test_openai_usa_modelo_correcto PASSED [  6%]
tests/test_ai_orchestrator.py::TestAIOrchestatorModels::test_gemini_usa_modelo_correcto PASSED [  6%]
tests/test_ai_orchestrator.py::TestAIOrchestatorModels::test_default_timeout_es_30_segundos PASSED [  6%]
tests/test_auth_endpoints.py::TestLogin::test_login_exitoso_retorna_token PASSED [  6%]
tests/test_auth_endpoints.py::TestLogin::test_login_email_incorrecto_retorna_401 PASSED [  7%]
tests/test_auth_endpoints.py::TestLogin::test_login_password_incorrecto_retorna_401 PASSED [  7%]
tests/test_auth_endpoints.py::TestLogin::test_login_usuario_inactivo_retorna_403 PASSED [  7%]
tests/test_auth_endpoints.py::TestLogin::test_login_socio_retorna_es_socio_true PASSED [  7%]
tests/test_auth_endpoints.py::TestRegister::test_register_exitoso_crea_usuario FAILED [  7%]
tests/test_auth_endpoints.py::TestRegister::test_register_email_duplicado_retorna_400 FAILED [  8%]
tests/test_auth_endpoints.py::TestRegister::test_register_asigna_rol_socio_si_email_autorizado FAILED [  8%]
tests/test_auth_endpoints.py::TestRegister::test_register_asigna_rol_colaborador_si_email_no_autorizado FAILED [  8%]
tests/test_auth_endpoints.py::TestRegister::test_register_password_se_hashea FAILED [  8%]
tests/test_auth_endpoints.py::TestRegister::test_register_usuario_activo_por_defecto FAILED [  8%]
tests/test_auth_endpoints.py::TestAuthValidation::test_login_sin_email_retorna_422 PASSED [  8%]
tests/test_auth_endpoints.py::TestAuthValidation::test_login_sin_password_retorna_422 PASSED [  9%]
tests/test_auth_endpoints.py::TestAuthValidation::test_register_email_invalido_retorna_422 FAILED [  9%]
tests/test_auth_endpoints.py::TestAuthValidation::test_register_sin_nombre_retorna_422 FAILED [  9%]
tests/test_auth_endpoints.py::TestSociosAutorizados::test_todos_los_socios_autorizados_son_socios[aborio] FAILED [  9%]
tests/test_auth_endpoints.py::TestSociosAutorizados::test_todos_los_socios_autorizados_son_socios[falgorta] FAILED [  9%]
tests/test_auth_endpoints.py::TestSociosAutorizados::test_todos_los_socios_autorizados_son_socios[vcaresani] FAILED [ 10%]
tests/test_auth_endpoints.py::TestSociosAutorizados::test_todos_los_socios_autorizados_son_socios[gtaborda] FAILED [ 10%]
tests/test_auth_endpoints.py::TestSociosAutorizados::test_prefijo_case_insensitive FAILED [ 10%]
tests/test_calculators.py::test_totals_calculator_ingresos PASSED        [ 10%]
tests/test_calculators.py::test_totals_calculator_gastos PASSED          [ 10%]
tests/test_calculators.py::test_totals_calculator_metric_names PASSED    [ 10%]
tests/test_calculators.py::test_results_calculator_utilidad_neta PASSED  [ 11%]
tests/test_calculators.py::test_results_calculator_metric_names PASSED   [ 11%]
tests/test_calculators.py::test_ratios_calculator_rentabilidad_neta PASSED [ 11%]
tests/test_calculators.py::test_ratios_calculator_division_por_cero PASSED [ 11%]
tests/test_calculators.py::test_distribution_calculator_por_area PASSED  [ 11%]
tests/test_calculators.py::test_distribution_calculator_metric_names PASSED [ 11%]
tests/test_calculators.py::test_efficiency_calculator_ticket_promedio PASSED [ 12%]
tests/test_calculators.py::test_efficiency_calculator_cantidad_operaciones PASSED [ 12%]
tests/test_calculators.py::test_efficiency_calculator_division_por_cero PASSED [ 12%]
tests/test_calculators.py::test_trends_calculator_variacion_mom PASSED   [ 12%]
tests/test_calculators.py::test_trends_calculator_sin_comparacion PASSED [ 12%]
tests/test_calculators.py::test_trends_calculator_proyeccion PASSED      [ 13%]
tests/test_charts.py::test_bar_chart_validate_data_valid PASSED          [ 13%]
tests/test_charts.py::test_bar_chart_validate_data_invalid PASSED        [ 13%]
tests/test_charts.py::test_line_chart_validate_data_valid PASSED         [ 13%]
tests/test_charts.py::test_line_chart_validate_mismatched_lengths PASSED [ 13%]
tests/test_charts.py::test_pie_chart_validate_data_valid PASSED          [ 13%]
tests/test_charts.py::test_pie_chart_negative_values PASSED              [ 14%]
tests/test_charts.py::test_waterfall_chart_validate_data PASSED          [ 14%]
tests/test_charts.py::test_waterfall_chart_invalid_measure PASSED        [ 14%]
tests/test_charts.py::test_donut_chart_validate_data PASSED              [ 14%]
tests/test_charts.py::test_combo_chart_validate_data PASSED              [ 14%]
tests/test_charts.py::test_heatmap_chart_validate_data PASSED            [ 15%]
tests/test_charts.py::test_heatmap_chart_invalid_dimensions PASSED       [ 15%]
tests/test_charts.py::test_chart_factory_create_bar PASSED               [ 15%]
tests/test_charts.py::test_chart_factory_create_invalid_type PASSED      [ 15%]
tests/test_charts.py::test_chart_factory_get_available_types PASSED      [ 15%]
tests/test_claude_sql_generator.py::TestInicializacion::test_init_con_api_key_valida FAILED [ 15%]
tests/test_claude_sql_generator.py::TestInicializacion::test_init_sin_api_key FAILED [ 16%]
tests/test_claude_sql_generator.py::TestInicializacion::test_ddl_context_presente PASSED [ 16%]
tests/test_claude_sql_generator.py::TestInicializacion::test_business_context_con_8_reglas FAILED [ 16%]
tests/test_claude_sql_generator.py::TestGenerarSQL::test_generar_sql_exitoso PASSED [ 16%]
tests/test_claude_sql_generator.py::TestGenerarSQL::test_generar_sql_con_backticks PASSED [ 16%]
tests/test_claude_sql_generator.py::TestGenerarSQL::test_generar_sql_error_api FAILED [ 16%]
tests/test_claude_sql_generator.py::TestGenerarSQL::test_generar_sql_timeout FAILED [ 17%]
tests/test_claude_sql_generator.py::TestGenerarSQL::test_generar_sql_rate_limit FAILED [ 17%]
tests/test_claude_sql_generator.py::TestGenerarSQL::test_generar_sql_parametros_correctos FAILED [ 17%]
tests/test_claude_sql_generator.py::TestContextoYPrompt::test_prompt_incluye_ddl FAILED [ 17%]
tests/test_claude_sql_generator.py::TestContextoYPrompt::test_prompt_incluye_business_context FAILED [ 17%]
tests/test_claude_sql_generator.py::TestContextoYPrompt::test_prompt_incluye_pregunta_usuario FAILED [ 18%]
tests/test_claude_sql_generator.py::TestReglasNegocio::test_regla_contexto_temporal_2025 PASSED [ 18%]
tests/test_claude_sql_generator.py::TestReglasNegocio::test_regla_moneda_original_para_porcentajes PASSED [ 18%]
tests/test_claude_sql_generator.py::TestReglasNegocio::test_regla_filtros_temporales_default PASSED [ 18%]
tests/test_claude_sql_generator.py::TestReglasNegocio::test_regla_conversiones_moneda PASSED [ 18%]
tests/test_claude_sql_generator.py::TestTiposSQLGenerados::test_sql_simple_select PASSED [ 18%]
tests/test_claude_sql_generator.py::TestTiposSQLGenerados::test_sql_con_cte PASSED [ 19%]
tests/test_claude_sql_generator.py::TestTiposSQLGenerados::test_sql_con_joins PASSED [ 19%]
tests/test_claude_sql_generator.py::TestManejoErrores::test_api_connection_error FAILED [ 19%]
tests/test_claude_sql_generator.py::TestManejoErrores::test_authentication_error FAILED [ 19%]
tests/test_claude_sql_generator.py::TestManejoErrores::test_respuesta_vacia PASSED [ 19%]
tests/test_claude_sql_generator.py::TestManejoErrores::test_respuesta_sin_content FAILED [ 20%]
tests/test_claude_sql_generator.py::TestLimpiezaSQL::test_limpieza_backticks_sql PASSED [ 20%]
tests/test_claude_sql_generator.py::TestLimpiezaSQL::test_limpieza_backticks_genericos PASSED [ 20%]
tests/test_claude_sql_generator.py::TestLimpiezaSQL::test_sql_sin_backticks_no_modifica PASSED [ 20%]
tests/test_claude_sql_generator.py::TestCasosEdge::test_pregunta_con_caracteres_especiales PASSED [ 20%]
tests/test_claude_sql_generator.py::TestCasosEdge::test_pregunta_muy_larga PASSED [ 20%]
tests/test_claude_sql_generator.py::TestCasosEdge::test_sql_multilinea_con_espacios PASSED [ 21%]
tests/test_conversacion_service.py::TestCrearConversacion::test_crear_conversacion_nueva PASSED [ 21%]
tests/test_conversacion_service.py::TestCrearConversacion::test_crear_conversacion_con_titulo PASSED [ 21%]
tests/test_conversacion_service.py::TestCrearConversacion::test_crear_conversacion_titulo_default PASSED [ 21%]
tests/test_conversacion_service.py::TestCrearConversacion::test_crear_conversacion_asocia_usuario PASSED [ 21%]
tests/test_conversacion_service.py::TestObtenerConversaciones::test_obtener_conversacion_por_id PASSED [ 21%]
tests/test_conversacion_service.py::TestObtenerConversaciones::test_obtener_conversacion_inexistente PASSED [ 22%]
tests/test_conversacion_service.py::TestObtenerConversaciones::test_obtener_conversacion_usuario_incorrecto PASSED [ 22%]
tests/test_conversacion_service.py::TestObtenerConversaciones::test_listar_conversaciones_usuario PASSED [ 22%]
tests/test_conversacion_service.py::TestObtenerConversaciones::test_listar_conversaciones_vacio PASSED [ 22%]
tests/test_conversacion_service.py::TestObtenerConversaciones::test_listar_conversaciones_respeta_limite PASSED [ 22%]
tests/test_conversacion_service.py::TestAgregarMensaje::test_agregar_mensaje_usuario PASSED [ 23%]
tests/test_conversacion_service.py::TestAgregarMensaje::test_agregar_mensaje_asistente PASSED [ 23%]
tests/test_conversacion_service.py::TestAgregarMensaje::test_agregar_mensaje_con_sql_generado PASSED [ 23%]
tests/test_conversacion_service.py::TestAgregarMensaje::test_agregar_mensaje_actualiza_timestamp_conversacion PASSED [ 23%]
tests/test_conversacion_service.py::TestObtenerContexto::test_obtener_contexto_formatea_mensajes PASSED [ 23%]
tests/test_conversacion_service.py::TestObtenerContexto::test_obtener_contexto_vacio PASSED [ 23%]
tests/test_conversacion_service.py::TestObtenerContexto::test_obtener_contexto_respeta_limite PASSED [ 24%]
tests/test_conversacion_service.py::TestGenerarTitulo::test_generar_titulo_pregunta_corta PASSED [ 24%]
tests/test_conversacion_service.py::TestGenerarTitulo::test_generar_titulo_pregunta_larga_se_trunca PASSED [ 24%]
tests/test_conversacion_service.py::TestGenerarTitulo::test_generar_titulo_exactamente_50_chars PASSED [ 24%]
tests/test_conversacion_service.py::TestGenerarTitulo::test_generar_titulo_strip_espacios PASSED [ 24%]
tests/test_conversacion_service.py::TestConversacionServiceIntegration::test_flujo_completo_crear_y_agregar_mensajes PASSED [ 25%]
tests/test_date_resolver.py::test_resolve_period_mes_actual PASSED       [ 25%]
tests/test_date_resolver.py::test_resolve_period_mes_anterior PASSED     [ 25%]
tests/test_date_resolver.py::test_resolve_period_trimestre_actual PASSED [ 25%]
tests/test_date_resolver.py::test_resolve_period_custom PASSED           [ 25%]
tests/test_date_resolver.py::test_resolve_period_custom_sin_fechas PASSED [ 25%]
tests/test_date_resolver.py::test_get_comparison_period_anterior PASSED  [ 26%]
tests/test_date_resolver.py::test_get_comparison_period_año_pasado PASSED [ 26%]
tests/test_date_resolver.py::test_get_period_label_mes_completo PASSED   [ 26%]
tests/test_date_resolver.py::test_get_period_label_trimestre PASSED      [ 26%]
tests/test_date_resolver.py::test_get_period_label_año PASSED            [ 26%]
tests/test_e2e.py::test_pregunta_real_e2e[\xbfCu\xe1nto facturamos este mes?] ERROR [ 26%]
tests/test_e2e.py::test_pregunta_real_e2e[\xbfC\xf3mo viene la rentabilidad?] ERROR [ 27%]
tests/test_e2e.py::test_pregunta_real_e2e[\xbfCu\xe1l es el margen de este mes?] ERROR [ 27%]
tests/test_e2e.py::test_pregunta_real_e2e[\xbfEstamos mejor que el mes pasado?] ERROR [ 27%]
tests/test_e2e.py::test_pregunta_real_e2e[\xbfC\xf3mo vamos en el a\xf1o?] ERROR [ 27%]
tests/test_e2e.py::test_pregunta_real_e2e[\xbfCu\xe1nto ganamos este trimestre?] ERROR [ 27%]
tests/test_e2e.py::test_pregunta_real_e2e[\xbfCu\xe1l es la rentabilidad del \xe1rea Jur\xeddi] ERROR [ 28%]
tests/test_e2e.py::test_pregunta_real_e2e[\xbfQu\xe9 \xe1rea es m\xe1s rentable?] ERROR [ 28%]
tests/test_e2e.py::test_pregunta_real_e2e[\xbfC\xf3mo est\xe1 la rentabilidad de Notarial?] ERROR [ 28%]
tests/test_e2e.py::test_pregunta_real_e2e[Dame un resumen del mes] ERROR [ 28%]
tests/test_e2e.py::test_pregunta_real_e2e[\xbfCu\xe1l fue el mejor mes del a\xf1o?] ERROR [ 28%]
tests/test_e2e.py::test_pregunta_real_e2e[\xbfVenimos mejorando la rentabilidad?] ERROR [ 28%]
tests/test_e2e.py::test_pregunta_real_e2e[\xbfCu\xe1nto es el resultado operativo?] ERROR [ 29%]
tests/test_e2e.py::test_pregunta_real_e2e[\xbfC\xf3mo viene el margen comparado con el a] ERROR [ 29%]
tests/test_e2e.py::test_pregunta_real_e2e[\xbfProyectamos bien el cierre de a\xf1o?] ERROR [ 29%]
tests/test_e2e.py::test_pregunta_real_e2e[\xbfCu\xe1nto le toca a Bruno este a\xf1o?] ERROR [ 29%]
tests/test_e2e.py::test_pregunta_real_e2e[\xbfCu\xe1nto recibi\xf3 Agustina en distribucion] ERROR [ 29%]
tests/test_e2e.py::test_pregunta_real_e2e[\xbfQu\xe9 socio retir\xf3 m\xe1s plata?] ERROR [ 30%]
tests/test_e2e.py::test_pregunta_real_e2e[\xbfCu\xe1ndo fue la \xfaltima distribuci\xf3n?] ERROR [ 30%]
tests/test_e2e.py::test_pregunta_real_e2e[\xbfCu\xe1nto se distribuy\xf3 este trimestre?] ERROR [ 30%]
tests/test_e2e.py::test_pregunta_real_e2e[\xbfEst\xe1n bien los porcentajes de cada soci] ERROR [ 30%]
tests/test_e2e.py::test_pregunta_real_e2e[\xbfCu\xe1nto llev\xf3 Viviana en el a\xf1o?] ERROR [ 30%]
tests/test_e2e.py::test_pregunta_real_e2e[\xbfQu\xe9 socio tiene m\xe1s retiros?] ERROR [ 30%]
tests/test_e2e.py::test_pregunta_real_e2e[\xbfCu\xe1nto se reparti\xf3 en total?] ERROR [ 31%]
tests/test_e2e.py::test_pregunta_real_e2e[\xbfGonzalo est\xe1 recibiendo lo que correspo] ERROR [ 31%]
tests/test_e2e.py::test_pregunta_real_e2e[\xbfFacturamos m\xe1s este mes que el anterior] ERROR [ 31%]
tests/test_e2e.py::test_pregunta_real_e2e[\xbfC\xf3mo se compara este trimestre con el p] ERROR [ 31%]
tests/test_e2e.py::test_pregunta_real_e2e[\xbfEstamos creciendo o bajando?] ERROR [ 31%]
tests/test_e2e.py::test_pregunta_real_e2e[\xbfQu\xe9 trimestre fue mejor?] ERROR [ 31%]
tests/test_e2e.py::test_pregunta_real_e2e[\xbfC\xf3mo va octubre comparado con septiembr] ERROR [ 32%]
tests/test_e2e.py::test_pregunta_real_e2e[\xbfMejoramos respecto al a\xf1o pasado?] ERROR [ 32%]
tests/test_e2e.py::test_pregunta_real_e2e[\xbfCu\xe1l fue el peor mes?] ERROR [ 32%]
tests/test_e2e.py::test_pregunta_real_e2e[\xbfLa tendencia es positiva o negativa?] ERROR [ 32%]
tests/test_e2e.py::test_pregunta_real_e2e[\xbfEstamos en alza o en baja?] ERROR [ 32%]
tests/test_e2e.py::test_pregunta_real_e2e[\xbfC\xf3mo viene la facturaci\xf3n mes a mes?] ERROR [ 33%]
tests/test_e2e.py::test_pregunta_real_e2e[\xbfCu\xe1nto facturamos en d\xf3lares este mes?] ERROR [ 33%]
tests/test_e2e.py::test_pregunta_real_e2e[\xbfCu\xe1nto gastamos en pesos?] ERROR [ 33%]
tests/test_e2e.py::test_pregunta_real_e2e[\xbfQu\xe9 porcentaje de facturaci\xf3n es en USD] ERROR [ 33%]
tests/test_e2e.py::test_pregunta_real_e2e[\xbfCu\xe1nto se distribuy\xf3 en d\xf3lares?] ERROR [ 33%]
tests/test_e2e.py::test_pregunta_real_e2e[\xbfOperamos m\xe1s en pesos o d\xf3lares?] ERROR [ 33%]
tests/test_e2e.py::test_pregunta_real_e2e[\xbfCu\xe1l es el tipo de cambio promedio que ] ERROR [ 34%]
tests/test_e2e.py::test_pregunta_real_e2e[\xbfQu\xe9 \xe1rea factura m\xe1s en d\xf3lares?] ERROR [ 34%]
tests/test_e2e.py::test_pregunta_real_e2e[\xbfCu\xe1nto es todo en d\xf3lares?] ERROR [ 34%]
tests/test_e2e.py::test_pregunta_real_e2e[\xbfQu\xe9 \xe1rea genera m\xe1s ingresos?] ERROR [ 34%]
tests/test_e2e.py::test_pregunta_real_e2e[\xbfCu\xe1nto factura Montevideo vs Mercedes?] ERROR [ 34%]
tests/test_e2e.py::test_pregunta_real_e2e[\xbfQu\xe9 oficina es m\xe1s rentable?] ERROR [ 35%]
tests/test_e2e.py::test_pregunta_real_e2e[\xbfC\xf3mo est\xe1 Mercedes este mes?] ERROR [ 35%]
tests/test_e2e.py::test_pregunta_real_e2e[\xbfCu\xe1nto gast\xf3 Contable?] ERROR [ 35%]
tests/test_e2e.py::test_pregunta_real_e2e[\xbfQu\xe9 \xe1rea tiene m\xe1s gastos?] ERROR [ 35%]
tests/test_e2e.py::test_pregunta_real_e2e[\xbfCu\xe1l es la facturaci\xf3n de cada \xe1rea?] ERROR [ 35%]
tests/test_e2e.py::TestCasosErrorGraves::test_error_distribuciones_bruno_complejo XFAIL [ 35%]
tests/test_e2e.py::TestCasosErrorGraves::test_error_porcentaje_usd_uyu_invertido XFAIL [ 36%]
tests/test_e2e.py::TestCasosErrorGraves::test_error_proyeccion_hardcodeada XFAIL [ 36%]
tests/test_e2e.py::TestCasosErrorGraves::test_error_ranking_limit_1 XFAIL [ 36%]
tests/test_e2e.py::TestCasosErrorGraves::test_error_afirmacion_unicidad XFAIL [ 36%]
tests/test_e2e.py::TestCasosErrorGraves::test_error_union_all_enum XFAIL [ 36%]
tests/test_e2e.py::TestCasosErrorGraves::test_error_meses_restantes XFAIL [ 36%]
tests/test_e2e.py::TestCasosErrorGraves::test_error_porcentajes_no_suman_100 XPASS [ 37%]
tests/test_e2e.py::TestCasosErrorGraves::test_error_distribucion_excesiva XPASS [ 37%]
tests/test_e2e.py::TestCasosErrorGraves::test_error_facturacion_mes_mayor_anual XPASS [ 37%]
tests/test_e2e.py::TestCasosErrorGraves::test_error_comparacion_años XFAIL [ 37%]
tests/test_e2e.py::TestMetricasPrecision::test_tasa_respuesta_exitosa ERROR [ 37%]
tests/test_e2e.py::TestMetricasPrecision::test_metadata_presente_en_exitosas ERROR [ 38%]
tests/test_e2e.py::TestMetricasPrecision::test_tiempo_respuesta_razonable ERROR [ 38%]
tests/test_e2e.py::test_resumen_suite_e2e PASSED                         [ 38%]
tests/test_formatters.py::test_format_currency_normal PASSED             [ 38%]
tests/test_formatters.py::test_format_currency_short_millions PASSED     [ 38%]
tests/test_formatters.py::test_format_currency_short_thousands PASSED    [ 38%]
tests/test_formatters.py::test_format_currency_short_small PASSED        [ 39%]
tests/test_formatters.py::test_format_currency_without_symbol PASSED     [ 39%]
tests/test_formatters.py::test_format_percentage_default PASSED          [ 39%]
tests/test_formatters.py::test_format_percentage_decimals PASSED         [ 39%]
tests/test_formatters.py::test_format_percentage_negative PASSED         [ 39%]
tests/test_formatters.py::test_format_percentage_without_symbol PASSED   [ 40%]
tests/test_formatters.py::test_format_date_es_completo PASSED            [ 40%]
tests/test_formatters.py::test_format_date_es_corto PASSED               [ 40%]
tests/test_formatters.py::test_format_date_es_mes_anio PASSED            [ 40%]
tests/test_formatters.py::test_format_variacion_positiva PASSED          [ 40%]
tests/test_formatters.py::test_format_variacion_negativa PASSED          [ 40%]
tests/test_formatters.py::test_format_variacion_puntos PASSED            [ 41%]
tests/test_formatters.py::test_format_variacion_division_por_cero PASSED [ 41%]
tests/test_formatters.py::test_format_number_default PASSED              [ 41%]
tests/test_formatters.py::test_format_number_decimals PASSED             [ 41%]
tests/test_integration.py::TestChainOfThoughtIntegration::test_obtener_metadatos_temporales FAILED [ 41%]
tests/test_integration.py::TestChainOfThoughtIntegration::test_formatear_metadatos PASSED [ 41%]
tests/test_integration.py::TestChainOfThoughtIntegration::test_generar_con_cot_completo FAILED [ 42%]
tests/test_integration.py::TestEndpointCFOAsk::test_endpoint_pregunta_simple FAILED [ 42%]
tests/test_integration.py::TestEndpointCFOAsk::test_endpoint_pregunta_compleja FAILED [ 42%]
tests/test_integration.py::TestEndpointCFOAsk::test_endpoint_sql_invalido FAILED [ 42%]
tests/test_integration.py::TestEndpointCFOAsk::test_endpoint_formato_response FAILED [ 42%]
tests/test_integration.py::TestSQLRouterIntegration::test_sql_ejecutable_en_bd FAILED [ 43%]
tests/test_integration.py::TestSQLRouterIntegration::test_sql_rentabilidad_ejecutable FAILED [ 43%]
tests/test_integration.py::TestValidadorConDatosReales::test_validar_rentabilidad_real FAILED [ 43%]
tests/test_integration.py::TestValidadorConDatosReales::test_validar_distribuciones_reales FAILED [ 43%]
tests/test_integration.py::TestFlujoCompletoEndToEnd::test_flujo_completo_pregunta_facturacion FAILED [ 43%]
tests/test_integration.py::TestFlujoCompletoEndToEnd::test_flujo_con_validacion_pre_sql FAILED [ 43%]
tests/test_integration.py::TestFlujoCompletoEndToEnd::test_flujo_con_chain_of_thought FAILED [ 44%]
tests/test_integration.py::TestQueriesReales::test_query_conteo_operaciones FAILED [ 44%]
tests/test_integration.py::TestQueriesReales::test_query_sum_ingresos FAILED [ 44%]
tests/test_integration.py::TestQueriesReales::test_query_distribuciones_por_socio FAILED [ 44%]
tests/test_integration.py::TestValidacionCasosReales::test_detectar_tipo_query_con_sql_real PASSED [ 44%]
tests/test_integration.py::TestValidacionCasosReales::test_validacion_pre_sql_con_sql_real PASSED [ 45%]
tests/test_integration.py::TestChainOfThoughtAvanzado::test_proyeccion_fin_año_con_metadatos FAILED [ 45%]
tests/test_integration.py::TestChainOfThoughtAvanzado::test_comparacion_mes_vs_mes FAILED [ 45%]
tests/test_integration.py::TestChainOfThoughtAvanzado::test_tendencia_ultimos_3_meses FAILED [ 45%]
tests/test_integration.py::TestChainOfThoughtAvanzado::test_conversion_moneda_multiple FAILED [ 45%]
tests/test_integration.py::TestChainOfThoughtAvanzado::test_deteccion_keywords_temporales PASSED [ 45%]
tests/test_integration.py::TestChainOfThoughtAvanzado::test_metadatos_fecha_actual_correcta FAILED [ 46%]
tests/test_integration.py::TestChainOfThoughtAvanzado::test_meses_con_datos_dinamico FAILED [ 46%]
tests/test_integration.py::TestChainOfThoughtAvanzado::test_ultimo_mes_con_datos FAILED [ 46%]
tests/test_integration.py::TestValidadorPostSQLReal::test_porcentaje_usd_uyu_real FAILED [ 46%]
tests/test_integration.py::TestValidadorPostSQLReal::test_distribucion_por_socio_real FAILED [ 46%]
tests/test_integration.py::TestValidadorPostSQLReal::test_ranking_limit_1_deteccion PASSED [ 46%]
tests/test_integration.py::TestValidadorPostSQLReal::test_validacion_no_rechaza_sql_correcto PASSED [ 47%]
tests/test_integration.py::TestCasosCriticos::test_caso_retiros_por_socio FAILED [ 47%]
tests/test_integration.py::TestCasosCriticos::test_caso_comparacion_año_anterior FAILED [ 47%]
tests/test_integration.py::TestCasosCriticos::test_caso_gonzalo_recibe_correcto FAILED [ 47%]
tests/test_integration.py::TestCasosCriticos::test_caso_estamos_creciendo FAILED [ 47%]
tests/test_integration_real.py::TestAuthIntegration::test_registro_y_login_flujo_completo FAILED [ 48%]
tests/test_integration_real.py::TestAuthIntegration::test_usuario_registrado_puede_hacer_login PASSED [ 48%]
tests/test_integration_real.py::TestAuthIntegration::test_token_permite_acceso_a_endpoints_protegidos PASSED [ 48%]
tests/test_integration_real.py::TestAuthIntegration::test_registro_socio_autorizado FAILED [ 48%]
tests/test_integration_real.py::TestAuthIntegration::test_registro_colaborador FAILED [ 48%]
tests/test_integration_real.py::TestOperacionesIntegration::test_crear_ingreso_completo ERROR [ 48%]
tests/test_integration_real.py::TestOperacionesIntegration::test_crear_gasto_completo ERROR [ 49%]
tests/test_integration_real.py::TestOperacionesIntegration::test_crear_retiro_completo ERROR [ 49%]
tests/test_integration_real.py::TestOperacionesIntegration::test_operacion_calcula_monto_usd_correctamente ERROR [ 49%]
tests/test_integration_real.py::TestOperacionesIntegration::test_listar_operaciones_con_filtros ERROR [ 49%]
tests/test_integration_real.py::TestConversacionIntegration::test_crear_conversacion_y_agregar_mensajes PASSED [ 49%]
tests/test_integration_real.py::TestConversacionIntegration::test_obtener_contexto_conversacion PASSED [ 50%]
tests/test_integration_real.py::TestConversacionIntegration::test_listar_conversaciones_usuario PASSED [ 50%]
tests/test_integration_real.py::TestCFOAIIntegration::test_pregunta_simple_retorna_respuesta ERROR [ 50%]
tests/test_integration_real.py::TestCFOAIIntegration::test_pregunta_genera_sql_valido ERROR [ 50%]
tests/test_integration_real.py::TestCFOAIIntegration::test_contexto_conversacion_se_mantiene PASSED [ 50%]
tests/test_integration_real.py::TestDatosConsistencia::test_soft_delete_operacion ERROR [ 50%]
tests/test_integration_real.py::TestDatosConsistencia::test_relacion_operacion_area ERROR [ 51%]
tests/test_metrics_aggregator.py::test_aggregator_calcula_todas_metricas FAILED [ 51%]
tests/test_metrics_aggregator.py::test_aggregator_totals_correctos FAILED [ 51%]
tests/test_metrics_aggregator.py::test_aggregator_margen_correcto FAILED [ 51%]
tests/test_metrics_aggregator.py::test_aggregator_area_lider FAILED      [ 51%]
tests/test_metrics_aggregator.py::test_aggregator_con_comparacion FAILED [ 51%]
tests/test_monthly_aggregator.py::TestMonthlyAggregator::test_get_period_type PASSED [ 52%]
tests/test_monthly_aggregator.py::TestMonthlyAggregator::test_validate_period_correcto PASSED [ 52%]
tests/test_monthly_aggregator.py::TestMonthlyAggregator::test_validate_period_dia_incorrecto PASSED [ 52%]
tests/test_monthly_aggregator.py::TestMonthlyAggregator::test_validate_period_end_incorrecto PASSED [ 52%]
tests/test_monthly_aggregator.py::TestMonthlyAggregator::test_aggregate_octubre_2025 FAILED [ 52%]
tests/test_monthly_aggregator.py::TestMonthlyAggregator::test_aggregate_con_filtro_localidad FAILED [ 53%]
tests/test_monthly_aggregator.py::TestMonthlyAggregator::test_metricas_por_area_ordenadas FAILED [ 53%]
tests/test_operacion_service.py::TestCalcularMontos::test_calcular_montos_uyu_to_usd PASSED [ 53%]
tests/test_operacion_service.py::TestCalcularMontos::test_calcular_montos_usd_to_uyu PASSED [ 53%]
tests/test_operacion_service.py::TestCalcularMontos::test_calcular_montos_precision_decimal PASSED [ 53%]
tests/test_operacion_service.py::TestCalcularMontos::test_calcular_montos_tc_alto PASSED [ 53%]
tests/test_operacion_service.py::TestCalcularMontos::test_calcular_montos_tc_bajo PASSED [ 54%]
tests/test_operacion_service.py::TestCalcularMontos::test_calcular_montos_valores_pequenos PASSED [ 54%]
tests/test_operacion_service.py::TestCrearOperacionBase::test_crear_operacion_base_ingreso ERROR [ 54%]
tests/test_operacion_service.py::TestCrearOperacionBase::test_crear_operacion_base_gasto ERROR [ 54%]
tests/test_operacion_service.py::TestCrearOperacionBase::test_crear_operacion_base_localidad_normalizada ERROR [ 54%]
tests/test_operacion_service.py::TestCrearIngreso::test_crear_ingreso_uyu ERROR [ 55%]
tests/test_operacion_service.py::TestCrearIngreso::test_crear_ingreso_usd ERROR [ 55%]
tests/test_operacion_service.py::TestCrearGasto::test_crear_gasto_uyu ERROR [ 55%]
tests/test_operacion_service.py::TestCrearGasto::test_crear_gasto_usd ERROR [ 55%]
tests/test_operacion_service.py::TestCrearRetiro::test_crear_retiro_solo_uyu FAILED [ 55%]
tests/test_operacion_service.py::TestCrearRetiro::test_crear_retiro_solo_usd FAILED [ 55%]
tests/test_operacion_service.py::TestCrearRetiro::test_crear_retiro_ambas_monedas FAILED [ 56%]
tests/test_operacion_service.py::TestCrearRetiro::test_crear_retiro_no_requiere_area FAILED [ 56%]
tests/test_operacion_service.py::TestCrearDistribucion::test_crear_distribucion_5_socios_completa ERROR [ 56%]
tests/test_operacion_service.py::TestCrearDistribucion::test_crear_distribucion_parcial_3_socios ERROR [ 56%]
tests/test_operacion_service.py::TestCrearDistribucion::test_crear_distribucion_detecta_moneda_original ERROR [ 56%]
tests/test_operacion_service.py::TestCrearDistribucion::test_crear_distribucion_no_requiere_area ERROR [ 56%]
tests/test_operacion_service.py::TestCrearDistribucion::test_crear_distribucion_porcentaje_20 ERROR [ 57%]
tests/test_operacion_service.py::TestCasosEdge::test_calcular_montos_monto_cero PASSED [ 57%]
tests/test_operacion_service.py::TestCasosEdge::test_calcular_montos_tipo_cambio_alto PASSED [ 57%]
tests/test_operacion_service.py::TestCasosEdge::test_crear_ingreso_sin_cliente ERROR [ 57%]
tests/test_operacion_service.py::TestConversionTipoCambioAutomatico::test_crear_operacion_con_tipo_cambio_variable PASSED [ 57%]
tests/test_operacion_service.py::TestConversionTipoCambioAutomatico::test_conversion_precision_4_decimales PASSED [ 58%]
tests/test_operacion_service.py::TestDistribucionValidaciones::test_distribucion_suma_correcta_5_socios PASSED [ 58%]
tests/test_operacion_service.py::TestDistribucionValidaciones::test_distribucion_parcial_calcula_totales PASSED [ 58%]
tests/test_operacion_service.py::TestFiltrosPorLocalidadArea::test_crear_operaciones_diferentes_localidades ERROR [ 58%]
tests/test_operacion_service.py::TestFiltrosPorLocalidadArea::test_filtrar_operaciones_por_area FAILED [ 58%]
tests/test_operacion_service.py::TestCalculoTotalesPorSocio::test_porcentaje_distribucion_20_por_socio PASSED [ 58%]
tests/test_query_fallback.py::TestRentabilidad::test_rentabilidad_este_mes PASSED [ 59%]
tests/test_query_fallback.py::TestRentabilidad::test_rentabilidad_del_mes PASSED [ 59%]
tests/test_query_fallback.py::TestRentabilidad::test_rentabilidad_por_area PASSED [ 59%]
tests/test_query_fallback.py::TestRentabilidad::test_rentabilidad_por_localidad PASSED [ 59%]
tests/test_query_fallback.py::TestComparacionesGeograficas::test_mercedes_vs_montevideo PASSED [ 59%]
tests/test_query_fallback.py::TestComparacionesGeograficas::test_comparar_mercedes_alternativo PASSED [ 60%]
tests/test_query_fallback.py::TestComparacionesGeograficas::test_comparacion_mercedes_montevideo PASSED [ 60%]
tests/test_query_fallback.py::TestPreguntasGenerales::test_como_venimos PASSED [ 60%]
tests/test_query_fallback.py::TestPreguntasGenerales::test_como_vamos PASSED [ 60%]
tests/test_query_fallback.py::TestPreguntasGenerales::test_cuantas_operaciones PASSED [ 60%]
tests/test_query_fallback.py::TestCapitalFlujo::test_capital_de_trabajo PASSED [ 60%]
tests/test_query_fallback.py::TestCapitalFlujo::test_capital_trabajo_variante PASSED [ 61%]
tests/test_query_fallback.py::TestCapitalFlujo::test_flujo_de_caja PASSED [ 61%]
tests/test_query_fallback.py::TestCapitalFlujo::test_flujo_caja_variante PASSED [ 61%]
tests/test_query_fallback.py::TestTendencias::test_analisis_tendencias PASSED [ 61%]
tests/test_query_fallback.py::TestTendencias::test_tendencias_simple PASSED [ 61%]
tests/test_query_fallback.py::TestCasosEdge::test_pregunta_sin_match_retorna_none PASSED [ 61%]
tests/test_query_fallback.py::TestCasosEdge::test_pregunta_vacia PASSED  [ 62%]
tests/test_query_fallback.py::TestCasosEdge::test_pregunta_solo_espacios PASSED [ 62%]
tests/test_query_fallback.py::TestCasosEdge::test_case_insensitive PASSED [ 62%]
tests/test_query_fallback.py::TestCasosEdge::test_con_tildes_y_sin_tildes PASSED [ 62%]
tests/test_query_fallback.py::TestEstructuraSQL::test_sql_incluye_deleted_at_filter PASSED [ 62%]
tests/test_query_fallback.py::TestEstructuraSQL::test_sql_rentabilidad_tiene_nullif PASSED [ 63%]
tests/test_query_fallback.py::TestEstructuraSQL::test_sql_tiene_periodo_actual PASSED [ 63%]
tests/test_query_fallback.py::TestEstructuraSQL::test_sql_tendencias_tiene_orden PASSED [ 63%]
tests/test_security.py::TestHashPassword::test_hash_password_retorna_string PASSED [ 63%]
tests/test_security.py::TestHashPassword::test_hash_password_diferente_al_original PASSED [ 63%]
tests/test_security.py::TestHashPassword::test_hash_password_dos_hashes_diferentes PASSED [ 63%]
tests/test_security.py::TestHashPassword::test_hash_password_empieza_con_bcrypt_prefix PASSED [ 64%]
tests/test_security.py::TestHashPassword::test_hash_password_longitud_correcta PASSED [ 64%]
tests/test_security.py::TestVerifyPassword::test_verify_password_correcto_retorna_true PASSED [ 64%]
tests/test_security.py::TestVerifyPassword::test_verify_password_incorrecto_retorna_false PASSED [ 64%]
tests/test_security.py::TestVerifyPassword::test_verify_password_con_hash_invalido PASSED [ 64%]
tests/test_security.py::TestVerifyPassword::test_verify_password_case_sensitive PASSED [ 65%]
tests/test_security.py::TestVerifyPassword::test_verify_password_con_espacios PASSED [ 65%]
tests/test_security.py::TestCreateAccessToken::test_create_access_token_retorna_string PASSED [ 65%]
tests/test_security.py::TestCreateAccessToken::test_create_access_token_es_jwt_valido PASSED [ 65%]
tests/test_security.py::TestCreateAccessToken::test_create_access_token_contiene_datos PASSED [ 65%]
tests/test_security.py::TestCreateAccessToken::test_create_access_token_contiene_exp PASSED [ 65%]
tests/test_security.py::TestCreateAccessToken::test_create_access_token_expiracion_correcta FAILED [ 66%]
tests/test_security.py::TestCreateAccessToken::test_create_access_token_no_modifica_data_original PASSED [ 66%]
tests/test_security.py::TestSecurityIntegration::test_flujo_completo_hash_verify PASSED [ 66%]
tests/test_security.py::TestSecurityIntegration::test_hash_verify_con_unicode PASSED [ 66%]
tests/test_sql_post_processor.py::TestDetectarMoneda::test_detecta_usd_con_dolar PASSED [ 66%]
tests/test_sql_post_processor.py::TestDetectarMoneda::test_detecta_usd_con_dollar PASSED [ 66%]
tests/test_sql_post_processor.py::TestDetectarMoneda::test_detecta_usd_literal PASSED [ 67%]
tests/test_sql_post_processor.py::TestDetectarMoneda::test_detecta_uyu_con_peso PASSED [ 67%]
tests/test_sql_post_processor.py::TestDetectarMoneda::test_detecta_uyu_literal PASSED [ 67%]
tests/test_sql_post_processor.py::TestDetectarMoneda::test_default_es_uyu PASSED [ 67%]
tests/test_sql_post_processor.py::TestDetectarMoneda::test_case_insensitive PASSED [ 67%]
tests/test_sql_post_processor.py::TestConvertirAUsd::test_convierte_monto_uyu_a_monto_usd PASSED [ 68%]
tests/test_sql_post_processor.py::TestConvertirAUsd::test_convierte_multiple_referencias PASSED [ 68%]
tests/test_sql_post_processor.py::TestConvertirAUsd::test_convierte_mayusculas PASSED [ 68%]
tests/test_sql_post_processor.py::TestConvertirAUsd::test_no_modifica_sql_sin_monto_uyu PASSED [ 68%]
tests/test_sql_post_processor.py::TestConvertirAUsd::test_maneja_sql_vacio PASSED [ 68%]
tests/test_sql_post_processor.py::TestConvertirAUsd::test_sql_sin_select_retorna_igual PASSED [ 68%]
tests/test_sql_post_processor.py::TestExtraerSQLDeTexto::test_extrae_de_bloque_sql PASSED [ 69%]
tests/test_sql_post_processor.py::TestExtraerSQLDeTexto::test_extrae_de_bloque_generico PASSED [ 69%]
tests/test_sql_post_processor.py::TestExtraerSQLDeTexto::test_extrae_sql_sin_bloques PASSED [ 69%]
tests/test_sql_post_processor.py::TestExtraerSQLDeTexto::test_extrae_with_cte PASSED [ 69%]
tests/test_sql_post_processor.py::TestExtraerSQLDeTexto::test_retorna_none_sin_sql PASSED [ 69%]
tests/test_sql_post_processor.py::TestExtraerSQLDeTexto::test_maneja_texto_vacio PASSED [ 70%]
tests/test_sql_post_processor.py::TestProcesarSQL::test_proceso_completo_sin_cambios PASSED [ 70%]
tests/test_sql_post_processor.py::TestProcesarSQL::test_proceso_convierte_a_usd PASSED [ 70%]
tests/test_sql_post_processor.py::TestProcesarSQL::test_proceso_extrae_y_convierte PASSED [ 70%]
tests/test_sql_post_processor.py::TestProcesarSQL::test_proceso_retorna_cambios_realizados PASSED [ 70%]
tests/test_sql_post_processor.py::TestProcesarSQL::test_proceso_no_modifica_si_ya_usd PASSED [ 70%]
tests/test_sql_post_processor.py::TestProcesarSQL::test_proceso_estructura_resultado PASSED [ 71%]
tests/test_sql_post_processor.py::TestCasosEdge::test_sql_con_alias_monto_uyu PASSED [ 71%]
tests/test_sql_post_processor.py::TestCasosEdge::test_pregunta_con_ambas_monedas_prioriza_usd PASSED [ 71%]
tests/test_sql_post_processor.py::TestCasosEdge::test_sql_multilinea PASSED [ 71%]
tests/test_sql_post_processor.py::TestCasosEdge::test_extraccion_limpia_explicaciones PASSED [ 71%]
tests/test_sql_router.py::TestExtraerSQLLimpio::test_sql_limpio_sin_backticks PASSED [ 71%]
tests/test_sql_router.py::TestExtraerSQLLimpio::test_sql_con_backticks_sql PASSED [ 72%]
tests/test_sql_router.py::TestExtraerSQLLimpio::test_sql_con_backticks_genericos PASSED [ 72%]
tests/test_sql_router.py::TestExtraerSQLLimpio::test_sql_con_texto_explicativo PASSED [ 72%]
tests/test_sql_router.py::TestExtraerSQLLimpio::test_sql_con_punto_y_coma PASSED [ 72%]
tests/test_sql_router.py::TestExtraerSQLLimpio::test_texto_sin_sql PASSED [ 72%]
tests/test_sql_router.py::TestExtraerSQLLimpio::test_texto_vacio PASSED  [ 73%]
tests/test_sql_router.py::TestValidarSQL::test_sql_select_valido PASSED  [ 73%]
tests/test_sql_router.py::TestValidarSQL::test_sql_with_valido PASSED    [ 73%]
tests/test_sql_router.py::TestValidarSQL::test_sql_vacio PASSED          [ 73%]
tests/test_sql_router.py::TestValidarSQL::test_sql_sin_select PASSED     [ 73%]
tests/test_sql_router.py::TestValidarSQL::test_sql_malformado PASSED     [ 73%]
tests/test_sql_router.py::TestGenerarSQLConClaude::test_claude_exitoso PASSED [ 74%]
tests/test_sql_router.py::TestGenerarSQLConClaude::test_claude_respuesta_vacia PASSED [ 74%]
tests/test_sql_router.py::TestGenerarSQLConClaude::test_claude_excepcion PASSED [ 74%]
tests/test_sql_router.py::TestGenerarSQLConClaude::test_claude_sql_invalido PASSED [ 74%]
tests/test_sql_router.py::TestGenerarSQLConClaude::test_claude_sql_con_backticks PASSED [ 74%]
tests/test_sql_router.py::TestGenerarSQLConVanna::test_vanna_exitoso PASSED [ 75%]
tests/test_sql_router.py::TestGenerarSQLConVanna::test_vanna_texto_explicativo PASSED [ 75%]
tests/test_sql_router.py::TestGenerarSQLConVanna::test_vanna_excepcion PASSED [ 75%]
tests/test_sql_router.py::TestGenerarSQLConVanna::test_vanna_respuesta_vacia PASSED [ 75%]
tests/test_sql_router.py::TestGenerarSQLInteligente::test_claude_exitoso_sin_fallback PASSED [ 75%]
tests/test_sql_router.py::TestGenerarSQLInteligente::test_claude_falla_vanna_exitoso PASSED [ 75%]
tests/test_sql_router.py::TestGenerarSQLInteligente::test_ambos_metodos_fallan PASSED [ 76%]
tests/test_sql_router.py::TestGenerarSQLInteligente::test_reintentos_vanna PASSED [ 76%]
tests/test_sql_router.py::TestGenerarSQLInteligente::test_tiempos_medidos PASSED [ 76%]
tests/test_sql_router.py::TestGenerarSQLInteligente::test_metadata_debug PASSED [ 76%]
tests/test_sql_router.py::TestGenerarSQLInteligente::test_sql_invalido_no_extrae PASSED [ 76%]
tests/test_sql_router.py::TestFuncionesGlobales::test_get_sql_router_singleton PASSED [ 76%]
tests/test_sql_router.py::TestFuncionesGlobales::test_generar_sql_inteligente_wrapper FAILED [ 77%]
tests/test_sql_router.py::TestCasosEdge::test_pregunta_vacia PASSED      [ 77%]
tests/test_sql_router.py::TestCasosEdge::test_pregunta_muy_larga PASSED  [ 77%]
tests/test_sql_router.py::TestCasosEdge::test_sql_con_comentarios PASSED [ 77%]
tests/test_sql_router.py::TestCasosEdge::test_sql_multilinea PASSED      [ 77%]
tests/test_sql_router.py::TestPerformance::test_tiempo_respuesta_razonable PASSED [ 78%]
tests/test_sql_router.py::TestPerformance::test_reintentos_no_infinitos PASSED [ 78%]
tests/test_stats_calculator.py::test_linear_regression_basic PASSED      [ 78%]
tests/test_stats_calculator.py::test_linear_regression_r_squared PASSED  [ 78%]
tests/test_stats_calculator.py::test_moving_average_window_3 PASSED      [ 78%]
tests/test_stats_calculator.py::test_moving_average_insufficient_data PASSED [ 78%]
tests/test_stats_calculator.py::test_detect_outliers_with_outlier PASSED [ 79%]
tests/test_stats_calculator.py::test_detect_outliers_without_outliers PASSED [ 79%]
tests/test_stats_calculator.py::test_calculate_volatility PASSED         [ 79%]
tests/test_stats_calculator.py::test_calculate_volatility_cero_mean PASSED [ 79%]
tests/test_stats_calculator.py::test_calculate_growth_rate PASSED        [ 79%]
tests/test_stats_calculator.py::test_calculate_growth_rate_invalid_values PASSED [ 80%]
tests/test_tipo_cambio_service.py::TestCache::test_cache_evita_llamada_api_repetida PASSED [ 80%]
tests/test_tipo_cambio_service.py::TestCache::test_cache_expira_despues_24_horas PASSED [ 80%]
tests/test_tipo_cambio_service.py::TestCache::test_cache_retorna_todos_valores PASSED [ 80%]
tests/test_tipo_cambio_service.py::TestAPIDolarApi::test_llamada_api_exitosa PASSED [ 80%]
tests/test_tipo_cambio_service.py::TestAPIDolarApi::test_api_actualiza_cache PASSED [ 80%]
tests/test_tipo_cambio_service.py::TestAPIDolarApi::test_api_calcula_promedio_correcto PASSED [ 81%]
tests/test_tipo_cambio_service.py::TestFallback::test_fallback_si_api_timeout PASSED [ 81%]
tests/test_tipo_cambio_service.py::TestFallback::test_fallback_si_api_connection_error PASSED [ 81%]
tests/test_tipo_cambio_service.py::TestFallback::test_fallback_si_api_500 PASSED [ 81%]
tests/test_tipo_cambio_service.py::TestFallback::test_fallback_si_api_response_invalida PASSED [ 81%]
tests/test_tipo_cambio_service.py::TestFallback::test_fallback_valores_razonables PASSED [ 81%]
tests/test_tipo_cambio_service.py::TestCasosEdge::test_api_retorna_valores_none PASSED [ 82%]
tests/test_tipo_cambio_service.py::TestCasosEdge::test_api_retorna_json_vacio PASSED [ 82%]
tests/test_tipo_cambio_service.py::TestCasosEdge::test_cache_timestamp_none_no_crashea PASSED [ 82%]
tests/test_tipo_cambio_service.py::TestCacheFuncionamiento::test_cache_se_actualiza_con_valores_api PASSED [ 82%]
tests/test_tipo_cambio_service.py::TestCacheFuncionamiento::test_cache_valido_dentro_24_horas PASSED [ 82%]
tests/test_tipo_cambio_service.py::TestFallbackCuandoAPIFalla::test_fallback_mantiene_valores_consistentes PASSED [ 83%]
tests/test_tipo_cambio_service.py::TestFallbackCuandoAPIFalla::test_fallback_fuente_indica_fallback PASSED [ 83%]
tests/test_tipo_cambio_service.py::TestConversionUYUaUSD::test_conversion_con_tc_real PASSED [ 83%]
tests/test_tipo_cambio_service.py::TestConversionUYUaUSD::test_conversion_formula_correcta PASSED [ 83%]
tests/test_tipo_cambio_service.py::TestRobustezAPI::test_api_lenta_usa_timeout PASSED [ 83%]
tests/test_tipo_cambio_service.py::TestRobustezAPI::test_multiples_errores_consecutivos_usan_fallback PASSED [ 83%]
tests/test_validador_sql.py::TestDistribucionesSocio::test_distribucion_socio_valida[10000-True] PASSED [ 84%]
tests/test_validador_sql.py::TestDistribucionesSocio::test_distribucion_socio_valida[50000-True] PASSED [ 84%]
tests/test_validador_sql.py::TestDistribucionesSocio::test_distribucion_socio_valida[99999-True] PASSED [ 84%]
tests/test_validador_sql.py::TestDistribucionesSocio::test_distribucion_socio_valida[0-True] PASSED [ 84%]
tests/test_validador_sql.py::TestDistribucionesSocio::test_distribucion_socio_valida[500-True] PASSED [ 84%]
tests/test_validador_sql.py::TestDistribucionesSocio::test_distribucion_socio_invalida[-1000-True] PASSED [ 85%]
tests/test_validador_sql.py::TestDistribucionesSocio::test_distribucion_socio_invalida[-50000-True] PASSED [ 85%]
tests/test_validador_sql.py::TestDistribucionesSocio::test_distribucion_socio_vacia PASSED [ 85%]
tests/test_validador_sql.py::TestDistribucionesSocio::test_distribucion_socio_multiples_campos PASSED [ 85%]
tests/test_validador_sql.py::TestRentabilidad::test_rentabilidad_valida[0-True] PASSED [ 85%]
tests/test_validador_sql.py::TestRentabilidad::test_rentabilidad_valida[33.47-True] PASSED [ 85%]
tests/test_validador_sql.py::TestRentabilidad::test_rentabilidad_valida[75.5-True] PASSED [ 86%]
tests/test_validador_sql.py::TestRentabilidad::test_rentabilidad_valida[100-True] PASSED [ 86%]
tests/test_validador_sql.py::TestRentabilidad::test_rentabilidad_valida[-50-True] PASSED [ 86%]
tests/test_validador_sql.py::TestRentabilidad::test_rentabilidad_valida[-100-True] PASSED [ 86%]
tests/test_validador_sql.py::TestRentabilidad::test_rentabilidad_invalida[101-True] PASSED [ 86%]
tests/test_validador_sql.py::TestRentabilidad::test_rentabilidad_invalida[250-True] PASSED [ 86%]
tests/test_validador_sql.py::TestRentabilidad::test_rentabilidad_invalida[-101-True] PASSED [ 87%]
tests/test_validador_sql.py::TestRentabilidad::test_rentabilidad_invalida[-500-True] PASSED [ 87%]
tests/test_validador_sql.py::TestRentabilidad::test_rentabilidad_diferentes_nombres_campo PASSED [ 87%]
tests/test_validador_sql.py::TestPorcentajes::test_porcentajes_suman_100 PASSED [ 87%]
tests/test_validador_sql.py::TestPorcentajes::test_porcentajes_suman_99 PASSED [ 87%]
tests/test_validador_sql.py::TestPorcentajes::test_porcentajes_no_suman_100[porcentajes0-True] PASSED [ 88%]
tests/test_validador_sql.py::TestPorcentajes::test_porcentajes_no_suman_100[porcentajes1-True] PASSED [ 88%]
tests/test_validador_sql.py::TestPorcentajes::test_porcentajes_no_suman_100[porcentajes2-True] PASSED [ 88%]
tests/test_validador_sql.py::TestPorcentajes::test_porcentaje_individual_fuera_rango PASSED [ 88%]
tests/test_validador_sql.py::TestFacturacion::test_facturacion_dia_valida[500000-True] PASSED [ 88%]
tests/test_validador_sql.py::TestFacturacion::test_facturacion_dia_valida[999999-True] PASSED [ 88%]
tests/test_validador_sql.py::TestFacturacion::test_facturacion_dia_valida[100000-True] PASSED [ 89%]
tests/test_validador_sql.py::TestFacturacion::test_facturacion_mes_valida[5000000] PASSED [ 89%]
tests/test_validador_sql.py::TestFacturacion::test_facturacion_mes_valida[9999999] PASSED [ 89%]
tests/test_validador_sql.py::TestFacturacion::test_facturacion_mes_valida[1000000] PASSED [ 89%]
tests/test_validador_sql.py::TestFacturacion::test_facturacion_dia_excede_limite PASSED [ 89%]
tests/test_validador_sql.py::TestGastos::test_gastos_validos[100000-True] PASSED [ 90%]
tests/test_validador_sql.py::TestGastos::test_gastos_validos[499999-True] PASSED [ 90%]
tests/test_validador_sql.py::TestGastos::test_gastos_validos[2000000-False] PASSED [ 90%]
tests/test_validador_sql.py::TestGastos::test_gastos_validos[4999999-False] PASSED [ 90%]
tests/test_validador_sql.py::TestGastos::test_gastos_dia_excede_limite PASSED [ 90%]
tests/test_validador_sql.py::TestRetiros::test_retiros_validos[50000] PASSED [ 90%]
tests/test_validador_sql.py::TestRetiros::test_retiros_validos[150000] PASSED [ 91%]
tests/test_validador_sql.py::TestRetiros::test_retiros_validos[199999] PASSED [ 91%]
tests/test_validador_sql.py::TestRetiros::test_retiro_negativo_invalido PASSED [ 91%]
tests/test_validador_sql.py::TestTipoCambio::test_tipo_cambio_valido[30.0] PASSED [ 91%]
tests/test_validador_sql.py::TestTipoCambio::test_tipo_cambio_valido[39.5] PASSED [ 91%]
tests/test_validador_sql.py::TestTipoCambio::test_tipo_cambio_valido[42.3] PASSED [ 91%]
tests/test_validador_sql.py::TestTipoCambio::test_tipo_cambio_valido[50.0] PASSED [ 92%]
tests/test_validador_sql.py::TestTipoCambio::test_tipo_cambio_invalido[29.9-True] PASSED [ 92%]
tests/test_validador_sql.py::TestTipoCambio::test_tipo_cambio_invalido[51.0-True] PASSED [ 92%]
tests/test_validador_sql.py::TestTipoCambio::test_tipo_cambio_invalido[10.0-True] PASSED [ 92%]
tests/test_validador_sql.py::TestTipoCambio::test_tipo_cambio_invalido[100.0-True] PASSED [ 92%]
tests/test_validador_sql.py::TestDeteccionTipoQuery::test_detectar_tipo_query[\xbfCu\xe1nto recibi\xf3 Bruno?-SELECT SUM...-distribucion_socio] PASSED [ 93%]
tests/test_validador_sql.py::TestDeteccionTipoQuery::test_detectar_tipo_query[\xbfCu\xe1nto retir\xf3 Agustina?-SELECT...-retiros] PASSED [ 93%]
tests/test_validador_sql.py::TestDeteccionTipoQuery::test_detectar_tipo_query[\xbfCu\xe1l es la rentabilidad?-SELECT...-rentabilidad] PASSED [ 93%]
tests/test_validador_sql.py::TestDeteccionTipoQuery::test_detectar_tipo_query[\xbfQu\xe9 % facturamos en USD?-SELECT * 100...-porcentaje] PASSED [ 93%]
tests/test_validador_sql.py::TestDeteccionTipoQuery::test_detectar_tipo_query[\xbfCu\xe1nto facturamos hoy?-SELECT...-facturacion_dia] PASSED [ 93%]
tests/test_validador_sql.py::TestDeteccionTipoQuery::test_detectar_tipo_query[\xbfCu\xe1nto facturamos?-SELECT...-facturacion] PASSED [ 93%]
tests/test_validador_sql.py::TestDeteccionTipoQuery::test_detectar_tipo_query[\xbfCu\xe1nto gastamos hoy?-SELECT...-gastos_dia] PASSED [ 94%]
tests/test_validador_sql.py::TestDeteccionTipoQuery::test_detectar_tipo_query[\xbfCu\xe1nto gastamos?-SELECT...-gastos] PASSED [ 94%]
tests/test_validador_sql.py::TestDeteccionTipoQuery::test_detectar_tipo_query[\xbfCu\xe1l es el tipo de cambio?-SELECT...-tipo_cambio] PASSED [ 94%]
tests/test_validador_sql.py::TestValidarResultado::test_validar_resultado_distribucion_valida PASSED [ 94%]
tests/test_validador_sql.py::TestValidarResultado::test_validar_resultado_rentabilidad_invalida PASSED [ 94%]
tests/test_validador_sql.py::TestValidarResultado::test_validar_resultado_vacio PASSED [ 95%]
tests/test_validador_sql.py::TestValidacionPreSQL::test_ranking_con_limit_1_sospechoso PASSED [ 95%]
tests/test_validador_sql.py::TestValidacionPreSQL::test_ranking_limit_1_valido_con_cual PASSED [ 95%]
tests/test_validador_sql.py::TestValidacionPreSQL::test_proyeccion_sin_extract_month PASSED [ 95%]
tests/test_validador_sql.py::TestValidacionPreSQL::test_proyeccion_con_extract_month_valida PASSED [ 95%]
tests/test_validador_sql.py::TestValidacionPreSQL::test_porcentaje_moneda_sin_moneda_original PASSED [ 95%]
tests/test_validador_sql.py::TestValidacionPreSQL::test_pregunta_generica_sin_filtro_temporal PASSED [ 96%]
tests/test_validador_sql.py::TestValidacionPreSQL::test_pregunta_con_periodo_explicito PASSED [ 96%]
tests/test_validador_sql.py::TestValidarRango::test_valor_dentro_rango PASSED [ 96%]
tests/test_validador_sql.py::TestValidarRango::test_valor_en_limite_inferior PASSED [ 96%]
tests/test_validador_sql.py::TestValidarRango::test_valor_en_limite_superior PASSED [ 96%]
tests/test_validador_sql.py::TestValidarRango::test_valor_fuera_rango_superior PASSED [ 96%]
tests/test_validador_sql.py::TestValidarRango::test_valor_none PASSED    [ 97%]
tests/test_validador_sql.py::test_validar_resultado_sql_wrapper PASSED   [ 97%]
tests/test_validador_sql.py::TestCasosEdge::test_resultado_con_valores_none PASSED [ 97%]
tests/test_validador_sql.py::TestCasosEdge::test_resultado_multiple_filas PASSED [ 97%]
tests/test_validador_sql.py::TestCasosEdge::test_resultado_multiple_filas_una_invalida PASSED [ 97%]
tests/test_validador_sql.py::TestCasosEdge::test_sql_vacio_en_validacion_pre PASSED [ 98%]
tests/test_validators.py::test_validate_dates_valid PASSED               [ 98%]
tests/test_validators.py::test_validate_dates_fin_antes_inicio PASSED    [ 98%]
tests/test_validators.py::test_validate_dates_futuras PASSED             [ 98%]
tests/test_validators.py::test_validate_dates_excede_maximo PASSED       [ 98%]
tests/test_validators.py::test_validate_period_predefinido PASSED        [ 98%]
tests/test_validators.py::test_validate_period_custom_valid PASSED       [ 99%]
tests/test_validators.py::test_validate_period_custom_sin_fechas PASSED  [ 99%]
tests/test_validators.py::test_validate_options_valid PASSED             [ 99%]
tests/test_validators.py::test_validate_sufficient_data_ok PASSED        [ 99%]
tests/test_validators.py::test_validate_sufficient_data_insuficientes PASSED [ 99%]
tests/test_validators.py::test_validate_data_quality PASSED              [100%]

==================================== ERRORS ====================================
_ ERROR at setup of test_pregunta_real_e2e[\xbfCu\xe1nto facturamos este mes?] _
tests/test_e2e.py:39: in mock_claude_apis
    with patch('app.api.cfo_ai.client') as mock_narrativa:
/usr/lib/python3.12/unittest/mock.py:1458: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/usr/lib/python3.12/unittest/mock.py:1431: in get_original
    raise AttributeError(
E   AttributeError: <module 'app.api.cfo_ai' from '/home/brunogandolfo/cfo-inteligente/backend/app/api/cfo_ai.py'> does not have the attribute 'client'
_ ERROR at setup of test_pregunta_real_e2e[\xbfC\xf3mo viene la rentabilidad?] _
tests/test_e2e.py:39: in mock_claude_apis
    with patch('app.api.cfo_ai.client') as mock_narrativa:
/usr/lib/python3.12/unittest/mock.py:1458: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/usr/lib/python3.12/unittest/mock.py:1431: in get_original
    raise AttributeError(
E   AttributeError: <module 'app.api.cfo_ai' from '/home/brunogandolfo/cfo-inteligente/backend/app/api/cfo_ai.py'> does not have the attribute 'client'
_ ERROR at setup of test_pregunta_real_e2e[\xbfCu\xe1l es el margen de este mes?] _
tests/test_e2e.py:39: in mock_claude_apis
    with patch('app.api.cfo_ai.client') as mock_narrativa:
/usr/lib/python3.12/unittest/mock.py:1458: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/usr/lib/python3.12/unittest/mock.py:1431: in get_original
    raise AttributeError(
E   AttributeError: <module 'app.api.cfo_ai' from '/home/brunogandolfo/cfo-inteligente/backend/app/api/cfo_ai.py'> does not have the attribute 'client'
_ ERROR at setup of test_pregunta_real_e2e[\xbfEstamos mejor que el mes pasado?] _
tests/test_e2e.py:39: in mock_claude_apis
    with patch('app.api.cfo_ai.client') as mock_narrativa:
/usr/lib/python3.12/unittest/mock.py:1458: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/usr/lib/python3.12/unittest/mock.py:1431: in get_original
    raise AttributeError(
E   AttributeError: <module 'app.api.cfo_ai' from '/home/brunogandolfo/cfo-inteligente/backend/app/api/cfo_ai.py'> does not have the attribute 'client'
__ ERROR at setup of test_pregunta_real_e2e[\xbfC\xf3mo vamos en el a\xf1o?] ___
tests/test_e2e.py:39: in mock_claude_apis
    with patch('app.api.cfo_ai.client') as mock_narrativa:
/usr/lib/python3.12/unittest/mock.py:1458: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/usr/lib/python3.12/unittest/mock.py:1431: in get_original
    raise AttributeError(
E   AttributeError: <module 'app.api.cfo_ai' from '/home/brunogandolfo/cfo-inteligente/backend/app/api/cfo_ai.py'> does not have the attribute 'client'
_ ERROR at setup of test_pregunta_real_e2e[\xbfCu\xe1nto ganamos este trimestre?] _
tests/test_e2e.py:39: in mock_claude_apis
    with patch('app.api.cfo_ai.client') as mock_narrativa:
/usr/lib/python3.12/unittest/mock.py:1458: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/usr/lib/python3.12/unittest/mock.py:1431: in get_original
    raise AttributeError(
E   AttributeError: <module 'app.api.cfo_ai' from '/home/brunogandolfo/cfo-inteligente/backend/app/api/cfo_ai.py'> does not have the attribute 'client'
_ ERROR at setup of test_pregunta_real_e2e[\xbfCu\xe1l es la rentabilidad del \xe1rea Jur\xeddi] _
tests/test_e2e.py:39: in mock_claude_apis
    with patch('app.api.cfo_ai.client') as mock_narrativa:
/usr/lib/python3.12/unittest/mock.py:1458: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/usr/lib/python3.12/unittest/mock.py:1431: in get_original
    raise AttributeError(
E   AttributeError: <module 'app.api.cfo_ai' from '/home/brunogandolfo/cfo-inteligente/backend/app/api/cfo_ai.py'> does not have the attribute 'client'
_ ERROR at setup of test_pregunta_real_e2e[\xbfQu\xe9 \xe1rea es m\xe1s rentable?] _
tests/test_e2e.py:39: in mock_claude_apis
    with patch('app.api.cfo_ai.client') as mock_narrativa:
/usr/lib/python3.12/unittest/mock.py:1458: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/usr/lib/python3.12/unittest/mock.py:1431: in get_original
    raise AttributeError(
E   AttributeError: <module 'app.api.cfo_ai' from '/home/brunogandolfo/cfo-inteligente/backend/app/api/cfo_ai.py'> does not have the attribute 'client'
_ ERROR at setup of test_pregunta_real_e2e[\xbfC\xf3mo est\xe1 la rentabilidad de Notarial?] _
tests/test_e2e.py:39: in mock_claude_apis
    with patch('app.api.cfo_ai.client') as mock_narrativa:
/usr/lib/python3.12/unittest/mock.py:1458: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/usr/lib/python3.12/unittest/mock.py:1431: in get_original
    raise AttributeError(
E   AttributeError: <module 'app.api.cfo_ai' from '/home/brunogandolfo/cfo-inteligente/backend/app/api/cfo_ai.py'> does not have the attribute 'client'
______ ERROR at setup of test_pregunta_real_e2e[Dame un resumen del mes] _______
tests/test_e2e.py:39: in mock_claude_apis
    with patch('app.api.cfo_ai.client') as mock_narrativa:
/usr/lib/python3.12/unittest/mock.py:1458: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/usr/lib/python3.12/unittest/mock.py:1431: in get_original
    raise AttributeError(
E   AttributeError: <module 'app.api.cfo_ai' from '/home/brunogandolfo/cfo-inteligente/backend/app/api/cfo_ai.py'> does not have the attribute 'client'
_ ERROR at setup of test_pregunta_real_e2e[\xbfCu\xe1l fue el mejor mes del a\xf1o?] _
tests/test_e2e.py:39: in mock_claude_apis
    with patch('app.api.cfo_ai.client') as mock_narrativa:
/usr/lib/python3.12/unittest/mock.py:1458: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/usr/lib/python3.12/unittest/mock.py:1431: in get_original
    raise AttributeError(
E   AttributeError: <module 'app.api.cfo_ai' from '/home/brunogandolfo/cfo-inteligente/backend/app/api/cfo_ai.py'> does not have the attribute 'client'
_ ERROR at setup of test_pregunta_real_e2e[\xbfVenimos mejorando la rentabilidad?] _
tests/test_e2e.py:39: in mock_claude_apis
    with patch('app.api.cfo_ai.client') as mock_narrativa:
/usr/lib/python3.12/unittest/mock.py:1458: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/usr/lib/python3.12/unittest/mock.py:1431: in get_original
    raise AttributeError(
E   AttributeError: <module 'app.api.cfo_ai' from '/home/brunogandolfo/cfo-inteligente/backend/app/api/cfo_ai.py'> does not have the attribute 'client'
_ ERROR at setup of test_pregunta_real_e2e[\xbfCu\xe1nto es el resultado operativo?] _
tests/test_e2e.py:39: in mock_claude_apis
    with patch('app.api.cfo_ai.client') as mock_narrativa:
/usr/lib/python3.12/unittest/mock.py:1458: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/usr/lib/python3.12/unittest/mock.py:1431: in get_original
    raise AttributeError(
E   AttributeError: <module 'app.api.cfo_ai' from '/home/brunogandolfo/cfo-inteligente/backend/app/api/cfo_ai.py'> does not have the attribute 'client'
_ ERROR at setup of test_pregunta_real_e2e[\xbfC\xf3mo viene el margen comparado con el a] _
tests/test_e2e.py:39: in mock_claude_apis
    with patch('app.api.cfo_ai.client') as mock_narrativa:
/usr/lib/python3.12/unittest/mock.py:1458: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/usr/lib/python3.12/unittest/mock.py:1431: in get_original
    raise AttributeError(
E   AttributeError: <module 'app.api.cfo_ai' from '/home/brunogandolfo/cfo-inteligente/backend/app/api/cfo_ai.py'> does not have the attribute 'client'
_ ERROR at setup of test_pregunta_real_e2e[\xbfProyectamos bien el cierre de a\xf1o?] _
tests/test_e2e.py:39: in mock_claude_apis
    with patch('app.api.cfo_ai.client') as mock_narrativa:
/usr/lib/python3.12/unittest/mock.py:1458: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/usr/lib/python3.12/unittest/mock.py:1431: in get_original
    raise AttributeError(
E   AttributeError: <module 'app.api.cfo_ai' from '/home/brunogandolfo/cfo-inteligente/backend/app/api/cfo_ai.py'> does not have the attribute 'client'
_ ERROR at setup of test_pregunta_real_e2e[\xbfCu\xe1nto le toca a Bruno este a\xf1o?] _
tests/test_e2e.py:39: in mock_claude_apis
    with patch('app.api.cfo_ai.client') as mock_narrativa:
/usr/lib/python3.12/unittest/mock.py:1458: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/usr/lib/python3.12/unittest/mock.py:1431: in get_original
    raise AttributeError(
E   AttributeError: <module 'app.api.cfo_ai' from '/home/brunogandolfo/cfo-inteligente/backend/app/api/cfo_ai.py'> does not have the attribute 'client'
_ ERROR at setup of test_pregunta_real_e2e[\xbfCu\xe1nto recibi\xf3 Agustina en distribucion] _
tests/test_e2e.py:39: in mock_claude_apis
    with patch('app.api.cfo_ai.client') as mock_narrativa:
/usr/lib/python3.12/unittest/mock.py:1458: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/usr/lib/python3.12/unittest/mock.py:1431: in get_original
    raise AttributeError(
E   AttributeError: <module 'app.api.cfo_ai' from '/home/brunogandolfo/cfo-inteligente/backend/app/api/cfo_ai.py'> does not have the attribute 'client'
_ ERROR at setup of test_pregunta_real_e2e[\xbfQu\xe9 socio retir\xf3 m\xe1s plata?] _
tests/test_e2e.py:39: in mock_claude_apis
    with patch('app.api.cfo_ai.client') as mock_narrativa:
/usr/lib/python3.12/unittest/mock.py:1458: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/usr/lib/python3.12/unittest/mock.py:1431: in get_original
    raise AttributeError(
E   AttributeError: <module 'app.api.cfo_ai' from '/home/brunogandolfo/cfo-inteligente/backend/app/api/cfo_ai.py'> does not have the attribute 'client'
_ ERROR at setup of test_pregunta_real_e2e[\xbfCu\xe1ndo fue la \xfaltima distribuci\xf3n?] _
tests/test_e2e.py:39: in mock_claude_apis
    with patch('app.api.cfo_ai.client') as mock_narrativa:
/usr/lib/python3.12/unittest/mock.py:1458: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/usr/lib/python3.12/unittest/mock.py:1431: in get_original
    raise AttributeError(
E   AttributeError: <module 'app.api.cfo_ai' from '/home/brunogandolfo/cfo-inteligente/backend/app/api/cfo_ai.py'> does not have the attribute 'client'
_ ERROR at setup of test_pregunta_real_e2e[\xbfCu\xe1nto se distribuy\xf3 este trimestre?] _
tests/test_e2e.py:39: in mock_claude_apis
    with patch('app.api.cfo_ai.client') as mock_narrativa:
/usr/lib/python3.12/unittest/mock.py:1458: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/usr/lib/python3.12/unittest/mock.py:1431: in get_original
    raise AttributeError(
E   AttributeError: <module 'app.api.cfo_ai' from '/home/brunogandolfo/cfo-inteligente/backend/app/api/cfo_ai.py'> does not have the attribute 'client'
_ ERROR at setup of test_pregunta_real_e2e[\xbfEst\xe1n bien los porcentajes de cada soci] _
tests/test_e2e.py:39: in mock_claude_apis
    with patch('app.api.cfo_ai.client') as mock_narrativa:
/usr/lib/python3.12/unittest/mock.py:1458: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/usr/lib/python3.12/unittest/mock.py:1431: in get_original
    raise AttributeError(
E   AttributeError: <module 'app.api.cfo_ai' from '/home/brunogandolfo/cfo-inteligente/backend/app/api/cfo_ai.py'> does not have the attribute 'client'
_ ERROR at setup of test_pregunta_real_e2e[\xbfCu\xe1nto llev\xf3 Viviana en el a\xf1o?] _
tests/test_e2e.py:39: in mock_claude_apis
    with patch('app.api.cfo_ai.client') as mock_narrativa:
/usr/lib/python3.12/unittest/mock.py:1458: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/usr/lib/python3.12/unittest/mock.py:1431: in get_original
    raise AttributeError(
E   AttributeError: <module 'app.api.cfo_ai' from '/home/brunogandolfo/cfo-inteligente/backend/app/api/cfo_ai.py'> does not have the attribute 'client'
_ ERROR at setup of test_pregunta_real_e2e[\xbfQu\xe9 socio tiene m\xe1s retiros?] _
tests/test_e2e.py:39: in mock_claude_apis
    with patch('app.api.cfo_ai.client') as mock_narrativa:
/usr/lib/python3.12/unittest/mock.py:1458: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/usr/lib/python3.12/unittest/mock.py:1431: in get_original
    raise AttributeError(
E   AttributeError: <module 'app.api.cfo_ai' from '/home/brunogandolfo/cfo-inteligente/backend/app/api/cfo_ai.py'> does not have the attribute 'client'
_ ERROR at setup of test_pregunta_real_e2e[\xbfCu\xe1nto se reparti\xf3 en total?] _
tests/test_e2e.py:39: in mock_claude_apis
    with patch('app.api.cfo_ai.client') as mock_narrativa:
/usr/lib/python3.12/unittest/mock.py:1458: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/usr/lib/python3.12/unittest/mock.py:1431: in get_original
    raise AttributeError(
E   AttributeError: <module 'app.api.cfo_ai' from '/home/brunogandolfo/cfo-inteligente/backend/app/api/cfo_ai.py'> does not have the attribute 'client'
_ ERROR at setup of test_pregunta_real_e2e[\xbfGonzalo est\xe1 recibiendo lo que correspo] _
tests/test_e2e.py:39: in mock_claude_apis
    with patch('app.api.cfo_ai.client') as mock_narrativa:
/usr/lib/python3.12/unittest/mock.py:1458: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/usr/lib/python3.12/unittest/mock.py:1431: in get_original
    raise AttributeError(
E   AttributeError: <module 'app.api.cfo_ai' from '/home/brunogandolfo/cfo-inteligente/backend/app/api/cfo_ai.py'> does not have the attribute 'client'
_ ERROR at setup of test_pregunta_real_e2e[\xbfFacturamos m\xe1s este mes que el anterior] _
tests/test_e2e.py:39: in mock_claude_apis
    with patch('app.api.cfo_ai.client') as mock_narrativa:
/usr/lib/python3.12/unittest/mock.py:1458: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/usr/lib/python3.12/unittest/mock.py:1431: in get_original
    raise AttributeError(
E   AttributeError: <module 'app.api.cfo_ai' from '/home/brunogandolfo/cfo-inteligente/backend/app/api/cfo_ai.py'> does not have the attribute 'client'
_ ERROR at setup of test_pregunta_real_e2e[\xbfC\xf3mo se compara este trimestre con el p] _
tests/test_e2e.py:39: in mock_claude_apis
    with patch('app.api.cfo_ai.client') as mock_narrativa:
/usr/lib/python3.12/unittest/mock.py:1458: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/usr/lib/python3.12/unittest/mock.py:1431: in get_original
    raise AttributeError(
E   AttributeError: <module 'app.api.cfo_ai' from '/home/brunogandolfo/cfo-inteligente/backend/app/api/cfo_ai.py'> does not have the attribute 'client'
__ ERROR at setup of test_pregunta_real_e2e[\xbfEstamos creciendo o bajando?] __
tests/test_e2e.py:39: in mock_claude_apis
    with patch('app.api.cfo_ai.client') as mock_narrativa:
/usr/lib/python3.12/unittest/mock.py:1458: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/usr/lib/python3.12/unittest/mock.py:1431: in get_original
    raise AttributeError(
E   AttributeError: <module 'app.api.cfo_ai' from '/home/brunogandolfo/cfo-inteligente/backend/app/api/cfo_ai.py'> does not have the attribute 'client'
__ ERROR at setup of test_pregunta_real_e2e[\xbfQu\xe9 trimestre fue mejor?] ___
tests/test_e2e.py:39: in mock_claude_apis
    with patch('app.api.cfo_ai.client') as mock_narrativa:
/usr/lib/python3.12/unittest/mock.py:1458: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/usr/lib/python3.12/unittest/mock.py:1431: in get_original
    raise AttributeError(
E   AttributeError: <module 'app.api.cfo_ai' from '/home/brunogandolfo/cfo-inteligente/backend/app/api/cfo_ai.py'> does not have the attribute 'client'
_ ERROR at setup of test_pregunta_real_e2e[\xbfC\xf3mo va octubre comparado con septiembr] _
tests/test_e2e.py:39: in mock_claude_apis
    with patch('app.api.cfo_ai.client') as mock_narrativa:
/usr/lib/python3.12/unittest/mock.py:1458: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/usr/lib/python3.12/unittest/mock.py:1431: in get_original
    raise AttributeError(
E   AttributeError: <module 'app.api.cfo_ai' from '/home/brunogandolfo/cfo-inteligente/backend/app/api/cfo_ai.py'> does not have the attribute 'client'
_ ERROR at setup of test_pregunta_real_e2e[\xbfMejoramos respecto al a\xf1o pasado?] _
tests/test_e2e.py:39: in mock_claude_apis
    with patch('app.api.cfo_ai.client') as mock_narrativa:
/usr/lib/python3.12/unittest/mock.py:1458: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/usr/lib/python3.12/unittest/mock.py:1431: in get_original
    raise AttributeError(
E   AttributeError: <module 'app.api.cfo_ai' from '/home/brunogandolfo/cfo-inteligente/backend/app/api/cfo_ai.py'> does not have the attribute 'client'
____ ERROR at setup of test_pregunta_real_e2e[\xbfCu\xe1l fue el peor mes?] ____
tests/test_e2e.py:39: in mock_claude_apis
    with patch('app.api.cfo_ai.client') as mock_narrativa:
/usr/lib/python3.12/unittest/mock.py:1458: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/usr/lib/python3.12/unittest/mock.py:1431: in get_original
    raise AttributeError(
E   AttributeError: <module 'app.api.cfo_ai' from '/home/brunogandolfo/cfo-inteligente/backend/app/api/cfo_ai.py'> does not have the attribute 'client'
_ ERROR at setup of test_pregunta_real_e2e[\xbfLa tendencia es positiva o negativa?] _
tests/test_e2e.py:39: in mock_claude_apis
    with patch('app.api.cfo_ai.client') as mock_narrativa:
/usr/lib/python3.12/unittest/mock.py:1458: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/usr/lib/python3.12/unittest/mock.py:1431: in get_original
    raise AttributeError(
E   AttributeError: <module 'app.api.cfo_ai' from '/home/brunogandolfo/cfo-inteligente/backend/app/api/cfo_ai.py'> does not have the attribute 'client'
___ ERROR at setup of test_pregunta_real_e2e[\xbfEstamos en alza o en baja?] ___
tests/test_e2e.py:39: in mock_claude_apis
    with patch('app.api.cfo_ai.client') as mock_narrativa:
/usr/lib/python3.12/unittest/mock.py:1458: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/usr/lib/python3.12/unittest/mock.py:1431: in get_original
    raise AttributeError(
E   AttributeError: <module 'app.api.cfo_ai' from '/home/brunogandolfo/cfo-inteligente/backend/app/api/cfo_ai.py'> does not have the attribute 'client'
_ ERROR at setup of test_pregunta_real_e2e[\xbfC\xf3mo viene la facturaci\xf3n mes a mes?] _
tests/test_e2e.py:39: in mock_claude_apis
    with patch('app.api.cfo_ai.client') as mock_narrativa:
/usr/lib/python3.12/unittest/mock.py:1458: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/usr/lib/python3.12/unittest/mock.py:1431: in get_original
    raise AttributeError(
E   AttributeError: <module 'app.api.cfo_ai' from '/home/brunogandolfo/cfo-inteligente/backend/app/api/cfo_ai.py'> does not have the attribute 'client'
_ ERROR at setup of test_pregunta_real_e2e[\xbfCu\xe1nto facturamos en d\xf3lares este mes?] _
tests/test_e2e.py:39: in mock_claude_apis
    with patch('app.api.cfo_ai.client') as mock_narrativa:
/usr/lib/python3.12/unittest/mock.py:1458: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/usr/lib/python3.12/unittest/mock.py:1431: in get_original
    raise AttributeError(
E   AttributeError: <module 'app.api.cfo_ai' from '/home/brunogandolfo/cfo-inteligente/backend/app/api/cfo_ai.py'> does not have the attribute 'client'
__ ERROR at setup of test_pregunta_real_e2e[\xbfCu\xe1nto gastamos en pesos?] __
tests/test_e2e.py:39: in mock_claude_apis
    with patch('app.api.cfo_ai.client') as mock_narrativa:
/usr/lib/python3.12/unittest/mock.py:1458: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/usr/lib/python3.12/unittest/mock.py:1431: in get_original
    raise AttributeError(
E   AttributeError: <module 'app.api.cfo_ai' from '/home/brunogandolfo/cfo-inteligente/backend/app/api/cfo_ai.py'> does not have the attribute 'client'
_ ERROR at setup of test_pregunta_real_e2e[\xbfQu\xe9 porcentaje de facturaci\xf3n es en USD] _
tests/test_e2e.py:39: in mock_claude_apis
    with patch('app.api.cfo_ai.client') as mock_narrativa:
/usr/lib/python3.12/unittest/mock.py:1458: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/usr/lib/python3.12/unittest/mock.py:1431: in get_original
    raise AttributeError(
E   AttributeError: <module 'app.api.cfo_ai' from '/home/brunogandolfo/cfo-inteligente/backend/app/api/cfo_ai.py'> does not have the attribute 'client'
_ ERROR at setup of test_pregunta_real_e2e[\xbfCu\xe1nto se distribuy\xf3 en d\xf3lares?] _
tests/test_e2e.py:39: in mock_claude_apis
    with patch('app.api.cfo_ai.client') as mock_narrativa:
/usr/lib/python3.12/unittest/mock.py:1458: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/usr/lib/python3.12/unittest/mock.py:1431: in get_original
    raise AttributeError(
E   AttributeError: <module 'app.api.cfo_ai' from '/home/brunogandolfo/cfo-inteligente/backend/app/api/cfo_ai.py'> does not have the attribute 'client'
_ ERROR at setup of test_pregunta_real_e2e[\xbfOperamos m\xe1s en pesos o d\xf3lares?] _
tests/test_e2e.py:39: in mock_claude_apis
    with patch('app.api.cfo_ai.client') as mock_narrativa:
/usr/lib/python3.12/unittest/mock.py:1458: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/usr/lib/python3.12/unittest/mock.py:1431: in get_original
    raise AttributeError(
E   AttributeError: <module 'app.api.cfo_ai' from '/home/brunogandolfo/cfo-inteligente/backend/app/api/cfo_ai.py'> does not have the attribute 'client'
_ ERROR at setup of test_pregunta_real_e2e[\xbfCu\xe1l es el tipo de cambio promedio que ] _
tests/test_e2e.py:39: in mock_claude_apis
    with patch('app.api.cfo_ai.client') as mock_narrativa:
/usr/lib/python3.12/unittest/mock.py:1458: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/usr/lib/python3.12/unittest/mock.py:1431: in get_original
    raise AttributeError(
E   AttributeError: <module 'app.api.cfo_ai' from '/home/brunogandolfo/cfo-inteligente/backend/app/api/cfo_ai.py'> does not have the attribute 'client'
_ ERROR at setup of test_pregunta_real_e2e[\xbfQu\xe9 \xe1rea factura m\xe1s en d\xf3lares?] _
tests/test_e2e.py:39: in mock_claude_apis
    with patch('app.api.cfo_ai.client') as mock_narrativa:
/usr/lib/python3.12/unittest/mock.py:1458: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/usr/lib/python3.12/unittest/mock.py:1431: in get_original
    raise AttributeError(
E   AttributeError: <module 'app.api.cfo_ai' from '/home/brunogandolfo/cfo-inteligente/backend/app/api/cfo_ai.py'> does not have the attribute 'client'
_ ERROR at setup of test_pregunta_real_e2e[\xbfCu\xe1nto es todo en d\xf3lares?] _
tests/test_e2e.py:39: in mock_claude_apis
    with patch('app.api.cfo_ai.client') as mock_narrativa:
/usr/lib/python3.12/unittest/mock.py:1458: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/usr/lib/python3.12/unittest/mock.py:1431: in get_original
    raise AttributeError(
E   AttributeError: <module 'app.api.cfo_ai' from '/home/brunogandolfo/cfo-inteligente/backend/app/api/cfo_ai.py'> does not have the attribute 'client'
_ ERROR at setup of test_pregunta_real_e2e[\xbfQu\xe9 \xe1rea genera m\xe1s ingresos?] _
tests/test_e2e.py:39: in mock_claude_apis
    with patch('app.api.cfo_ai.client') as mock_narrativa:
/usr/lib/python3.12/unittest/mock.py:1458: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/usr/lib/python3.12/unittest/mock.py:1431: in get_original
    raise AttributeError(
E   AttributeError: <module 'app.api.cfo_ai' from '/home/brunogandolfo/cfo-inteligente/backend/app/api/cfo_ai.py'> does not have the attribute 'client'
_ ERROR at setup of test_pregunta_real_e2e[\xbfCu\xe1nto factura Montevideo vs Mercedes?] _
tests/test_e2e.py:39: in mock_claude_apis
    with patch('app.api.cfo_ai.client') as mock_narrativa:
/usr/lib/python3.12/unittest/mock.py:1458: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/usr/lib/python3.12/unittest/mock.py:1431: in get_original
    raise AttributeError(
E   AttributeError: <module 'app.api.cfo_ai' from '/home/brunogandolfo/cfo-inteligente/backend/app/api/cfo_ai.py'> does not have the attribute 'client'
_ ERROR at setup of test_pregunta_real_e2e[\xbfQu\xe9 oficina es m\xe1s rentable?] _
tests/test_e2e.py:39: in mock_claude_apis
    with patch('app.api.cfo_ai.client') as mock_narrativa:
/usr/lib/python3.12/unittest/mock.py:1458: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/usr/lib/python3.12/unittest/mock.py:1431: in get_original
    raise AttributeError(
E   AttributeError: <module 'app.api.cfo_ai' from '/home/brunogandolfo/cfo-inteligente/backend/app/api/cfo_ai.py'> does not have the attribute 'client'
_ ERROR at setup of test_pregunta_real_e2e[\xbfC\xf3mo est\xe1 Mercedes este mes?] _
tests/test_e2e.py:39: in mock_claude_apis
    with patch('app.api.cfo_ai.client') as mock_narrativa:
/usr/lib/python3.12/unittest/mock.py:1458: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/usr/lib/python3.12/unittest/mock.py:1431: in get_original
    raise AttributeError(
E   AttributeError: <module 'app.api.cfo_ai' from '/home/brunogandolfo/cfo-inteligente/backend/app/api/cfo_ai.py'> does not have the attribute 'client'
__ ERROR at setup of test_pregunta_real_e2e[\xbfCu\xe1nto gast\xf3 Contable?] __
tests/test_e2e.py:39: in mock_claude_apis
    with patch('app.api.cfo_ai.client') as mock_narrativa:
/usr/lib/python3.12/unittest/mock.py:1458: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/usr/lib/python3.12/unittest/mock.py:1431: in get_original
    raise AttributeError(
E   AttributeError: <module 'app.api.cfo_ai' from '/home/brunogandolfo/cfo-inteligente/backend/app/api/cfo_ai.py'> does not have the attribute 'client'
_ ERROR at setup of test_pregunta_real_e2e[\xbfQu\xe9 \xe1rea tiene m\xe1s gastos?] _
tests/test_e2e.py:39: in mock_claude_apis
    with patch('app.api.cfo_ai.client') as mock_narrativa:
/usr/lib/python3.12/unittest/mock.py:1458: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/usr/lib/python3.12/unittest/mock.py:1431: in get_original
    raise AttributeError(
E   AttributeError: <module 'app.api.cfo_ai' from '/home/brunogandolfo/cfo-inteligente/backend/app/api/cfo_ai.py'> does not have the attribute 'client'
_ ERROR at setup of test_pregunta_real_e2e[\xbfCu\xe1l es la facturaci\xf3n de cada \xe1rea?] _
tests/test_e2e.py:39: in mock_claude_apis
    with patch('app.api.cfo_ai.client') as mock_narrativa:
/usr/lib/python3.12/unittest/mock.py:1458: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/usr/lib/python3.12/unittest/mock.py:1431: in get_original
    raise AttributeError(
E   AttributeError: <module 'app.api.cfo_ai' from '/home/brunogandolfo/cfo-inteligente/backend/app/api/cfo_ai.py'> does not have the attribute 'client'
_____ ERROR at setup of TestMetricasPrecision.test_tasa_respuesta_exitosa ______
tests/test_e2e.py:39: in mock_claude_apis
    with patch('app.api.cfo_ai.client') as mock_narrativa:
/usr/lib/python3.12/unittest/mock.py:1458: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/usr/lib/python3.12/unittest/mock.py:1431: in get_original
    raise AttributeError(
E   AttributeError: <module 'app.api.cfo_ai' from '/home/brunogandolfo/cfo-inteligente/backend/app/api/cfo_ai.py'> does not have the attribute 'client'
__ ERROR at setup of TestMetricasPrecision.test_metadata_presente_en_exitosas __
tests/test_e2e.py:39: in mock_claude_apis
    with patch('app.api.cfo_ai.client') as mock_narrativa:
/usr/lib/python3.12/unittest/mock.py:1458: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/usr/lib/python3.12/unittest/mock.py:1431: in get_original
    raise AttributeError(
E   AttributeError: <module 'app.api.cfo_ai' from '/home/brunogandolfo/cfo-inteligente/backend/app/api/cfo_ai.py'> does not have the attribute 'client'
___ ERROR at setup of TestMetricasPrecision.test_tiempo_respuesta_razonable ____
tests/test_e2e.py:39: in mock_claude_apis
    with patch('app.api.cfo_ai.client') as mock_narrativa:
/usr/lib/python3.12/unittest/mock.py:1458: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/usr/lib/python3.12/unittest/mock.py:1431: in get_original
    raise AttributeError(
E   AttributeError: <module 'app.api.cfo_ai' from '/home/brunogandolfo/cfo-inteligente/backend/app/api/cfo_ai.py'> does not have the attribute 'client'
___ ERROR at setup of TestOperacionesIntegration.test_crear_ingreso_completo ___
tests/test_integration_real.py:99: in setup_datos_base
    Socio(id=uuid4(), nombre="Agustina", porcentaje=Decimal("20.00")),
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
<string>:4: in __init__
    ???
venv/lib/python3.12/site-packages/sqlalchemy/orm/state.py:571: in _initialize_instance
    with util.safe_reraise():
venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:146: in __exit__
    raise exc_value.with_traceback(exc_tb)
venv/lib/python3.12/site-packages/sqlalchemy/orm/state.py:569: in _initialize_instance
    manager.original_init(*mixed[1:], **kwargs)
venv/lib/python3.12/site-packages/sqlalchemy/orm/decl_base.py:2167: in _declarative_constructor
    raise TypeError(
E   TypeError: 'porcentaje' is an invalid keyword argument for Socio
____ ERROR at setup of TestOperacionesIntegration.test_crear_gasto_completo ____
tests/test_integration_real.py:99: in setup_datos_base
    Socio(id=uuid4(), nombre="Agustina", porcentaje=Decimal("20.00")),
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
<string>:4: in __init__
    ???
venv/lib/python3.12/site-packages/sqlalchemy/orm/state.py:571: in _initialize_instance
    with util.safe_reraise():
venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:146: in __exit__
    raise exc_value.with_traceback(exc_tb)
venv/lib/python3.12/site-packages/sqlalchemy/orm/state.py:569: in _initialize_instance
    manager.original_init(*mixed[1:], **kwargs)
venv/lib/python3.12/site-packages/sqlalchemy/orm/decl_base.py:2167: in _declarative_constructor
    raise TypeError(
E   TypeError: 'porcentaje' is an invalid keyword argument for Socio
___ ERROR at setup of TestOperacionesIntegration.test_crear_retiro_completo ____
tests/test_integration_real.py:99: in setup_datos_base
    Socio(id=uuid4(), nombre="Agustina", porcentaje=Decimal("20.00")),
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
<string>:4: in __init__
    ???
venv/lib/python3.12/site-packages/sqlalchemy/orm/state.py:571: in _initialize_instance
    with util.safe_reraise():
venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:146: in __exit__
    raise exc_value.with_traceback(exc_tb)
venv/lib/python3.12/site-packages/sqlalchemy/orm/state.py:569: in _initialize_instance
    manager.original_init(*mixed[1:], **kwargs)
venv/lib/python3.12/site-packages/sqlalchemy/orm/decl_base.py:2167: in _declarative_constructor
    raise TypeError(
E   TypeError: 'porcentaje' is an invalid keyword argument for Socio
_ ERROR at setup of TestOperacionesIntegration.test_operacion_calcula_monto_usd_correctamente _
tests/test_integration_real.py:99: in setup_datos_base
    Socio(id=uuid4(), nombre="Agustina", porcentaje=Decimal("20.00")),
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
<string>:4: in __init__
    ???
venv/lib/python3.12/site-packages/sqlalchemy/orm/state.py:571: in _initialize_instance
    with util.safe_reraise():
venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:146: in __exit__
    raise exc_value.with_traceback(exc_tb)
venv/lib/python3.12/site-packages/sqlalchemy/orm/state.py:569: in _initialize_instance
    manager.original_init(*mixed[1:], **kwargs)
venv/lib/python3.12/site-packages/sqlalchemy/orm/decl_base.py:2167: in _declarative_constructor
    raise TypeError(
E   TypeError: 'porcentaje' is an invalid keyword argument for Socio
_ ERROR at setup of TestOperacionesIntegration.test_listar_operaciones_con_filtros _
tests/test_integration_real.py:99: in setup_datos_base
    Socio(id=uuid4(), nombre="Agustina", porcentaje=Decimal("20.00")),
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
<string>:4: in __init__
    ???
venv/lib/python3.12/site-packages/sqlalchemy/orm/state.py:571: in _initialize_instance
    with util.safe_reraise():
venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:146: in __exit__
    raise exc_value.with_traceback(exc_tb)
venv/lib/python3.12/site-packages/sqlalchemy/orm/state.py:569: in _initialize_instance
    manager.original_init(*mixed[1:], **kwargs)
venv/lib/python3.12/site-packages/sqlalchemy/orm/decl_base.py:2167: in _declarative_constructor
    raise TypeError(
E   TypeError: 'porcentaje' is an invalid keyword argument for Socio
_ ERROR at setup of TestCFOAIIntegration.test_pregunta_simple_retorna_respuesta _
tests/test_integration_real.py:99: in setup_datos_base
    Socio(id=uuid4(), nombre="Agustina", porcentaje=Decimal("20.00")),
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
<string>:4: in __init__
    ???
venv/lib/python3.12/site-packages/sqlalchemy/orm/state.py:571: in _initialize_instance
    with util.safe_reraise():
venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:146: in __exit__
    raise exc_value.with_traceback(exc_tb)
venv/lib/python3.12/site-packages/sqlalchemy/orm/state.py:569: in _initialize_instance
    manager.original_init(*mixed[1:], **kwargs)
venv/lib/python3.12/site-packages/sqlalchemy/orm/decl_base.py:2167: in _declarative_constructor
    raise TypeError(
E   TypeError: 'porcentaje' is an invalid keyword argument for Socio
____ ERROR at setup of TestCFOAIIntegration.test_pregunta_genera_sql_valido ____
tests/test_integration_real.py:99: in setup_datos_base
    Socio(id=uuid4(), nombre="Agustina", porcentaje=Decimal("20.00")),
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
<string>:4: in __init__
    ???
venv/lib/python3.12/site-packages/sqlalchemy/orm/state.py:571: in _initialize_instance
    with util.safe_reraise():
venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:146: in __exit__
    raise exc_value.with_traceback(exc_tb)
venv/lib/python3.12/site-packages/sqlalchemy/orm/state.py:569: in _initialize_instance
    manager.original_init(*mixed[1:], **kwargs)
venv/lib/python3.12/site-packages/sqlalchemy/orm/decl_base.py:2167: in _declarative_constructor
    raise TypeError(
E   TypeError: 'porcentaje' is an invalid keyword argument for Socio
______ ERROR at setup of TestDatosConsistencia.test_soft_delete_operacion ______
tests/test_integration_real.py:99: in setup_datos_base
    Socio(id=uuid4(), nombre="Agustina", porcentaje=Decimal("20.00")),
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
<string>:4: in __init__
    ???
venv/lib/python3.12/site-packages/sqlalchemy/orm/state.py:571: in _initialize_instance
    with util.safe_reraise():
venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:146: in __exit__
    raise exc_value.with_traceback(exc_tb)
venv/lib/python3.12/site-packages/sqlalchemy/orm/state.py:569: in _initialize_instance
    manager.original_init(*mixed[1:], **kwargs)
venv/lib/python3.12/site-packages/sqlalchemy/orm/decl_base.py:2167: in _declarative_constructor
    raise TypeError(
E   TypeError: 'porcentaje' is an invalid keyword argument for Socio
_____ ERROR at setup of TestDatosConsistencia.test_relacion_operacion_area _____
tests/test_integration_real.py:99: in setup_datos_base
    Socio(id=uuid4(), nombre="Agustina", porcentaje=Decimal("20.00")),
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
<string>:4: in __init__
    ???
venv/lib/python3.12/site-packages/sqlalchemy/orm/state.py:571: in _initialize_instance
    with util.safe_reraise():
venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:146: in __exit__
    raise exc_value.with_traceback(exc_tb)
venv/lib/python3.12/site-packages/sqlalchemy/orm/state.py:569: in _initialize_instance
    manager.original_init(*mixed[1:], **kwargs)
venv/lib/python3.12/site-packages/sqlalchemy/orm/decl_base.py:2167: in _declarative_constructor
    raise TypeError(
E   TypeError: 'porcentaje' is an invalid keyword argument for Socio
__ ERROR at setup of TestCrearOperacionBase.test_crear_operacion_base_ingreso __
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: in do_execute
    cursor.execute(statement, parameters)
E   psycopg2.errors.UndefinedTable: relation "areas" does not exist
E   LINE 2: FROM areas 
E                ^

The above exception was the direct cause of the following exception:
tests/test_operacion_service.py:57: in area_test
    area = db_session.query(Area).filter(Area.nombre == "Jurídica").first()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2728: in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2827: in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2362: in execute
    return self._execute_internal(
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2247: in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py:305: in orm_execute_statement
    result = conn.execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1418: in execute
    return meth(
venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:515: in _execute_on_connection
    return connection._execute_clauseelement(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1640: in _execute_clauseelement
    ret = self._execute_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "areas" does not exist
E   LINE 2: FROM areas 
E                ^
E   
E   [SQL: SELECT areas.id AS areas_id, areas.nombre AS areas_nombre, areas.descripcion AS areas_descripcion, areas.activo AS areas_activo, areas.created_at AS areas_created_at, areas.updated_at AS areas_updated_at 
E   FROM areas 
E   WHERE areas.nombre = %(nombre_1)s 
E    LIMIT %(param_1)s]
E   [parameters: {'nombre_1': 'Jurídica', 'param_1': 1}]
E   (Background on this error at: https://sqlalche.me/e/20/f405)
___ ERROR at setup of TestCrearOperacionBase.test_crear_operacion_base_gasto ___
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: in do_execute
    cursor.execute(statement, parameters)
E   psycopg2.errors.UndefinedTable: relation "areas" does not exist
E   LINE 2: FROM areas 
E                ^

The above exception was the direct cause of the following exception:
tests/test_operacion_service.py:57: in area_test
    area = db_session.query(Area).filter(Area.nombre == "Jurídica").first()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2728: in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2827: in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2362: in execute
    return self._execute_internal(
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2247: in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py:305: in orm_execute_statement
    result = conn.execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1418: in execute
    return meth(
venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:515: in _execute_on_connection
    return connection._execute_clauseelement(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1640: in _execute_clauseelement
    ret = self._execute_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "areas" does not exist
E   LINE 2: FROM areas 
E                ^
E   
E   [SQL: SELECT areas.id AS areas_id, areas.nombre AS areas_nombre, areas.descripcion AS areas_descripcion, areas.activo AS areas_activo, areas.created_at AS areas_created_at, areas.updated_at AS areas_updated_at 
E   FROM areas 
E   WHERE areas.nombre = %(nombre_1)s 
E    LIMIT %(param_1)s]
E   [parameters: {'nombre_1': 'Jurídica', 'param_1': 1}]
E   (Background on this error at: https://sqlalche.me/e/20/f405)
_ ERROR at setup of TestCrearOperacionBase.test_crear_operacion_base_localidad_normalizada _
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: in do_execute
    cursor.execute(statement, parameters)
E   psycopg2.errors.UndefinedTable: relation "areas" does not exist
E   LINE 2: FROM areas 
E                ^

The above exception was the direct cause of the following exception:
tests/test_operacion_service.py:57: in area_test
    area = db_session.query(Area).filter(Area.nombre == "Jurídica").first()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2728: in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2827: in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2362: in execute
    return self._execute_internal(
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2247: in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py:305: in orm_execute_statement
    result = conn.execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1418: in execute
    return meth(
venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:515: in _execute_on_connection
    return connection._execute_clauseelement(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1640: in _execute_clauseelement
    ret = self._execute_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "areas" does not exist
E   LINE 2: FROM areas 
E                ^
E   
E   [SQL: SELECT areas.id AS areas_id, areas.nombre AS areas_nombre, areas.descripcion AS areas_descripcion, areas.activo AS areas_activo, areas.created_at AS areas_created_at, areas.updated_at AS areas_updated_at 
E   FROM areas 
E   WHERE areas.nombre = %(nombre_1)s 
E    LIMIT %(param_1)s]
E   [parameters: {'nombre_1': 'Jurídica', 'param_1': 1}]
E   (Background on this error at: https://sqlalche.me/e/20/f405)
__________ ERROR at setup of TestCrearIngreso.test_crear_ingreso_uyu ___________
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: in do_execute
    cursor.execute(statement, parameters)
E   psycopg2.errors.UndefinedTable: relation "areas" does not exist
E   LINE 2: FROM areas 
E                ^

The above exception was the direct cause of the following exception:
tests/test_operacion_service.py:57: in area_test
    area = db_session.query(Area).filter(Area.nombre == "Jurídica").first()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2728: in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2827: in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2362: in execute
    return self._execute_internal(
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2247: in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py:305: in orm_execute_statement
    result = conn.execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1418: in execute
    return meth(
venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:515: in _execute_on_connection
    return connection._execute_clauseelement(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1640: in _execute_clauseelement
    ret = self._execute_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "areas" does not exist
E   LINE 2: FROM areas 
E                ^
E   
E   [SQL: SELECT areas.id AS areas_id, areas.nombre AS areas_nombre, areas.descripcion AS areas_descripcion, areas.activo AS areas_activo, areas.created_at AS areas_created_at, areas.updated_at AS areas_updated_at 
E   FROM areas 
E   WHERE areas.nombre = %(nombre_1)s 
E    LIMIT %(param_1)s]
E   [parameters: {'nombre_1': 'Jurídica', 'param_1': 1}]
E   (Background on this error at: https://sqlalche.me/e/20/f405)
__________ ERROR at setup of TestCrearIngreso.test_crear_ingreso_usd ___________
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: in do_execute
    cursor.execute(statement, parameters)
E   psycopg2.errors.UndefinedTable: relation "areas" does not exist
E   LINE 2: FROM areas 
E                ^

The above exception was the direct cause of the following exception:
tests/test_operacion_service.py:57: in area_test
    area = db_session.query(Area).filter(Area.nombre == "Jurídica").first()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2728: in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2827: in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2362: in execute
    return self._execute_internal(
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2247: in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py:305: in orm_execute_statement
    result = conn.execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1418: in execute
    return meth(
venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:515: in _execute_on_connection
    return connection._execute_clauseelement(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1640: in _execute_clauseelement
    ret = self._execute_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "areas" does not exist
E   LINE 2: FROM areas 
E                ^
E   
E   [SQL: SELECT areas.id AS areas_id, areas.nombre AS areas_nombre, areas.descripcion AS areas_descripcion, areas.activo AS areas_activo, areas.created_at AS areas_created_at, areas.updated_at AS areas_updated_at 
E   FROM areas 
E   WHERE areas.nombre = %(nombre_1)s 
E    LIMIT %(param_1)s]
E   [parameters: {'nombre_1': 'Jurídica', 'param_1': 1}]
E   (Background on this error at: https://sqlalche.me/e/20/f405)
____________ ERROR at setup of TestCrearGasto.test_crear_gasto_uyu _____________
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: in do_execute
    cursor.execute(statement, parameters)
E   psycopg2.errors.UndefinedTable: relation "areas" does not exist
E   LINE 2: FROM areas 
E                ^

The above exception was the direct cause of the following exception:
tests/test_operacion_service.py:57: in area_test
    area = db_session.query(Area).filter(Area.nombre == "Jurídica").first()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2728: in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2827: in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2362: in execute
    return self._execute_internal(
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2247: in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py:305: in orm_execute_statement
    result = conn.execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1418: in execute
    return meth(
venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:515: in _execute_on_connection
    return connection._execute_clauseelement(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1640: in _execute_clauseelement
    ret = self._execute_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "areas" does not exist
E   LINE 2: FROM areas 
E                ^
E   
E   [SQL: SELECT areas.id AS areas_id, areas.nombre AS areas_nombre, areas.descripcion AS areas_descripcion, areas.activo AS areas_activo, areas.created_at AS areas_created_at, areas.updated_at AS areas_updated_at 
E   FROM areas 
E   WHERE areas.nombre = %(nombre_1)s 
E    LIMIT %(param_1)s]
E   [parameters: {'nombre_1': 'Jurídica', 'param_1': 1}]
E   (Background on this error at: https://sqlalche.me/e/20/f405)
____________ ERROR at setup of TestCrearGasto.test_crear_gasto_usd _____________
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: in do_execute
    cursor.execute(statement, parameters)
E   psycopg2.errors.UndefinedTable: relation "areas" does not exist
E   LINE 2: FROM areas 
E                ^

The above exception was the direct cause of the following exception:
tests/test_operacion_service.py:57: in area_test
    area = db_session.query(Area).filter(Area.nombre == "Jurídica").first()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2728: in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2827: in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2362: in execute
    return self._execute_internal(
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2247: in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py:305: in orm_execute_statement
    result = conn.execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1418: in execute
    return meth(
venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:515: in _execute_on_connection
    return connection._execute_clauseelement(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1640: in _execute_clauseelement
    ret = self._execute_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "areas" does not exist
E   LINE 2: FROM areas 
E                ^
E   
E   [SQL: SELECT areas.id AS areas_id, areas.nombre AS areas_nombre, areas.descripcion AS areas_descripcion, areas.activo AS areas_activo, areas.created_at AS areas_created_at, areas.updated_at AS areas_updated_at 
E   FROM areas 
E   WHERE areas.nombre = %(nombre_1)s 
E    LIMIT %(param_1)s]
E   [parameters: {'nombre_1': 'Jurídica', 'param_1': 1}]
E   (Background on this error at: https://sqlalche.me/e/20/f405)
_ ERROR at setup of TestCrearDistribucion.test_crear_distribucion_5_socios_completa _
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: in do_execute
    cursor.execute(statement, parameters)
E   psycopg2.errors.UndefinedTable: relation "socios" does not exist
E   LINE 2: FROM socios 
E                ^

The above exception was the direct cause of the following exception:
tests/test_operacion_service.py:69: in socios_test
    socio = db_session.query(Socio).filter(Socio.nombre == nombre).first()
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2728: in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2827: in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2362: in execute
    return self._execute_internal(
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2247: in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py:305: in orm_execute_statement
    result = conn.execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1418: in execute
    return meth(
venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:515: in _execute_on_connection
    return connection._execute_clauseelement(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1640: in _execute_clauseelement
    ret = self._execute_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "socios" does not exist
E   LINE 2: FROM socios 
E                ^
E   
E   [SQL: SELECT socios.id AS socios_id, socios.nombre AS socios_nombre, socios.porcentaje_participacion AS socios_porcentaje_participacion, socios.activo AS socios_activo, socios.created_at AS socios_created_at, socios.updated_at AS socios_updated_at 
E   FROM socios 
E   WHERE socios.nombre = %(nombre_1)s 
E    LIMIT %(param_1)s]
E   [parameters: {'nombre_1': 'Agustina', 'param_1': 1}]
E   (Background on this error at: https://sqlalche.me/e/20/f405)
_ ERROR at setup of TestCrearDistribucion.test_crear_distribucion_parcial_3_socios _
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: in do_execute
    cursor.execute(statement, parameters)
E   psycopg2.errors.UndefinedTable: relation "socios" does not exist
E   LINE 2: FROM socios 
E                ^

The above exception was the direct cause of the following exception:
tests/test_operacion_service.py:69: in socios_test
    socio = db_session.query(Socio).filter(Socio.nombre == nombre).first()
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2728: in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2827: in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2362: in execute
    return self._execute_internal(
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2247: in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py:305: in orm_execute_statement
    result = conn.execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1418: in execute
    return meth(
venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:515: in _execute_on_connection
    return connection._execute_clauseelement(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1640: in _execute_clauseelement
    ret = self._execute_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "socios" does not exist
E   LINE 2: FROM socios 
E                ^
E   
E   [SQL: SELECT socios.id AS socios_id, socios.nombre AS socios_nombre, socios.porcentaje_participacion AS socios_porcentaje_participacion, socios.activo AS socios_activo, socios.created_at AS socios_created_at, socios.updated_at AS socios_updated_at 
E   FROM socios 
E   WHERE socios.nombre = %(nombre_1)s 
E    LIMIT %(param_1)s]
E   [parameters: {'nombre_1': 'Agustina', 'param_1': 1}]
E   (Background on this error at: https://sqlalche.me/e/20/f405)
_ ERROR at setup of TestCrearDistribucion.test_crear_distribucion_detecta_moneda_original _
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: in do_execute
    cursor.execute(statement, parameters)
E   psycopg2.errors.UndefinedTable: relation "socios" does not exist
E   LINE 2: FROM socios 
E                ^

The above exception was the direct cause of the following exception:
tests/test_operacion_service.py:69: in socios_test
    socio = db_session.query(Socio).filter(Socio.nombre == nombre).first()
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2728: in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2827: in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2362: in execute
    return self._execute_internal(
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2247: in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py:305: in orm_execute_statement
    result = conn.execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1418: in execute
    return meth(
venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:515: in _execute_on_connection
    return connection._execute_clauseelement(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1640: in _execute_clauseelement
    ret = self._execute_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "socios" does not exist
E   LINE 2: FROM socios 
E                ^
E   
E   [SQL: SELECT socios.id AS socios_id, socios.nombre AS socios_nombre, socios.porcentaje_participacion AS socios_porcentaje_participacion, socios.activo AS socios_activo, socios.created_at AS socios_created_at, socios.updated_at AS socios_updated_at 
E   FROM socios 
E   WHERE socios.nombre = %(nombre_1)s 
E    LIMIT %(param_1)s]
E   [parameters: {'nombre_1': 'Agustina', 'param_1': 1}]
E   (Background on this error at: https://sqlalche.me/e/20/f405)
_ ERROR at setup of TestCrearDistribucion.test_crear_distribucion_no_requiere_area _
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: in do_execute
    cursor.execute(statement, parameters)
E   psycopg2.errors.UndefinedTable: relation "socios" does not exist
E   LINE 2: FROM socios 
E                ^

The above exception was the direct cause of the following exception:
tests/test_operacion_service.py:69: in socios_test
    socio = db_session.query(Socio).filter(Socio.nombre == nombre).first()
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2728: in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2827: in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2362: in execute
    return self._execute_internal(
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2247: in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py:305: in orm_execute_statement
    result = conn.execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1418: in execute
    return meth(
venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:515: in _execute_on_connection
    return connection._execute_clauseelement(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1640: in _execute_clauseelement
    ret = self._execute_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "socios" does not exist
E   LINE 2: FROM socios 
E                ^
E   
E   [SQL: SELECT socios.id AS socios_id, socios.nombre AS socios_nombre, socios.porcentaje_participacion AS socios_porcentaje_participacion, socios.activo AS socios_activo, socios.created_at AS socios_created_at, socios.updated_at AS socios_updated_at 
E   FROM socios 
E   WHERE socios.nombre = %(nombre_1)s 
E    LIMIT %(param_1)s]
E   [parameters: {'nombre_1': 'Agustina', 'param_1': 1}]
E   (Background on this error at: https://sqlalche.me/e/20/f405)
_ ERROR at setup of TestCrearDistribucion.test_crear_distribucion_porcentaje_20 _
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: in do_execute
    cursor.execute(statement, parameters)
E   psycopg2.errors.UndefinedTable: relation "socios" does not exist
E   LINE 2: FROM socios 
E                ^

The above exception was the direct cause of the following exception:
tests/test_operacion_service.py:69: in socios_test
    socio = db_session.query(Socio).filter(Socio.nombre == nombre).first()
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2728: in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2827: in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2362: in execute
    return self._execute_internal(
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2247: in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py:305: in orm_execute_statement
    result = conn.execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1418: in execute
    return meth(
venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:515: in _execute_on_connection
    return connection._execute_clauseelement(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1640: in _execute_clauseelement
    ret = self._execute_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "socios" does not exist
E   LINE 2: FROM socios 
E                ^
E   
E   [SQL: SELECT socios.id AS socios_id, socios.nombre AS socios_nombre, socios.porcentaje_participacion AS socios_porcentaje_participacion, socios.activo AS socios_activo, socios.created_at AS socios_created_at, socios.updated_at AS socios_updated_at 
E   FROM socios 
E   WHERE socios.nombre = %(nombre_1)s 
E    LIMIT %(param_1)s]
E   [parameters: {'nombre_1': 'Agustina', 'param_1': 1}]
E   (Background on this error at: https://sqlalche.me/e/20/f405)
________ ERROR at setup of TestCasosEdge.test_crear_ingreso_sin_cliente ________
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: in do_execute
    cursor.execute(statement, parameters)
E   psycopg2.errors.UndefinedTable: relation "areas" does not exist
E   LINE 2: FROM areas 
E                ^

The above exception was the direct cause of the following exception:
tests/test_operacion_service.py:57: in area_test
    area = db_session.query(Area).filter(Area.nombre == "Jurídica").first()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2728: in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2827: in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2362: in execute
    return self._execute_internal(
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2247: in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py:305: in orm_execute_statement
    result = conn.execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1418: in execute
    return meth(
venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:515: in _execute_on_connection
    return connection._execute_clauseelement(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1640: in _execute_clauseelement
    ret = self._execute_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "areas" does not exist
E   LINE 2: FROM areas 
E                ^
E   
E   [SQL: SELECT areas.id AS areas_id, areas.nombre AS areas_nombre, areas.descripcion AS areas_descripcion, areas.activo AS areas_activo, areas.created_at AS areas_created_at, areas.updated_at AS areas_updated_at 
E   FROM areas 
E   WHERE areas.nombre = %(nombre_1)s 
E    LIMIT %(param_1)s]
E   [parameters: {'nombre_1': 'Jurídica', 'param_1': 1}]
E   (Background on this error at: https://sqlalche.me/e/20/f405)
_ ERROR at setup of TestFiltrosPorLocalidadArea.test_crear_operaciones_diferentes_localidades _
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: in do_execute
    cursor.execute(statement, parameters)
E   psycopg2.errors.UndefinedTable: relation "areas" does not exist
E   LINE 2: FROM areas 
E                ^

The above exception was the direct cause of the following exception:
tests/test_operacion_service.py:57: in area_test
    area = db_session.query(Area).filter(Area.nombre == "Jurídica").first()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2728: in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2827: in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2362: in execute
    return self._execute_internal(
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2247: in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py:305: in orm_execute_statement
    result = conn.execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1418: in execute
    return meth(
venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:515: in _execute_on_connection
    return connection._execute_clauseelement(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1640: in _execute_clauseelement
    ret = self._execute_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "areas" does not exist
E   LINE 2: FROM areas 
E                ^
E   
E   [SQL: SELECT areas.id AS areas_id, areas.nombre AS areas_nombre, areas.descripcion AS areas_descripcion, areas.activo AS areas_activo, areas.created_at AS areas_created_at, areas.updated_at AS areas_updated_at 
E   FROM areas 
E   WHERE areas.nombre = %(nombre_1)s 
E    LIMIT %(param_1)s]
E   [parameters: {'nombre_1': 'Jurídica', 'param_1': 1}]
E   (Background on this error at: https://sqlalche.me/e/20/f405)
=================================== FAILURES ===================================
__________________ test_fallback_estrategico_genera_insights ___________________
tests/test_ai_components.py:148: in test_fallback_estrategico_genera_insights
    insights = generate_estrategico_fallback(metricas)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
app/services/ai/fallback_generator.py:118: in generate_estrategico_fallback
    if rentabilidad_neta >= 30:
       ^^^^^^^^^^^^^^^^^
E   NameError: name 'rentabilidad_neta' is not defined
_______________ test_fallback_estrategico_identifica_disparidad ________________
tests/test_ai_components.py:167: in test_fallback_estrategico_identifica_disparidad
    insights = generate_estrategico_fallback(metricas)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
app/services/ai/fallback_generator.py:118: in generate_estrategico_fallback
    if rentabilidad_neta >= 30:
       ^^^^^^^^^^^^^^^^^
E   NameError: name 'rentabilidad_neta' is not defined
_______________ TestRegister.test_register_exitoso_crea_usuario ________________
tests/test_auth_endpoints.py:201: in test_register_exitoso_crea_usuario
    assert response.status_code == 201
E   assert 401 == 201
E    +  where 401 = <Response [401 Unauthorized]>.status_code
____________ TestRegister.test_register_email_duplicado_retorna_400 ____________
tests/test_auth_endpoints.py:224: in test_register_email_duplicado_retorna_400
    assert response.status_code == 400
E   assert 401 == 400
E    +  where 401 = <Response [401 Unauthorized]>.status_code
_______ TestRegister.test_register_asigna_rol_socio_si_email_autorizado ________
tests/test_auth_endpoints.py:243: in test_register_asigna_rol_socio_si_email_autorizado
    assert response.status_code == 201
E   assert 401 == 201
E    +  where 401 = <Response [401 Unauthorized]>.status_code
___ TestRegister.test_register_asigna_rol_colaborador_si_email_no_autorizado ___
tests/test_auth_endpoints.py:265: in test_register_asigna_rol_colaborador_si_email_no_autorizado
    assert response.status_code == 201
E   assert 401 == 201
E    +  where 401 = <Response [401 Unauthorized]>.status_code
________________ TestRegister.test_register_password_se_hashea _________________
tests/test_auth_endpoints.py:289: in test_register_password_se_hashea
    assert response.status_code == 201
E   assert 401 == 201
E    +  where 401 = <Response [401 Unauthorized]>.status_code
____________ TestRegister.test_register_usuario_activo_por_defecto _____________
tests/test_auth_endpoints.py:310: in test_register_usuario_activo_por_defecto
    assert response.status_code == 201
E   assert 401 == 201
E    +  where 401 = <Response [401 Unauthorized]>.status_code
_________ TestAuthValidation.test_register_email_invalido_retorna_422 __________
tests/test_auth_endpoints.py:362: in test_register_email_invalido_retorna_422
    assert response.status_code == 422
E   assert 401 == 422
E    +  where 401 = <Response [401 Unauthorized]>.status_code
___________ TestAuthValidation.test_register_sin_nombre_retorna_422 ____________
tests/test_auth_endpoints.py:376: in test_register_sin_nombre_retorna_422
    assert response.status_code == 422
E   assert 401 == 422
E    +  where 401 = <Response [401 Unauthorized]>.status_code
__ TestSociosAutorizados.test_todos_los_socios_autorizados_son_socios[aborio] __
tests/test_auth_endpoints.py:401: in test_todos_los_socios_autorizados_son_socios
    assert response.status_code == 201
E   assert 401 == 201
E    +  where 401 = <Response [401 Unauthorized]>.status_code
_ TestSociosAutorizados.test_todos_los_socios_autorizados_son_socios[falgorta] _
tests/test_auth_endpoints.py:401: in test_todos_los_socios_autorizados_son_socios
    assert response.status_code == 201
E   assert 401 == 201
E    +  where 401 = <Response [401 Unauthorized]>.status_code
_ TestSociosAutorizados.test_todos_los_socios_autorizados_son_socios[vcaresani] _
tests/test_auth_endpoints.py:401: in test_todos_los_socios_autorizados_son_socios
    assert response.status_code == 201
E   assert 401 == 201
E    +  where 401 = <Response [401 Unauthorized]>.status_code
_ TestSociosAutorizados.test_todos_los_socios_autorizados_son_socios[gtaborda] _
tests/test_auth_endpoints.py:401: in test_todos_los_socios_autorizados_son_socios
    assert response.status_code == 201
E   assert 401 == 201
E    +  where 401 = <Response [401 Unauthorized]>.status_code
_____________ TestSociosAutorizados.test_prefijo_case_insensitive ______________
tests/test_auth_endpoints.py:419: in test_prefijo_case_insensitive
    assert response.status_code == 201
E   assert 401 == 201
E    +  where 401 = <Response [401 Unauthorized]>.status_code
_______________ TestInicializacion.test_init_con_api_key_valida ________________
tests/test_claude_sql_generator.py:62: in test_init_con_api_key_valida
    assert generator.client is not None
           ^^^^^^^^^^^^^^^^
E   AttributeError: 'ClaudeSQLGenerator' object has no attribute 'client'
----------------------------- Captured stdout call -----------------------------
2025-12-18 11:29:24 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: Claude inicializado
2025-12-18 11:29:24 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: OpenAI inicializado
2025-12-18 11:29:24 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: Gemini inicializado
2025-12-18 11:29:24 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: Proveedores disponibles: Claude, OpenAI, Gemini
2025-12-18 11:29:24 - app.services.claude_sql_generator - INFO - ClaudeSQLGenerator inicializado con AIOrchestrator
------------------------------ Captured log call -------------------------------
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:67 AIOrchestrator: Claude inicializado
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:78 AIOrchestrator: OpenAI inicializado
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:88 AIOrchestrator: Gemini inicializado
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:102 AIOrchestrator: Proveedores disponibles: Claude, OpenAI, Gemini
INFO     app.services.claude_sql_generator:claude_sql_generator.py:353 ClaudeSQLGenerator inicializado con AIOrchestrator
___________________ TestInicializacion.test_init_sin_api_key ___________________
tests/test_claude_sql_generator.py:70: in test_init_sin_api_key
    with pytest.raises(ValueError) as exc_info:
E   Failed: DID NOT RAISE <class 'ValueError'>
----------------------------- Captured stdout call -----------------------------
2025-12-18 11:29:24 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: Claude inicializado
2025-12-18 11:29:24 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: OpenAI inicializado
2025-12-18 11:29:24 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: Gemini inicializado
2025-12-18 11:29:24 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: Proveedores disponibles: Claude, OpenAI, Gemini
2025-12-18 11:29:24 - app.services.claude_sql_generator - INFO - ClaudeSQLGenerator inicializado con AIOrchestrator
------------------------------ Captured log call -------------------------------
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:67 AIOrchestrator: Claude inicializado
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:78 AIOrchestrator: OpenAI inicializado
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:88 AIOrchestrator: Gemini inicializado
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:102 AIOrchestrator: Proveedores disponibles: Claude, OpenAI, Gemini
INFO     app.services.claude_sql_generator:claude_sql_generator.py:353 ClaudeSQLGenerator inicializado con AIOrchestrator
____________ TestInicializacion.test_business_context_con_8_reglas _____________
tests/test_claude_sql_generator.py:113: in test_business_context_con_8_reglas
    assert regla in generator.BUSINESS_CONTEXT, f"Falta regla: {regla}"
E   AssertionError: Falta regla: 7. FILTROS TEMPORALES POR DEFECTO
E   assert '7. FILTROS TEMPORALES POR DEFECTO' in '\nCONTEXTO DEL NEGOCIO - CONEXIÓN CONSULTORA:\n• Consultora uruguaya con 5 socios: Agustina, Viviana, Gonzalo, Pancho y Bruno\n• Opera en 2 localidades: MONTEVIDEO y MERCEDES\n• Áreas de negocio: Jurídica, Notarial, Contable, Recuperación, Gastos Generales, Otros\n• Tipos de operaciones: INGRESO, GASTO, RETIRO, DISTRIBUCION\n• Monedas: UYU (pesos uruguayos) y USD (dólares estadounidenses)\n• Fórmula de rentabilidad: (Ingresos - Gastos) / Ingresos * 100\n• SIEMPRE filtrar deleted_at IS NULL para operaciones activas\n\nREGLAS SQL CRÍTICAS:\n• Si pide "en dólares/USD/dólares": usa monto_usd\n• Si pide "en pesos/UYU": usa monto_uyu\n• Si NO especifica moneda: usa monto_uyu (default)\n• Para rentabilidad: SOLO tipos INGRESO y GASTO (excluir RETIRO y DISTRIBUCION)\n• Para comparaciones "este X vs anterior": usar DATE_TRUNC y LIMIT con ORDER BY DESC\n• Para "mejor/peor": ORDER BY + LIMIT 1\n• Para "cómo venimos/estamos": mostrar ingresos, gastos, resultado y rentabilidad\n• Para "trimestre actual/trimestre fiscal": DATE_TRUNC(\'quarter\', CURRENT_DATE)\n• Para "últimos X meses" (ventana rodante): fecha >= DATE_TRUNC(\'month\', CURRENT_DATE) - INTERVAL \'X months\'\n• Para mes actual: D...   - PostgreSQL NO permite expresiones CASE, funciones o cálculos en ORDER BY después de UNION\n   - Error típico: "invalid UNION/INTERSECT/EXCEPT ORDER BY clause"\n   - SOLO se puede ordenar por:\n     a) Nombre de columna literal del SELECT\n     b) Número de posición de columna (1, 2, 3...)\n     c) Alias de columna definido en los SELECTs\n   - Para comparaciones por año (2024 vs 2025) con distribuciones:\n     * Usar columna auxiliar \'orden\' numérica en cada SELECT\n     * Ordenar por: ORDER BY orden, nombre_columna\n   - Ejemplo CORRECTO (comparar distribuciones 2024 vs 2025):\n     WITH d2024 AS (...), d2025 AS (...)\n     SELECT * FROM (\n       SELECT 0 AS orden, socio, total_2024, total_2025 FROM comparacion\n       UNION ALL\n       SELECT 1 AS orden, \'TOTAL\', SUM(total_2024), SUM(total_2025) FROM comparacion\n     ) t ORDER BY orden, socio\n   - Ejemplo INCORRECTO (genera error):\n     SELECT ... UNION ALL SELECT ...\n     ORDER BY CASE WHEN socio = \'TOTAL\' THEN 1 ELSE 0 END  -- ❌ CASE no permitido\n   - Alternativa simple: Usar subquery para ordenar ANTES del UNION\n\nIMPORTANTE: Si una query viola alguna de estas reglas, usar approach alternativo más seguro.\n'
E    +  where '\nCONTEXTO DEL NEGOCIO - CONEXIÓN CONSULTORA:\n• Consultora uruguaya con 5 socios: Agustina, Viviana, Gonzalo, Pancho y Bruno\n• Opera en 2 localidades: MONTEVIDEO y MERCEDES\n• Áreas de negocio: Jurídica, Notarial, Contable, Recuperación, Gastos Generales, Otros\n• Tipos de operaciones: INGRESO, GASTO, RETIRO, DISTRIBUCION\n• Monedas: UYU (pesos uruguayos) y USD (dólares estadounidenses)\n• Fórmula de rentabilidad: (Ingresos - Gastos) / Ingresos * 100\n• SIEMPRE filtrar deleted_at IS NULL para operaciones activas\n\nREGLAS SQL CRÍTICAS:\n• Si pide "en dólares/USD/dólares": usa monto_usd\n• Si pide "en pesos/UYU": usa monto_uyu\n• Si NO especifica moneda: usa monto_uyu (default)\n• Para rentabilidad: SOLO tipos INGRESO y GASTO (excluir RETIRO y DISTRIBUCION)\n• Para comparaciones "este X vs anterior": usar DATE_TRUNC y LIMIT con ORDER BY DESC\n• Para "mejor/peor": ORDER BY + LIMIT 1\n• Para "cómo venimos/estamos": mostrar ingresos, gastos, resultado y rentabilidad\n• Para "trimestre actual/trimestre fiscal": DATE_TRUNC(\'quarter\', CURRENT_DATE)\n• Para "últimos X meses" (ventana rodante): fecha >= DATE_TRUNC(\'month\', CURRENT_DATE) - INTERVAL \'X months\'\n• Para mes actual: D...   - PostgreSQL NO permite expresiones CASE, funciones o cálculos en ORDER BY después de UNION\n   - Error típico: "invalid UNION/INTERSECT/EXCEPT ORDER BY clause"\n   - SOLO se puede ordenar por:\n     a) Nombre de columna literal del SELECT\n     b) Número de posición de columna (1, 2, 3...)\n     c) Alias de columna definido en los SELECTs\n   - Para comparaciones por año (2024 vs 2025) con distribuciones:\n     * Usar columna auxiliar \'orden\' numérica en cada SELECT\n     * Ordenar por: ORDER BY orden, nombre_columna\n   - Ejemplo CORRECTO (comparar distribuciones 2024 vs 2025):\n     WITH d2024 AS (...), d2025 AS (...)\n     SELECT * FROM (\n       SELECT 0 AS orden, socio, total_2024, total_2025 FROM comparacion\n       UNION ALL\n       SELECT 1 AS orden, \'TOTAL\', SUM(total_2024), SUM(total_2025) FROM comparacion\n     ) t ORDER BY orden, socio\n   - Ejemplo INCORRECTO (genera error):\n     SELECT ... UNION ALL SELECT ...\n     ORDER BY CASE WHEN socio = \'TOTAL\' THEN 1 ELSE 0 END  -- ❌ CASE no permitido\n   - Alternativa simple: Usar subquery para ordenar ANTES del UNION\n\nIMPORTANTE: Si una query viola alguna de estas reglas, usar approach alternativo más seguro.\n' = <app.services.claude_sql_generator.ClaudeSQLGenerator object at 0x7f6ccf805040>.BUSINESS_CONTEXT
----------------------------- Captured stdout call -----------------------------
2025-12-18 11:29:24 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: Claude inicializado
2025-12-18 11:29:24 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: OpenAI inicializado
2025-12-18 11:29:24 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: Gemini inicializado
2025-12-18 11:29:24 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: Proveedores disponibles: Claude, OpenAI, Gemini
2025-12-18 11:29:24 - app.services.claude_sql_generator - INFO - ClaudeSQLGenerator inicializado con AIOrchestrator
------------------------------ Captured log call -------------------------------
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:67 AIOrchestrator: Claude inicializado
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:78 AIOrchestrator: OpenAI inicializado
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:88 AIOrchestrator: Gemini inicializado
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:102 AIOrchestrator: Proveedores disponibles: Claude, OpenAI, Gemini
INFO     app.services.claude_sql_generator:claude_sql_generator.py:353 ClaudeSQLGenerator inicializado con AIOrchestrator
__________________ TestGenerarSQL.test_generar_sql_error_api ___________________
tests/test_claude_sql_generator.py:165: in test_generar_sql_error_api
    assert sql.startswith("ERROR:")
E   AssertionError: assert False
E    +  where False = <built-in method startswith of str object at 0x7f6ccef0acb0>('ERROR:')
E    +    where <built-in method startswith of str object at 0x7f6ccef0acb0> = 'SELECT 1;'.startswith
---------------------------- Captured stdout setup -----------------------------
2025-12-18 11:29:24 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: Claude inicializado
2025-12-18 11:29:24 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: OpenAI inicializado
2025-12-18 11:29:24 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: Gemini inicializado
2025-12-18 11:29:24 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: Proveedores disponibles: Claude, OpenAI, Gemini
2025-12-18 11:29:24 - app.services.claude_sql_generator - INFO - ClaudeSQLGenerator inicializado con AIOrchestrator
------------------------------ Captured log setup ------------------------------
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:67 AIOrchestrator: Claude inicializado
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:78 AIOrchestrator: OpenAI inicializado
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:88 AIOrchestrator: Gemini inicializado
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:102 AIOrchestrator: Proveedores disponibles: Claude, OpenAI, Gemini
INFO     app.services.claude_sql_generator:claude_sql_generator.py:353 ClaudeSQLGenerator inicializado con AIOrchestrator
----------------------------- Captured stdout call -----------------------------
2025-12-18 11:29:24 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: Intentando Claude (claude-sonnet-4-5-20250929)
2025-12-18 11:29:24 - app.services.ai.ai_orchestrator - WARNING - AIOrchestrator: Claude falló (Exception): API Connection Error
2025-12-18 11:29:24 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: Intentando OpenAI (gpt-3.5-turbo)
2025-12-18 11:29:29 - app.services.ai.ai_orchestrator - WARNING - AIOrchestrator: OpenAI falló (RateLimitError): Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}
2025-12-18 11:29:29 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: Intentando Gemini (gemini-2.0-flash)
2025-12-18 11:29:30 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: Gemini respondió (10 chars)
2025-12-18 11:29:30 - app.services.claude_sql_generator - INFO - SQL generado con 0 mensajes de contexto
----------------------------- Captured stderr call -----------------------------
WARNING: All log messages before absl::InitializeLog() is called are written to STDERR
E0000 00:00:1766068169.486686     626 alts_credentials.cc:93] ALTS creds ignored. Not running on GCP and untrusted ALTS is not enabled.
------------------------------ Captured log call -------------------------------
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:162 AIOrchestrator: Intentando Claude (claude-sonnet-4-5-20250929)
WARNING  app.services.ai.ai_orchestrator:ai_orchestrator.py:183 AIOrchestrator: Claude falló (Exception): API Connection Error
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:196 AIOrchestrator: Intentando OpenAI (gpt-3.5-turbo)
WARNING  app.services.ai.ai_orchestrator:ai_orchestrator.py:218 AIOrchestrator: OpenAI falló (RateLimitError): Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:231 AIOrchestrator: Intentando Gemini (gemini-2.0-flash)
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:252 AIOrchestrator: Gemini respondió (10 chars)
INFO     app.services.claude_sql_generator:claude_sql_generator.py:416 SQL generado con 0 mensajes de contexto
___________________ TestGenerarSQL.test_generar_sql_timeout ____________________
tests/test_claude_sql_generator.py:178: in test_generar_sql_timeout
    assert sql.startswith("ERROR:")
E   AssertionError: assert False
E    +  where False = <built-in method startswith of str object at 0x7f6ccc10c2b0>('ERROR:')
E    +    where <built-in method startswith of str object at 0x7f6ccc10c2b0> = 'SELECT 1;'.startswith
---------------------------- Captured stdout setup -----------------------------
2025-12-18 11:29:30 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: Claude inicializado
2025-12-18 11:29:30 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: OpenAI inicializado
2025-12-18 11:29:30 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: Gemini inicializado
2025-12-18 11:29:30 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: Proveedores disponibles: Claude, OpenAI, Gemini
2025-12-18 11:29:30 - app.services.claude_sql_generator - INFO - ClaudeSQLGenerator inicializado con AIOrchestrator
------------------------------ Captured log setup ------------------------------
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:67 AIOrchestrator: Claude inicializado
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:78 AIOrchestrator: OpenAI inicializado
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:88 AIOrchestrator: Gemini inicializado
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:102 AIOrchestrator: Proveedores disponibles: Claude, OpenAI, Gemini
INFO     app.services.claude_sql_generator:claude_sql_generator.py:353 ClaudeSQLGenerator inicializado con AIOrchestrator
----------------------------- Captured stdout call -----------------------------
2025-12-18 11:29:30 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: Intentando Claude (claude-sonnet-4-5-20250929)
2025-12-18 11:29:30 - app.services.ai.ai_orchestrator - WARNING - AIOrchestrator: Claude falló (Exception): Timeout
2025-12-18 11:29:30 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: Intentando OpenAI (gpt-3.5-turbo)
2025-12-18 11:29:34 - app.services.ai.ai_orchestrator - WARNING - AIOrchestrator: OpenAI falló (RateLimitError): Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}
2025-12-18 11:29:34 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: Intentando Gemini (gemini-2.0-flash)
2025-12-18 11:29:36 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: Gemini respondió (10 chars)
2025-12-18 11:29:36 - app.services.claude_sql_generator - INFO - SQL generado con 0 mensajes de contexto
----------------------------- Captured stderr call -----------------------------
E0000 00:00:1766068174.415763     626 alts_credentials.cc:93] ALTS creds ignored. Not running on GCP and untrusted ALTS is not enabled.
------------------------------ Captured log call -------------------------------
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:162 AIOrchestrator: Intentando Claude (claude-sonnet-4-5-20250929)
WARNING  app.services.ai.ai_orchestrator:ai_orchestrator.py:183 AIOrchestrator: Claude falló (Exception): Timeout
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:196 AIOrchestrator: Intentando OpenAI (gpt-3.5-turbo)
WARNING  app.services.ai.ai_orchestrator:ai_orchestrator.py:218 AIOrchestrator: OpenAI falló (RateLimitError): Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:231 AIOrchestrator: Intentando Gemini (gemini-2.0-flash)
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:252 AIOrchestrator: Gemini respondió (10 chars)
INFO     app.services.claude_sql_generator:claude_sql_generator.py:416 SQL generado con 0 mensajes de contexto
__________________ TestGenerarSQL.test_generar_sql_rate_limit __________________
tests/test_claude_sql_generator.py:190: in test_generar_sql_rate_limit
    assert sql.startswith("ERROR:")
E   AssertionError: assert False
E    +  where False = <built-in method startswith of str object at 0x7f6ccef01e30>('ERROR:')
E    +    where <built-in method startswith of str object at 0x7f6ccef01e30> = 'SELECT 1;'.startswith
---------------------------- Captured stdout setup -----------------------------
2025-12-18 11:29:36 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: Claude inicializado
2025-12-18 11:29:36 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: OpenAI inicializado
2025-12-18 11:29:36 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: Gemini inicializado
2025-12-18 11:29:36 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: Proveedores disponibles: Claude, OpenAI, Gemini
2025-12-18 11:29:36 - app.services.claude_sql_generator - INFO - ClaudeSQLGenerator inicializado con AIOrchestrator
------------------------------ Captured log setup ------------------------------
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:67 AIOrchestrator: Claude inicializado
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:78 AIOrchestrator: OpenAI inicializado
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:88 AIOrchestrator: Gemini inicializado
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:102 AIOrchestrator: Proveedores disponibles: Claude, OpenAI, Gemini
INFO     app.services.claude_sql_generator:claude_sql_generator.py:353 ClaudeSQLGenerator inicializado con AIOrchestrator
----------------------------- Captured stdout call -----------------------------
2025-12-18 11:29:36 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: Intentando Claude (claude-sonnet-4-5-20250929)
2025-12-18 11:29:36 - app.services.ai.ai_orchestrator - WARNING - AIOrchestrator: Claude falló (Exception): Rate limit exceeded
2025-12-18 11:29:36 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: Intentando OpenAI (gpt-3.5-turbo)
2025-12-18 11:29:39 - app.services.ai.ai_orchestrator - WARNING - AIOrchestrator: OpenAI falló (RateLimitError): Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}
2025-12-18 11:29:39 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: Intentando Gemini (gemini-2.0-flash)
2025-12-18 11:29:40 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: Gemini respondió (10 chars)
2025-12-18 11:29:40 - app.services.claude_sql_generator - INFO - SQL generado con 0 mensajes de contexto
----------------------------- Captured stderr call -----------------------------
E0000 00:00:1766068179.181013     626 alts_credentials.cc:93] ALTS creds ignored. Not running on GCP and untrusted ALTS is not enabled.
------------------------------ Captured log call -------------------------------
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:162 AIOrchestrator: Intentando Claude (claude-sonnet-4-5-20250929)
WARNING  app.services.ai.ai_orchestrator:ai_orchestrator.py:183 AIOrchestrator: Claude falló (Exception): Rate limit exceeded
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:196 AIOrchestrator: Intentando OpenAI (gpt-3.5-turbo)
WARNING  app.services.ai.ai_orchestrator:ai_orchestrator.py:218 AIOrchestrator: OpenAI falló (RateLimitError): Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:231 AIOrchestrator: Intentando Gemini (gemini-2.0-flash)
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:252 AIOrchestrator: Gemini respondió (10 chars)
INFO     app.services.claude_sql_generator:claude_sql_generator.py:416 SQL generado con 0 mensajes de contexto
_____________ TestGenerarSQL.test_generar_sql_parametros_correctos _____________
tests/test_claude_sql_generator.py:207: in test_generar_sql_parametros_correctos
    assert call_args.kwargs['max_tokens'] == 1500
E   assert 4000 == 1500
---------------------------- Captured stdout setup -----------------------------
2025-12-18 11:29:40 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: Claude inicializado
2025-12-18 11:29:40 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: OpenAI inicializado
2025-12-18 11:29:40 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: Gemini inicializado
2025-12-18 11:29:40 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: Proveedores disponibles: Claude, OpenAI, Gemini
2025-12-18 11:29:40 - app.services.claude_sql_generator - INFO - ClaudeSQLGenerator inicializado con AIOrchestrator
------------------------------ Captured log setup ------------------------------
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:67 AIOrchestrator: Claude inicializado
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:78 AIOrchestrator: OpenAI inicializado
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:88 AIOrchestrator: Gemini inicializado
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:102 AIOrchestrator: Proveedores disponibles: Claude, OpenAI, Gemini
INFO     app.services.claude_sql_generator:claude_sql_generator.py:353 ClaudeSQLGenerator inicializado con AIOrchestrator
----------------------------- Captured stdout call -----------------------------
2025-12-18 11:29:40 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: Intentando Claude (claude-sonnet-4-5-20250929)
2025-12-18 11:29:40 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: Claude respondió (63 chars)
2025-12-18 11:29:40 - app.services.claude_sql_generator - INFO - SQL generado con 0 mensajes de contexto
------------------------------ Captured log call -------------------------------
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:162 AIOrchestrator: Intentando Claude (claude-sonnet-4-5-20250929)
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:178 AIOrchestrator: Claude respondió (63 chars)
INFO     app.services.claude_sql_generator:claude_sql_generator.py:416 SQL generado con 0 mensajes de contexto
_________________ TestContextoYPrompt.test_prompt_incluye_ddl __________________
tests/test_claude_sql_generator.py:241: in test_prompt_incluye_ddl
    prompt = call_args.kwargs['messages'][0]['content']
             ^^^^^^^^^^^^^^^^
E   AttributeError: 'NoneType' object has no attribute 'kwargs'
----------------------------- Captured stdout call -----------------------------
2025-12-18 11:29:40 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: Claude inicializado
2025-12-18 11:29:41 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: OpenAI inicializado
2025-12-18 11:29:41 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: Gemini inicializado
2025-12-18 11:29:41 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: Proveedores disponibles: Claude, OpenAI, Gemini
2025-12-18 11:29:41 - app.services.claude_sql_generator - INFO - ClaudeSQLGenerator inicializado con AIOrchestrator
2025-12-18 11:29:41 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: Intentando Claude (claude-sonnet-4-5-20250929)
2025-12-18 11:29:41 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: Claude respondió (0 chars)
2025-12-18 11:29:41 - app.services.claude_sql_generator - INFO - SQL generado con 0 mensajes de contexto
------------------------------ Captured log call -------------------------------
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:67 AIOrchestrator: Claude inicializado
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:78 AIOrchestrator: OpenAI inicializado
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:88 AIOrchestrator: Gemini inicializado
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:102 AIOrchestrator: Proveedores disponibles: Claude, OpenAI, Gemini
INFO     app.services.claude_sql_generator:claude_sql_generator.py:353 ClaudeSQLGenerator inicializado con AIOrchestrator
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:162 AIOrchestrator: Intentando Claude (claude-sonnet-4-5-20250929)
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:178 AIOrchestrator: Claude respondió (0 chars)
INFO     app.services.claude_sql_generator:claude_sql_generator.py:416 SQL generado con 0 mensajes de contexto
___________ TestContextoYPrompt.test_prompt_incluye_business_context ___________
tests/test_claude_sql_generator.py:268: in test_prompt_incluye_business_context
    prompt = call_args.kwargs['messages'][0]['content']
             ^^^^^^^^^^^^^^^^
E   AttributeError: 'NoneType' object has no attribute 'kwargs'
----------------------------- Captured stdout call -----------------------------
2025-12-18 11:29:41 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: Claude inicializado
2025-12-18 11:29:41 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: OpenAI inicializado
2025-12-18 11:29:41 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: Gemini inicializado
2025-12-18 11:29:41 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: Proveedores disponibles: Claude, OpenAI, Gemini
2025-12-18 11:29:41 - app.services.claude_sql_generator - INFO - ClaudeSQLGenerator inicializado con AIOrchestrator
2025-12-18 11:29:41 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: Intentando Claude (claude-sonnet-4-5-20250929)
2025-12-18 11:29:41 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: Claude respondió (0 chars)
2025-12-18 11:29:41 - app.services.claude_sql_generator - INFO - SQL generado con 0 mensajes de contexto
------------------------------ Captured log call -------------------------------
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:67 AIOrchestrator: Claude inicializado
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:78 AIOrchestrator: OpenAI inicializado
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:88 AIOrchestrator: Gemini inicializado
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:102 AIOrchestrator: Proveedores disponibles: Claude, OpenAI, Gemini
INFO     app.services.claude_sql_generator:claude_sql_generator.py:353 ClaudeSQLGenerator inicializado con AIOrchestrator
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:162 AIOrchestrator: Intentando Claude (claude-sonnet-4-5-20250929)
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:178 AIOrchestrator: Claude respondió (0 chars)
INFO     app.services.claude_sql_generator:claude_sql_generator.py:416 SQL generado con 0 mensajes de contexto
___________ TestContextoYPrompt.test_prompt_incluye_pregunta_usuario ___________
tests/test_claude_sql_generator.py:296: in test_prompt_incluye_pregunta_usuario
    prompt = call_args.kwargs['messages'][0]['content']
             ^^^^^^^^^^^^^^^^
E   AttributeError: 'NoneType' object has no attribute 'kwargs'
----------------------------- Captured stdout call -----------------------------
2025-12-18 11:29:41 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: Claude inicializado
2025-12-18 11:29:41 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: OpenAI inicializado
2025-12-18 11:29:41 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: Gemini inicializado
2025-12-18 11:29:41 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: Proveedores disponibles: Claude, OpenAI, Gemini
2025-12-18 11:29:41 - app.services.claude_sql_generator - INFO - ClaudeSQLGenerator inicializado con AIOrchestrator
2025-12-18 11:29:41 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: Intentando Claude (claude-sonnet-4-5-20250929)
2025-12-18 11:29:41 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: Claude respondió (0 chars)
2025-12-18 11:29:41 - app.services.claude_sql_generator - INFO - SQL generado con 0 mensajes de contexto
------------------------------ Captured log call -------------------------------
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:67 AIOrchestrator: Claude inicializado
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:78 AIOrchestrator: OpenAI inicializado
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:88 AIOrchestrator: Gemini inicializado
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:102 AIOrchestrator: Proveedores disponibles: Claude, OpenAI, Gemini
INFO     app.services.claude_sql_generator:claude_sql_generator.py:353 ClaudeSQLGenerator inicializado con AIOrchestrator
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:162 AIOrchestrator: Intentando Claude (claude-sonnet-4-5-20250929)
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:178 AIOrchestrator: Claude respondió (0 chars)
INFO     app.services.claude_sql_generator:claude_sql_generator.py:416 SQL generado con 0 mensajes de contexto
_________________ TestManejoErrores.test_api_connection_error __________________
tests/test_claude_sql_generator.py:438: in test_api_connection_error
    assert sql.startswith("ERROR:")
E   AssertionError: assert False
E    +  where False = <built-in method startswith of str object at 0x7f6cc478efb0>('ERROR:')
E    +    where <built-in method startswith of str object at 0x7f6cc478efb0> = 'SELECT 1;'.startswith
---------------------------- Captured stdout setup -----------------------------
2025-12-18 11:29:41 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: Claude inicializado
2025-12-18 11:29:41 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: OpenAI inicializado
2025-12-18 11:29:41 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: Gemini inicializado
2025-12-18 11:29:41 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: Proveedores disponibles: Claude, OpenAI, Gemini
2025-12-18 11:29:41 - app.services.claude_sql_generator - INFO - ClaudeSQLGenerator inicializado con AIOrchestrator
------------------------------ Captured log setup ------------------------------
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:67 AIOrchestrator: Claude inicializado
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:78 AIOrchestrator: OpenAI inicializado
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:88 AIOrchestrator: Gemini inicializado
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:102 AIOrchestrator: Proveedores disponibles: Claude, OpenAI, Gemini
INFO     app.services.claude_sql_generator:claude_sql_generator.py:353 ClaudeSQLGenerator inicializado con AIOrchestrator
----------------------------- Captured stdout call -----------------------------
2025-12-18 11:29:41 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: Intentando Claude (claude-sonnet-4-5-20250929)
2025-12-18 11:29:41 - app.services.ai.ai_orchestrator - WARNING - AIOrchestrator: Claude falló (Exception): Connection failed
2025-12-18 11:29:41 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: Intentando OpenAI (gpt-3.5-turbo)
2025-12-18 11:29:44 - app.services.ai.ai_orchestrator - WARNING - AIOrchestrator: OpenAI falló (RateLimitError): Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}
2025-12-18 11:29:44 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: Intentando Gemini (gemini-2.0-flash)
2025-12-18 11:29:45 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: Gemini respondió (10 chars)
2025-12-18 11:29:45 - app.services.claude_sql_generator - INFO - SQL generado con 0 mensajes de contexto
----------------------------- Captured stderr call -----------------------------
E0000 00:00:1766068184.310853     626 alts_credentials.cc:93] ALTS creds ignored. Not running on GCP and untrusted ALTS is not enabled.
------------------------------ Captured log call -------------------------------
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:162 AIOrchestrator: Intentando Claude (claude-sonnet-4-5-20250929)
WARNING  app.services.ai.ai_orchestrator:ai_orchestrator.py:183 AIOrchestrator: Claude falló (Exception): Connection failed
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:196 AIOrchestrator: Intentando OpenAI (gpt-3.5-turbo)
WARNING  app.services.ai.ai_orchestrator:ai_orchestrator.py:218 AIOrchestrator: OpenAI falló (RateLimitError): Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:231 AIOrchestrator: Intentando Gemini (gemini-2.0-flash)
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:252 AIOrchestrator: Gemini respondió (10 chars)
INFO     app.services.claude_sql_generator:claude_sql_generator.py:416 SQL generado con 0 mensajes de contexto
_________________ TestManejoErrores.test_authentication_error __________________
tests/test_claude_sql_generator.py:451: in test_authentication_error
    assert sql.startswith("ERROR:")
E   AssertionError: assert False
E    +  where False = <built-in method startswith of str object at 0x7f6cc47aa730>('ERROR:')
E    +    where <built-in method startswith of str object at 0x7f6cc47aa730> = 'SELECT 1;'.startswith
---------------------------- Captured stdout setup -----------------------------
2025-12-18 11:29:45 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: Claude inicializado
2025-12-18 11:29:45 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: OpenAI inicializado
2025-12-18 11:29:45 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: Gemini inicializado
2025-12-18 11:29:45 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: Proveedores disponibles: Claude, OpenAI, Gemini
2025-12-18 11:29:45 - app.services.claude_sql_generator - INFO - ClaudeSQLGenerator inicializado con AIOrchestrator
------------------------------ Captured log setup ------------------------------
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:67 AIOrchestrator: Claude inicializado
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:78 AIOrchestrator: OpenAI inicializado
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:88 AIOrchestrator: Gemini inicializado
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:102 AIOrchestrator: Proveedores disponibles: Claude, OpenAI, Gemini
INFO     app.services.claude_sql_generator:claude_sql_generator.py:353 ClaudeSQLGenerator inicializado con AIOrchestrator
----------------------------- Captured stdout call -----------------------------
2025-12-18 11:29:45 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: Intentando Claude (claude-sonnet-4-5-20250929)
2025-12-18 11:29:45 - app.services.ai.ai_orchestrator - WARNING - AIOrchestrator: Claude falló (Exception): Invalid API key
2025-12-18 11:29:45 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: Intentando OpenAI (gpt-3.5-turbo)
2025-12-18 11:29:48 - app.services.ai.ai_orchestrator - WARNING - AIOrchestrator: OpenAI falló (RateLimitError): Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}
2025-12-18 11:29:48 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: Intentando Gemini (gemini-2.0-flash)
2025-12-18 11:29:50 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: Gemini respondió (10 chars)
2025-12-18 11:29:50 - app.services.claude_sql_generator - INFO - SQL generado con 0 mensajes de contexto
----------------------------- Captured stderr call -----------------------------
E0000 00:00:1766068188.458385     626 alts_credentials.cc:93] ALTS creds ignored. Not running on GCP and untrusted ALTS is not enabled.
------------------------------ Captured log call -------------------------------
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:162 AIOrchestrator: Intentando Claude (claude-sonnet-4-5-20250929)
WARNING  app.services.ai.ai_orchestrator:ai_orchestrator.py:183 AIOrchestrator: Claude falló (Exception): Invalid API key
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:196 AIOrchestrator: Intentando OpenAI (gpt-3.5-turbo)
WARNING  app.services.ai.ai_orchestrator:ai_orchestrator.py:218 AIOrchestrator: OpenAI falló (RateLimitError): Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:231 AIOrchestrator: Intentando Gemini (gemini-2.0-flash)
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:252 AIOrchestrator: Gemini respondió (10 chars)
INFO     app.services.claude_sql_generator:claude_sql_generator.py:416 SQL generado con 0 mensajes de contexto
_________________ TestManejoErrores.test_respuesta_sin_content _________________
tests/test_claude_sql_generator.py:484: in test_respuesta_sin_content
    assert sql.startswith("ERROR:")
E   AssertionError: assert False
E    +  where False = <built-in method startswith of str object at 0x7f6ccfac58f0>('ERROR:')
E    +    where <built-in method startswith of str object at 0x7f6ccfac58f0> = 'SELECT 1;'.startswith
---------------------------- Captured stdout setup -----------------------------
2025-12-18 11:29:54 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: Claude inicializado
2025-12-18 11:29:54 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: OpenAI inicializado
2025-12-18 11:29:54 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: Gemini inicializado
2025-12-18 11:29:54 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: Proveedores disponibles: Claude, OpenAI, Gemini
2025-12-18 11:29:54 - app.services.claude_sql_generator - INFO - ClaudeSQLGenerator inicializado con AIOrchestrator
------------------------------ Captured log setup ------------------------------
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:67 AIOrchestrator: Claude inicializado
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:78 AIOrchestrator: OpenAI inicializado
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:88 AIOrchestrator: Gemini inicializado
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:102 AIOrchestrator: Proveedores disponibles: Claude, OpenAI, Gemini
INFO     app.services.claude_sql_generator:claude_sql_generator.py:353 ClaudeSQLGenerator inicializado con AIOrchestrator
----------------------------- Captured stdout call -----------------------------
2025-12-18 11:29:54 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: Intentando Claude (claude-sonnet-4-5-20250929)
2025-12-18 11:29:54 - app.services.ai.ai_orchestrator - WARNING - AIOrchestrator: Claude falló (IndexError): list index out of range
2025-12-18 11:29:54 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: Intentando OpenAI (gpt-3.5-turbo)
2025-12-18 11:29:57 - app.services.ai.ai_orchestrator - WARNING - AIOrchestrator: OpenAI falló (RateLimitError): Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}
2025-12-18 11:29:57 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: Intentando Gemini (gemini-2.0-flash)
2025-12-18 11:29:58 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: Gemini respondió (10 chars)
2025-12-18 11:29:58 - app.services.claude_sql_generator - INFO - SQL generado con 0 mensajes de contexto
----------------------------- Captured stderr call -----------------------------
E0000 00:00:1766068197.013093     626 alts_credentials.cc:93] ALTS creds ignored. Not running on GCP and untrusted ALTS is not enabled.
------------------------------ Captured log call -------------------------------
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:162 AIOrchestrator: Intentando Claude (claude-sonnet-4-5-20250929)
WARNING  app.services.ai.ai_orchestrator:ai_orchestrator.py:183 AIOrchestrator: Claude falló (IndexError): list index out of range
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:196 AIOrchestrator: Intentando OpenAI (gpt-3.5-turbo)
WARNING  app.services.ai.ai_orchestrator:ai_orchestrator.py:218 AIOrchestrator: OpenAI falló (RateLimitError): Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:231 AIOrchestrator: Intentando Gemini (gemini-2.0-flash)
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:252 AIOrchestrator: Gemini respondió (10 chars)
INFO     app.services.claude_sql_generator:claude_sql_generator.py:416 SQL generado con 0 mensajes de contexto
_______ TestChainOfThoughtIntegration.test_obtener_metadatos_temporales ________
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: in do_execute
    cursor.execute(statement, parameters)
E   psycopg2.errors.UndefinedTable: relation "operaciones" does not exist
E   LINE 7:      FROM operaciones
E                     ^

The above exception was the direct cause of the following exception:
tests/test_integration.py:76: in test_obtener_metadatos_temporales
    result = db_session.execute(text(sql_metadatos))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2362: in execute
    return self._execute_internal(
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2256: in _execute_internal
    result = conn.execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1418: in execute
    return meth(
venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:515: in _execute_on_connection
    return connection._execute_clauseelement(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1640: in _execute_clauseelement
    ret = self._execute_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "operaciones" does not exist
E   LINE 7:      FROM operaciones
E                     ^
E   
E   [SQL: 
E   SELECT 
E       CURRENT_DATE as fecha_actual,
E       EXTRACT(YEAR FROM CURRENT_DATE)::int as año_actual,
E       EXTRACT(MONTH FROM CURRENT_DATE)::int as mes_actual,
E       (SELECT COUNT(DISTINCT DATE_TRUNC('month', fecha))
E        FROM operaciones
E        WHERE deleted_at IS NULL
E          AND DATE_TRUNC('year', fecha) = DATE_TRUNC('year', CURRENT_DATE)) as meses_con_datos_2025,
E       12 - EXTRACT(MONTH FROM CURRENT_DATE)::int as meses_restantes_2025,
E       (SELECT MAX(DATE_TRUNC('month', fecha))
E        FROM operaciones
E        WHERE deleted_at IS NULL) as ultimo_mes_con_datos,
E       (SELECT MIN(DATE_TRUNC('month', fecha))
E        FROM operaciones
E        WHERE deleted_at IS NULL
E          AND DATE_TRUNC('year', fecha) = DATE_TRUNC('year', CURRENT_DATE)) as primer_mes_con_datos_2025
E   ]
E   (Background on this error at: https://sqlalche.me/e/20/f405)
_________ TestChainOfThoughtIntegration.test_generar_con_cot_completo __________
tests/test_integration.py:127: in test_generar_con_cot_completo
    assert resultado['exito'] is True
E   assert False is True
----------------------------- Captured stdout call -----------------------------
2025-12-18 11:30:01 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: Claude inicializado
2025-12-18 11:30:01 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: OpenAI inicializado
2025-12-18 11:30:01 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: Gemini inicializado
2025-12-18 11:30:01 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: Proveedores disponibles: Claude, OpenAI, Gemini
2025-12-18 11:30:01 - app.services.claude_sql_generator - INFO - ClaudeSQLGenerator inicializado con AIOrchestrator
2025-12-18 11:30:01 - app.services.chain_of_thought_sql - INFO - Chain-of-Thought detectada pregunta temporal compleja
2025-12-18 11:30:01 - app.services.chain_of_thought_sql - INFO - Chain-of-Thought obteniendo metadatos temporales
2025-12-18 11:30:01 - app.services.chain_of_thought_sql - ERROR - Error en Chain-of-Thought: (psycopg2.errors.UndefinedTable) relation "operaciones" does not exist
LINE 7:      FROM operaciones
                  ^

[SQL: 
SELECT 
    CURRENT_DATE as fecha_actual,
    EXTRACT(YEAR FROM CURRENT_DATE)::int as año_actual,
    EXTRACT(MONTH FROM CURRENT_DATE)::int as mes_actual,
    (SELECT COUNT(DISTINCT DATE_TRUNC('month', fecha))
     FROM operaciones
     WHERE deleted_at IS NULL
       AND DATE_TRUNC('year', fecha) = DATE_TRUNC('year', CURRENT_DATE)) as meses_con_datos_2025,
    12 - EXTRACT(MONTH FROM CURRENT_DATE)::int as meses_restantes_2025,
    (SELECT MAX(DATE_TRUNC('month', fecha))
     FROM operaciones
     WHERE deleted_at IS NULL) as ultimo_mes_con_datos,
    (SELECT MIN(DATE_TRUNC('month', fecha))
     FROM operaciones
     WHERE deleted_at IS NULL
       AND DATE_TRUNC('year', fecha) = DATE_TRUNC('year', CURRENT_DATE)) as primer_mes_con_datos_2025
]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):
  File "/home/brunogandolfo/cfo-inteligente/backend/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/brunogandolfo/cfo-inteligente/backend/venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.UndefinedTable: relation "operaciones" does not exist
LINE 7:      FROM operaciones
                  ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/brunogandolfo/cfo-inteligente/backend/app/services/chain_of_thought_sql.py", line 211, in generar_con_chain_of_thought
    result = db_session.execute(text(sql_metadatos))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brunogandolfo/cfo-inteligente/backend/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2362, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brunogandolfo/cfo-inteligente/backend/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2256, in _execute_internal
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/home/brunogandolfo/cfo-inteligente/backend/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
           ^^^^^
  File "/home/brunogandolfo/cfo-inteligente/backend/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brunogandolfo/cfo-inteligente/backend/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brunogandolfo/cfo-inteligente/backend/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brunogandolfo/cfo-inteligente/backend/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/brunogandolfo/cfo-inteligente/backend/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/brunogandolfo/cfo-inteligente/backend/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/brunogandolfo/cfo-inteligente/backend/venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "operaciones" does not exist
LINE 7:      FROM operaciones
                  ^

[SQL: 
SELECT 
    CURRENT_DATE as fecha_actual,
    EXTRACT(YEAR FROM CURRENT_DATE)::int as año_actual,
    EXTRACT(MONTH FROM CURRENT_DATE)::int as mes_actual,
    (SELECT COUNT(DISTINCT DATE_TRUNC('month', fecha))
     FROM operaciones
     WHERE deleted_at IS NULL
       AND DATE_TRUNC('year', fecha) = DATE_TRUNC('year', CURRENT_DATE)) as meses_con_datos_2025,
    12 - EXTRACT(MONTH FROM CURRENT_DATE)::int as meses_restantes_2025,
    (SELECT MAX(DATE_TRUNC('month', fecha))
     FROM operaciones
     WHERE deleted_at IS NULL) as ultimo_mes_con_datos,
    (SELECT MIN(DATE_TRUNC('month', fecha))
     FROM operaciones
     WHERE deleted_at IS NULL
       AND DATE_TRUNC('year', fecha) = DATE_TRUNC('year', CURRENT_DATE)) as primer_mes_con_datos_2025
]
(Background on this error at: https://sqlalche.me/e/20/f405)
------------------------------ Captured log call -------------------------------
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:67 AIOrchestrator: Claude inicializado
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:78 AIOrchestrator: OpenAI inicializado
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:88 AIOrchestrator: Gemini inicializado
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:102 AIOrchestrator: Proveedores disponibles: Claude, OpenAI, Gemini
INFO     app.services.claude_sql_generator:claude_sql_generator.py:353 ClaudeSQLGenerator inicializado con AIOrchestrator
INFO     app.services.chain_of_thought_sql:chain_of_thought_sql.py:203 Chain-of-Thought detectada pregunta temporal compleja
INFO     app.services.chain_of_thought_sql:chain_of_thought_sql.py:208 Chain-of-Thought obteniendo metadatos temporales
ERROR    app.services.chain_of_thought_sql:chain_of_thought_sql.py:243 Error en Chain-of-Thought: (psycopg2.errors.UndefinedTable) relation "operaciones" does not exist
LINE 7:      FROM operaciones
                  ^

[SQL: 
SELECT 
    CURRENT_DATE as fecha_actual,
    EXTRACT(YEAR FROM CURRENT_DATE)::int as año_actual,
    EXTRACT(MONTH FROM CURRENT_DATE)::int as mes_actual,
    (SELECT COUNT(DISTINCT DATE_TRUNC('month', fecha))
     FROM operaciones
     WHERE deleted_at IS NULL
       AND DATE_TRUNC('year', fecha) = DATE_TRUNC('year', CURRENT_DATE)) as meses_con_datos_2025,
    12 - EXTRACT(MONTH FROM CURRENT_DATE)::int as meses_restantes_2025,
    (SELECT MAX(DATE_TRUNC('month', fecha))
     FROM operaciones
     WHERE deleted_at IS NULL) as ultimo_mes_con_datos,
    (SELECT MIN(DATE_TRUNC('month', fecha))
     FROM operaciones
     WHERE deleted_at IS NULL
       AND DATE_TRUNC('year', fecha) = DATE_TRUNC('year', CURRENT_DATE)) as primer_mes_con_datos_2025
]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):
  File "/home/brunogandolfo/cfo-inteligente/backend/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/brunogandolfo/cfo-inteligente/backend/venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.UndefinedTable: relation "operaciones" does not exist
LINE 7:      FROM operaciones
                  ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/brunogandolfo/cfo-inteligente/backend/app/services/chain_of_thought_sql.py", line 211, in generar_con_chain_of_thought
    result = db_session.execute(text(sql_metadatos))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brunogandolfo/cfo-inteligente/backend/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2362, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brunogandolfo/cfo-inteligente/backend/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2256, in _execute_internal
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/home/brunogandolfo/cfo-inteligente/backend/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
           ^^^^^
  File "/home/brunogandolfo/cfo-inteligente/backend/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brunogandolfo/cfo-inteligente/backend/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brunogandolfo/cfo-inteligente/backend/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/brunogandolfo/cfo-inteligente/backend/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/brunogandolfo/cfo-inteligente/backend/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/brunogandolfo/cfo-inteligente/backend/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/brunogandolfo/cfo-inteligente/backend/venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "operaciones" does not exist
LINE 7:      FROM operaciones
                  ^

[SQL: 
SELECT 
    CURRENT_DATE as fecha_actual,
    EXTRACT(YEAR FROM CURRENT_DATE)::int as año_actual,
    EXTRACT(MONTH FROM CURRENT_DATE)::int as mes_actual,
    (SELECT COUNT(DISTINCT DATE_TRUNC('month', fecha))
     FROM operaciones
     WHERE deleted_at IS NULL
       AND DATE_TRUNC('year', fecha) = DATE_TRUNC('year', CURRENT_DATE)) as meses_con_datos_2025,
    12 - EXTRACT(MONTH FROM CURRENT_DATE)::int as meses_restantes_2025,
    (SELECT MAX(DATE_TRUNC('month', fecha))
     FROM operaciones
     WHERE deleted_at IS NULL) as ultimo_mes_con_datos,
    (SELECT MIN(DATE_TRUNC('month', fecha))
     FROM operaciones
     WHERE deleted_at IS NULL
       AND DATE_TRUNC('year', fecha) = DATE_TRUNC('year', CURRENT_DATE)) as primer_mes_con_datos_2025
]
(Background on this error at: https://sqlalche.me/e/20/f405)
_______________ TestEndpointCFOAsk.test_endpoint_pregunta_simple _______________
/usr/lib/python3.12/unittest/mock.py:1387: in patched
    with self.decoration_helper(patched,
/usr/lib/python3.12/contextlib.py:137: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
/usr/lib/python3.12/unittest/mock.py:1369: in decoration_helper
    arg = exit_stack.enter_context(patching)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/usr/lib/python3.12/contextlib.py:526: in enter_context
    result = _enter(cm)
             ^^^^^^^^^^
/usr/lib/python3.12/unittest/mock.py:1458: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/usr/lib/python3.12/unittest/mock.py:1431: in get_original
    raise AttributeError(
E   AttributeError: <module 'app.api.cfo_ai' from '/home/brunogandolfo/cfo-inteligente/backend/app/api/cfo_ai.py'> does not have the attribute 'client'
______________ TestEndpointCFOAsk.test_endpoint_pregunta_compleja ______________
/usr/lib/python3.12/unittest/mock.py:1387: in patched
    with self.decoration_helper(patched,
/usr/lib/python3.12/contextlib.py:137: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
/usr/lib/python3.12/unittest/mock.py:1369: in decoration_helper
    arg = exit_stack.enter_context(patching)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/usr/lib/python3.12/contextlib.py:526: in enter_context
    result = _enter(cm)
             ^^^^^^^^^^
/usr/lib/python3.12/unittest/mock.py:1458: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/usr/lib/python3.12/unittest/mock.py:1431: in get_original
    raise AttributeError(
E   AttributeError: <module 'app.api.cfo_ai' from '/home/brunogandolfo/cfo-inteligente/backend/app/api/cfo_ai.py'> does not have the attribute 'client'
________________ TestEndpointCFOAsk.test_endpoint_sql_invalido _________________
tests/test_integration.py:217: in test_endpoint_sql_invalido
    assert response.status_code == 200  # No crashea
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   assert 401 == 200
E    +  where 401 = <Response [401 Unauthorized]>.status_code
______________ TestEndpointCFOAsk.test_endpoint_formato_response _______________
tests/test_integration.py:228: in test_endpoint_formato_response
    with patch('app.api.cfo_ai.client') as mock_client:
/usr/lib/python3.12/unittest/mock.py:1458: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/usr/lib/python3.12/unittest/mock.py:1431: in get_original
    raise AttributeError(
E   AttributeError: <module 'app.api.cfo_ai' from '/home/brunogandolfo/cfo-inteligente/backend/app/api/cfo_ai.py'> does not have the attribute 'client'
______________ TestSQLRouterIntegration.test_sql_ejecutable_en_bd ______________
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: in do_execute
    cursor.execute(statement, parameters)
E   psycopg2.errors.UndefinedTable: relation "operaciones" does not exist
E   LINE 1: SELECT COUNT(*) AS total FROM operaciones WHERE deleted_at I...
E                                         ^

The above exception was the direct cause of the following exception:
tests/test_integration.py:278: in test_sql_ejecutable_en_bd
    result = db_session.execute(text(resultado['sql']))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2362: in execute
    return self._execute_internal(
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2256: in _execute_internal
    result = conn.execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1418: in execute
    return meth(
venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:515: in _execute_on_connection
    return connection._execute_clauseelement(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1640: in _execute_clauseelement
    ret = self._execute_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "operaciones" does not exist
E   LINE 1: SELECT COUNT(*) AS total FROM operaciones WHERE deleted_at I...
E                                         ^
E   
E   [SQL: SELECT COUNT(*) AS total FROM operaciones WHERE deleted_at IS NULL AND DATE_TRUNC('month',fecha)=DATE_TRUNC('month',CURRENT_DATE)]
E   (Background on this error at: https://sqlalche.me/e/20/f405)
----------------------------- Captured stdout call -----------------------------
2025-12-18 11:30:01 - app.services.sql_router - INFO - Inicializando SQL Router (Claude + Vanna)
2025-12-18 11:30:01 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: Claude inicializado
2025-12-18 11:30:01 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: OpenAI inicializado
2025-12-18 11:30:01 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: Gemini inicializado
2025-12-18 11:30:01 - app.services.ai.ai_orchestrator - INFO - AIOrchestrator: Proveedores disponibles: Claude, OpenAI, Gemini
2025-12-18 11:30:01 - app.services.claude_sql_generator - INFO - ClaudeSQLGenerator inicializado con AIOrchestrator
2025-12-18 11:30:01 - app.services.sql_router - INFO - SQL Router procesando pregunta: '¿Cuántas operaciones hay?'
2025-12-18 11:30:01 - app.services.sql_router - INFO - SQL Router usando QueryFallback para: '¿Cuántas operaciones hay?'
------------------------------ Captured log call -------------------------------
INFO     app.services.sql_router:sql_router.py:567 Inicializando SQL Router (Claude + Vanna)
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:67 AIOrchestrator: Claude inicializado
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:78 AIOrchestrator: OpenAI inicializado
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:88 AIOrchestrator: Gemini inicializado
INFO     app.services.ai.ai_orchestrator:ai_orchestrator.py:102 AIOrchestrator: Proveedores disponibles: Claude, OpenAI, Gemini
INFO     app.services.claude_sql_generator:claude_sql_generator.py:353 ClaudeSQLGenerator inicializado con AIOrchestrator
INFO     app.services.sql_router:sql_router.py:418 SQL Router procesando pregunta: '¿Cuántas operaciones hay?'
INFO     app.services.sql_router:sql_router.py:428 SQL Router usando QueryFallback para: '¿Cuántas operaciones hay?'
__________ TestSQLRouterIntegration.test_sql_rentabilidad_ejecutable ___________
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: in do_execute
    cursor.execute(statement, parameters)
E   psycopg2.errors.UndefinedTable: relation "operaciones" does not exist
E   LINE 1: ...onto_uyu ELSE 0 END),0))*100 AS rentabilidad FROM operacione...
E                                                                ^

The above exception was the direct cause of the following exception:
tests/test_integration.py:310: in test_sql_rentabilidad_ejecutable
    result = db_session.execute(text(resultado['sql']))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2362: in execute
    return self._execute_internal(
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2256: in _execute_internal
    result = conn.execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1418: in execute
    return meth(
venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:515: in _execute_on_connection
    return connection._execute_clauseelement(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1640: in _execute_clauseelement
    ret = self._execute_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "operaciones" does not exist
E   LINE 1: ...onto_uyu ELSE 0 END),0))*100 AS rentabilidad FROM operacione...
E                                                                ^
E   
E   [SQL: SELECT ((SUM(CASE WHEN o.tipo_operacion='INGRESO' THEN o.monto_uyu ELSE 0 END)-SUM(CASE WHEN o.tipo_operacion='GASTO' THEN o.monto_uyu ELSE 0 END))/NULLIF(SUM(CASE WHEN o.tipo_operacion='INGRESO' THEN o.monto_uyu ELSE 0 END),0))*100 AS rentabilidad FROM operaciones o WHERE o.deleted_at IS NULL AND DATE_TRUNC('month',o.fecha)=DATE_TRUNC('month',CURRENT_DATE)]
E   (Background on this error at: https://sqlalche.me/e/20/f405)
----------------------------- Captured stdout call -----------------------------
2025-12-18 11:30:02 - app.services.sql_router - INFO - SQL Router procesando pregunta: '¿Cuál es la rentabilidad?'
2025-12-18 11:30:02 - app.services.sql_router - INFO - SQL Router usando QueryFallback para: '¿Cuál es la rentabilidad?'
------------------------------ Captured log call -------------------------------
INFO     app.services.sql_router:sql_router.py:418 SQL Router procesando pregunta: '¿Cuál es la rentabilidad?'
INFO     app.services.sql_router:sql_router.py:428 SQL Router usando QueryFallback para: '¿Cuál es la rentabilidad?'
__________ TestValidadorConDatosReales.test_validar_rentabilidad_real __________
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: in do_execute
    cursor.execute(statement, parameters)
E   psycopg2.errors.UndefinedTable: relation "operaciones" does not exist
E   LINE 9:         FROM operaciones
E                        ^

The above exception was the direct cause of the following exception:
tests/test_integration.py:344: in test_validar_rentabilidad_real
    result = db_session.execute(text(sql))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2362: in execute
    return self._execute_internal(
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2256: in _execute_internal
    result = conn.execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1418: in execute
    return meth(
venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:515: in _execute_on_connection
    return connection._execute_clauseelement(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1640: in _execute_clauseelement
    ret = self._execute_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "operaciones" does not exist
E   LINE 9:         FROM operaciones
E                        ^
E   
E   [SQL: 
E           SELECT 
E               ROUND(
E                   ((SUM(CASE WHEN tipo_operacion='INGRESO' THEN monto_uyu ELSE 0 END) -
E                     SUM(CASE WHEN tipo_operacion='GASTO' THEN monto_uyu ELSE 0 END)) /
E                    NULLIF(SUM(CASE WHEN tipo_operacion='INGRESO' THEN monto_uyu ELSE 0 END), 0)) * 100,
E                   2
E               ) AS rentabilidad
E           FROM operaciones
E           WHERE deleted_at IS NULL
E           AND DATE_TRUNC('year', fecha) = DATE_TRUNC('year', CURRENT_DATE)
E           ]
E   (Background on this error at: https://sqlalche.me/e/20/f405)
________ TestValidadorConDatosReales.test_validar_distribuciones_reales ________
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: in do_execute
    cursor.execute(statement, parameters)
E   psycopg2.errors.UndefinedTable: relation "socios" does not exist
E   LINE 5:         FROM socios s
E                        ^

The above exception was the direct cause of the following exception:
tests/test_integration.py:377: in test_validar_distribuciones_reales
    result = db_session.execute(text(sql))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2362: in execute
    return self._execute_internal(
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2256: in _execute_internal
    result = conn.execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1418: in execute
    return meth(
venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:515: in _execute_on_connection
    return connection._execute_clauseelement(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1640: in _execute_clauseelement
    ret = self._execute_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "socios" does not exist
E   LINE 5:         FROM socios s
E                        ^
E   
E   [SQL: 
E           SELECT 
E               s.nombre,
E               COALESCE(SUM(dd.monto_uyu), 0) as total
E           FROM socios s
E           LEFT JOIN distribuciones_detalle dd ON dd.socio_id = s.id
E           LEFT JOIN operaciones o ON o.id = dd.operacion_id 
E               AND o.deleted_at IS NULL
E               AND DATE_TRUNC('year', o.fecha) = DATE_TRUNC('year', CURRENT_DATE)
E           GROUP BY s.nombre
E           ]
E   (Background on this error at: https://sqlalche.me/e/20/f405)
______ TestFlujoCompletoEndToEnd.test_flujo_completo_pregunta_facturacion ______
/usr/lib/python3.12/unittest/mock.py:1387: in patched
    with self.decoration_helper(patched,
/usr/lib/python3.12/contextlib.py:137: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
/usr/lib/python3.12/unittest/mock.py:1369: in decoration_helper
    arg = exit_stack.enter_context(patching)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/usr/lib/python3.12/contextlib.py:526: in enter_context
    result = _enter(cm)
             ^^^^^^^^^^
/usr/lib/python3.12/unittest/mock.py:1458: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/usr/lib/python3.12/unittest/mock.py:1431: in get_original
    raise AttributeError(
E   AttributeError: <module 'app.api.cfo_ai' from '/home/brunogandolfo/cfo-inteligente/backend/app/api/cfo_ai.py'> does not have the attribute 'client'
_________ TestFlujoCompletoEndToEnd.test_flujo_con_validacion_pre_sql __________
/usr/lib/python3.12/unittest/mock.py:1387: in patched
    with self.decoration_helper(patched,
/usr/lib/python3.12/contextlib.py:137: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
/usr/lib/python3.12/unittest/mock.py:1369: in decoration_helper
    arg = exit_stack.enter_context(patching)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/usr/lib/python3.12/contextlib.py:526: in enter_context
    result = _enter(cm)
             ^^^^^^^^^^
/usr/lib/python3.12/unittest/mock.py:1458: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/usr/lib/python3.12/unittest/mock.py:1431: in get_original
    raise AttributeError(
E   AttributeError: <module 'app.api.cfo_ai' from '/home/brunogandolfo/cfo-inteligente/backend/app/api/cfo_ai.py'> does not have the attribute 'client'
__________ TestFlujoCompletoEndToEnd.test_flujo_con_chain_of_thought ___________
/usr/lib/python3.12/unittest/mock.py:1387: in patched
    with self.decoration_helper(patched,
/usr/lib/python3.12/contextlib.py:137: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
/usr/lib/python3.12/unittest/mock.py:1369: in decoration_helper
    arg = exit_stack.enter_context(patching)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/usr/lib/python3.12/contextlib.py:526: in enter_context
    result = _enter(cm)
             ^^^^^^^^^^
/usr/lib/python3.12/unittest/mock.py:1458: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/usr/lib/python3.12/unittest/mock.py:1431: in get_original
    raise AttributeError(
E   AttributeError: <module 'app.api.cfo_ai' from '/home/brunogandolfo/cfo-inteligente/backend/app/api/cfo_ai.py'> does not have the attribute 'client'
_______________ TestQueriesReales.test_query_conteo_operaciones ________________
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: in do_execute
    cursor.execute(statement, parameters)
E   psycopg2.errors.UndefinedTable: relation "operaciones" does not exist
E   LINE 1: SELECT COUNT(*) as total FROM operaciones WHERE deleted_at I...
E                                         ^

The above exception was the direct cause of the following exception:
tests/test_integration.py:495: in test_query_conteo_operaciones
    result = db_session.execute(text(sql))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2362: in execute
    return self._execute_internal(
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2256: in _execute_internal
    result = conn.execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1418: in execute
    return meth(
venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:515: in _execute_on_connection
    return connection._execute_clauseelement(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1640: in _execute_clauseelement
    ret = self._execute_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "operaciones" does not exist
E   LINE 1: SELECT COUNT(*) as total FROM operaciones WHERE deleted_at I...
E                                         ^
E   
E   [SQL: SELECT COUNT(*) as total FROM operaciones WHERE deleted_at IS NULL]
E   (Background on this error at: https://sqlalche.me/e/20/f405)
__________________ TestQueriesReales.test_query_sum_ingresos ___________________
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: in do_execute
    cursor.execute(statement, parameters)
E   psycopg2.errors.UndefinedTable: relation "operaciones" does not exist
E   LINE 3:         FROM operaciones
E                        ^

The above exception was the direct cause of the following exception:
tests/test_integration.py:513: in test_query_sum_ingresos
    result = db_session.execute(text(sql))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2362: in execute
    return self._execute_internal(
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2256: in _execute_internal
    result = conn.execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1418: in execute
    return meth(
venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:515: in _execute_on_connection
    return connection._execute_clauseelement(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1640: in _execute_clauseelement
    ret = self._execute_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "operaciones" does not exist
E   LINE 3:         FROM operaciones
E                        ^
E   
E   [SQL: 
E           SELECT SUM(monto_uyu) as total_ingresos
E           FROM operaciones
E           WHERE tipo_operacion = 'INGRESO'
E           AND deleted_at IS NULL
E           ]
E   (Background on this error at: https://sqlalche.me/e/20/f405)
____________ TestQueriesReales.test_query_distribuciones_por_socio _____________
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: in do_execute
    cursor.execute(statement, parameters)
E   psycopg2.errors.UndefinedTable: relation "socios" does not exist
E   LINE 5:         FROM socios s
E                        ^

The above exception was the direct cause of the following exception:
tests/test_integration.py:537: in test_query_distribuciones_por_socio
    result = db_session.execute(text(sql))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2362: in execute
    return self._execute_internal(
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2256: in _execute_internal
    result = conn.execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1418: in execute
    return meth(
venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:515: in _execute_on_connection
    return connection._execute_clauseelement(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1640: in _execute_clauseelement
    ret = self._execute_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "socios" does not exist
E   LINE 5:         FROM socios s
E                        ^
E   
E   [SQL: 
E           SELECT 
E               s.nombre,
E               COALESCE(SUM(dd.monto_uyu), 0) as total
E           FROM socios s
E           LEFT JOIN distribuciones_detalle dd ON dd.socio_id = s.id
E           LEFT JOIN operaciones o ON o.id = dd.operacion_id
E               AND o.deleted_at IS NULL
E           GROUP BY s.nombre
E           ORDER BY s.nombre
E           ]
E   (Background on this error at: https://sqlalche.me/e/20/f405)
_______ TestChainOfThoughtAvanzado.test_proyeccion_fin_año_con_metadatos _______
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: in do_execute
    cursor.execute(statement, parameters)
E   psycopg2.errors.UndefinedTable: relation "operaciones" does not exist
E   LINE 7:      FROM operaciones
E                     ^

The above exception was the direct cause of the following exception:
tests/test_integration.py:601: in test_proyeccion_fin_año_con_metadatos
    result = db_session.execute(text(sql_meta))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2362: in execute
    return self._execute_internal(
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2256: in _execute_internal
    result = conn.execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1418: in execute
    return meth(
venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:515: in _execute_on_connection
    return connection._execute_clauseelement(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1640: in _execute_clauseelement
    ret = self._execute_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "operaciones" does not exist
E   LINE 7:      FROM operaciones
E                     ^
E   
E   [SQL: 
E   SELECT 
E       CURRENT_DATE as fecha_actual,
E       EXTRACT(YEAR FROM CURRENT_DATE)::int as año_actual,
E       EXTRACT(MONTH FROM CURRENT_DATE)::int as mes_actual,
E       (SELECT COUNT(DISTINCT DATE_TRUNC('month', fecha))
E        FROM operaciones
E        WHERE deleted_at IS NULL
E          AND DATE_TRUNC('year', fecha) = DATE_TRUNC('year', CURRENT_DATE)) as meses_con_datos_2025,
E       12 - EXTRACT(MONTH FROM CURRENT_DATE)::int as meses_restantes_2025,
E       (SELECT MAX(DATE_TRUNC('month', fecha))
E        FROM operaciones
E        WHERE deleted_at IS NULL) as ultimo_mes_con_datos,
E       (SELECT MIN(DATE_TRUNC('month', fecha))
E        FROM operaciones
E        WHERE deleted_at IS NULL
E          AND DATE_TRUNC('year', fecha) = DATE_TRUNC('year', CURRENT_DATE)) as primer_mes_con_datos_2025
E   ]
E   (Background on this error at: https://sqlalche.me/e/20/f405)
____________ TestChainOfThoughtAvanzado.test_comparacion_mes_vs_mes ____________
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: in do_execute
    cursor.execute(statement, parameters)
E   psycopg2.errors.UndefinedTable: relation "operaciones" does not exist
E   LINE 6:             FROM operaciones
E                            ^

The above exception was the direct cause of the following exception:
tests/test_integration.py:628: in test_comparacion_mes_vs_mes
    result = db_session.execute(text(sql))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2362: in execute
    return self._execute_internal(
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2256: in _execute_internal
    result = conn.execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1418: in execute
    return meth(
venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:515: in _execute_on_connection
    return connection._execute_clauseelement(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1640: in _execute_clauseelement
    ret = self._execute_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "operaciones" does not exist
E   LINE 6:             FROM operaciones
E                            ^
E   
E   [SQL: 
E           WITH mensual AS (
E               SELECT 
E                   DATE_TRUNC('month', fecha) AS mes,
E                   SUM(CASE WHEN tipo_operacion='INGRESO' THEN monto_uyu ELSE 0 END) as ingresos
E               FROM operaciones
E               WHERE deleted_at IS NULL
E               GROUP BY 1
E               ORDER BY 1 DESC
E               LIMIT 2
E           )
E           SELECT mes, ingresos FROM mensual ORDER BY mes DESC
E           ]
E   (Background on this error at: https://sqlalche.me/e/20/f405)
__________ TestChainOfThoughtAvanzado.test_tendencia_ultimos_3_meses ___________
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: in do_execute
    cursor.execute(statement, parameters)
E   psycopg2.errors.UndefinedTable: relation "operaciones" does not exist
E   LINE 5:         FROM operaciones
E                        ^

The above exception was the direct cause of the following exception:
tests/test_integration.py:652: in test_tendencia_ultimos_3_meses
    result = db_session.execute(text(sql))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2362: in execute
    return self._execute_internal(
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2256: in _execute_internal
    result = conn.execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1418: in execute
    return meth(
venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:515: in _execute_on_connection
    return connection._execute_clauseelement(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1640: in _execute_clauseelement
    ret = self._execute_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "operaciones" does not exist
E   LINE 5:         FROM operaciones
E                        ^
E   
E   [SQL: 
E           SELECT 
E               DATE_TRUNC('month', fecha) AS mes,
E               SUM(CASE WHEN tipo_operacion='INGRESO' THEN monto_uyu ELSE 0 END) as ingresos
E           FROM operaciones
E           WHERE deleted_at IS NULL
E           AND fecha >= DATE_TRUNC('month', CURRENT_DATE) - INTERVAL '2 months'
E           GROUP BY 1
E           ORDER BY 1
E           ]
E   (Background on this error at: https://sqlalche.me/e/20/f405)
__________ TestChainOfThoughtAvanzado.test_conversion_moneda_multiple __________
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: in do_execute
    cursor.execute(statement, parameters)
E   psycopg2.errors.UndefinedTable: relation "operaciones" does not exist
E   LINE 5:         FROM operaciones
E                        ^

The above exception was the direct cause of the following exception:
tests/test_integration.py:670: in test_conversion_moneda_multiple
    result = db_session.execute(text(sql))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2362: in execute
    return self._execute_internal(
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2256: in _execute_internal
    result = conn.execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1418: in execute
    return meth(
venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:515: in _execute_on_connection
    return connection._execute_clauseelement(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1640: in _execute_clauseelement
    ret = self._execute_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "operaciones" does not exist
E   LINE 5:         FROM operaciones
E                        ^
E   
E   [SQL: 
E           SELECT 
E               SUM(monto_uyu) as total_uyu,
E               SUM(monto_usd) as total_usd
E           FROM operaciones
E           WHERE tipo_operacion='INGRESO'
E           AND deleted_at IS NULL
E           ]
E   (Background on this error at: https://sqlalche.me/e/20/f405)
_______ TestChainOfThoughtAvanzado.test_metadatos_fecha_actual_correcta ________
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: in do_execute
    cursor.execute(statement, parameters)
E   psycopg2.errors.UndefinedTable: relation "operaciones" does not exist
E   LINE 7:      FROM operaciones
E                     ^

The above exception was the direct cause of the following exception:
tests/test_integration.py:703: in test_metadatos_fecha_actual_correcta
    result2 = db_session.execute(text(sql_meta))
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2362: in execute
    return self._execute_internal(
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2256: in _execute_internal
    result = conn.execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1418: in execute
    return meth(
venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:515: in _execute_on_connection
    return connection._execute_clauseelement(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1640: in _execute_clauseelement
    ret = self._execute_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "operaciones" does not exist
E   LINE 7:      FROM operaciones
E                     ^
E   
E   [SQL: 
E   SELECT 
E       CURRENT_DATE as fecha_actual,
E       EXTRACT(YEAR FROM CURRENT_DATE)::int as año_actual,
E       EXTRACT(MONTH FROM CURRENT_DATE)::int as mes_actual,
E       (SELECT COUNT(DISTINCT DATE_TRUNC('month', fecha))
E        FROM operaciones
E        WHERE deleted_at IS NULL
E          AND DATE_TRUNC('year', fecha) = DATE_TRUNC('year', CURRENT_DATE)) as meses_con_datos_2025,
E       12 - EXTRACT(MONTH FROM CURRENT_DATE)::int as meses_restantes_2025,
E       (SELECT MAX(DATE_TRUNC('month', fecha))
E        FROM operaciones
E        WHERE deleted_at IS NULL) as ultimo_mes_con_datos,
E       (SELECT MIN(DATE_TRUNC('month', fecha))
E        FROM operaciones
E        WHERE deleted_at IS NULL
E          AND DATE_TRUNC('year', fecha) = DATE_TRUNC('year', CURRENT_DATE)) as primer_mes_con_datos_2025
E   ]
E   (Background on this error at: https://sqlalche.me/e/20/f405)
___________ TestChainOfThoughtAvanzado.test_meses_con_datos_dinamico ___________
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: in do_execute
    cursor.execute(statement, parameters)
E   psycopg2.errors.UndefinedTable: relation "operaciones" does not exist
E   LINE 7:      FROM operaciones
E                     ^

The above exception was the direct cause of the following exception:
tests/test_integration.py:713: in test_meses_con_datos_dinamico
    result = db_session.execute(text(sql_meta))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2362: in execute
    return self._execute_internal(
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2256: in _execute_internal
    result = conn.execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1418: in execute
    return meth(
venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:515: in _execute_on_connection
    return connection._execute_clauseelement(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1640: in _execute_clauseelement
    ret = self._execute_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "operaciones" does not exist
E   LINE 7:      FROM operaciones
E                     ^
E   
E   [SQL: 
E   SELECT 
E       CURRENT_DATE as fecha_actual,
E       EXTRACT(YEAR FROM CURRENT_DATE)::int as año_actual,
E       EXTRACT(MONTH FROM CURRENT_DATE)::int as mes_actual,
E       (SELECT COUNT(DISTINCT DATE_TRUNC('month', fecha))
E        FROM operaciones
E        WHERE deleted_at IS NULL
E          AND DATE_TRUNC('year', fecha) = DATE_TRUNC('year', CURRENT_DATE)) as meses_con_datos_2025,
E       12 - EXTRACT(MONTH FROM CURRENT_DATE)::int as meses_restantes_2025,
E       (SELECT MAX(DATE_TRUNC('month', fecha))
E        FROM operaciones
E        WHERE deleted_at IS NULL) as ultimo_mes_con_datos,
E       (SELECT MIN(DATE_TRUNC('month', fecha))
E        FROM operaciones
E        WHERE deleted_at IS NULL
E          AND DATE_TRUNC('year', fecha) = DATE_TRUNC('year', CURRENT_DATE)) as primer_mes_con_datos_2025
E   ]
E   (Background on this error at: https://sqlalche.me/e/20/f405)
_____________ TestChainOfThoughtAvanzado.test_ultimo_mes_con_datos _____________
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: in do_execute
    cursor.execute(statement, parameters)
E   psycopg2.errors.UndefinedTable: relation "operaciones" does not exist
E   LINE 7:      FROM operaciones
E                     ^

The above exception was the direct cause of the following exception:
tests/test_integration.py:733: in test_ultimo_mes_con_datos
    result = db_session.execute(text(sql_meta))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2362: in execute
    return self._execute_internal(
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2256: in _execute_internal
    result = conn.execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1418: in execute
    return meth(
venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:515: in _execute_on_connection
    return connection._execute_clauseelement(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1640: in _execute_clauseelement
    ret = self._execute_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "operaciones" does not exist
E   LINE 7:      FROM operaciones
E                     ^
E   
E   [SQL: 
E   SELECT 
E       CURRENT_DATE as fecha_actual,
E       EXTRACT(YEAR FROM CURRENT_DATE)::int as año_actual,
E       EXTRACT(MONTH FROM CURRENT_DATE)::int as mes_actual,
E       (SELECT COUNT(DISTINCT DATE_TRUNC('month', fecha))
E        FROM operaciones
E        WHERE deleted_at IS NULL
E          AND DATE_TRUNC('year', fecha) = DATE_TRUNC('year', CURRENT_DATE)) as meses_con_datos_2025,
E       12 - EXTRACT(MONTH FROM CURRENT_DATE)::int as meses_restantes_2025,
E       (SELECT MAX(DATE_TRUNC('month', fecha))
E        FROM operaciones
E        WHERE deleted_at IS NULL) as ultimo_mes_con_datos,
E       (SELECT MIN(DATE_TRUNC('month', fecha))
E        FROM operaciones
E        WHERE deleted_at IS NULL
E          AND DATE_TRUNC('year', fecha) = DATE_TRUNC('year', CURRENT_DATE)) as primer_mes_con_datos_2025
E   ]
E   (Background on this error at: https://sqlalche.me/e/20/f405)
____________ TestValidadorPostSQLReal.test_porcentaje_usd_uyu_real _____________
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: in do_execute
    cursor.execute(statement, parameters)
E   psycopg2.errors.UndefinedTable: relation "operaciones" does not exist
E   LINE 5:         FROM operaciones
E                        ^

The above exception was the direct cause of the following exception:
tests/test_integration.py:761: in test_porcentaje_usd_uyu_real
    result = db_session.execute(text(sql))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2362: in execute
    return self._execute_internal(
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2256: in _execute_internal
    result = conn.execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1418: in execute
    return meth(
venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:515: in _execute_on_connection
    return connection._execute_clauseelement(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1640: in _execute_clauseelement
    ret = self._execute_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "operaciones" does not exist
E   LINE 5:         FROM operaciones
E                        ^
E   
E   [SQL: 
E           SELECT 
E               ROUND(COUNT(CASE WHEN moneda_original='USD' THEN 1 END) * 100.0 / COUNT(*), 2) as pct_usd,
E               ROUND(COUNT(CASE WHEN moneda_original='UYU' THEN 1 END) * 100.0 / COUNT(*), 2) as pct_uyu
E           FROM operaciones
E           WHERE tipo_operacion='INGRESO'
E           AND deleted_at IS NULL
E           ]
E   (Background on this error at: https://sqlalche.me/e/20/f405)
__________ TestValidadorPostSQLReal.test_distribucion_por_socio_real ___________
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: in do_execute
    cursor.execute(statement, parameters)
E   psycopg2.errors.UndefinedTable: relation "socios" does not exist
E   LINE 5:         FROM socios s
E                        ^

The above exception was the direct cause of the following exception:
tests/test_integration.py:788: in test_distribucion_por_socio_real
    result = db_session.execute(text(sql))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2362: in execute
    return self._execute_internal(
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2256: in _execute_internal
    result = conn.execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1418: in execute
    return meth(
venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:515: in _execute_on_connection
    return connection._execute_clauseelement(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1640: in _execute_clauseelement
    ret = self._execute_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "socios" does not exist
E   LINE 5:         FROM socios s
E                        ^
E   
E   [SQL: 
E           SELECT 
E               s.nombre,
E               COALESCE(SUM(dd.monto_uyu), 0) as total
E           FROM socios s
E           LEFT JOIN distribuciones_detalle dd ON dd.socio_id = s.id
E           LEFT JOIN operaciones o ON o.id = dd.operacion_id
E               AND o.deleted_at IS NULL
E               AND DATE_TRUNC('year', o.fecha) = DATE_TRUNC('year', CURRENT_DATE)
E           GROUP BY s.nombre
E           ORDER BY total DESC
E           ]
E   (Background on this error at: https://sqlalche.me/e/20/f405)
________________ TestCasosCriticos.test_caso_retiros_por_socio _________________
/usr/lib/python3.12/unittest/mock.py:1387: in patched
    with self.decoration_helper(patched,
/usr/lib/python3.12/contextlib.py:137: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
/usr/lib/python3.12/unittest/mock.py:1369: in decoration_helper
    arg = exit_stack.enter_context(patching)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/usr/lib/python3.12/contextlib.py:526: in enter_context
    result = _enter(cm)
             ^^^^^^^^^^
/usr/lib/python3.12/unittest/mock.py:1458: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/usr/lib/python3.12/unittest/mock.py:1431: in get_original
    raise AttributeError(
E   AttributeError: <module 'app.api.cfo_ai' from '/home/brunogandolfo/cfo-inteligente/backend/app/api/cfo_ai.py'> does not have the attribute 'client'
_____________ TestCasosCriticos.test_caso_comparacion_año_anterior _____________
/usr/lib/python3.12/unittest/mock.py:1387: in patched
    with self.decoration_helper(patched,
/usr/lib/python3.12/contextlib.py:137: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
/usr/lib/python3.12/unittest/mock.py:1369: in decoration_helper
    arg = exit_stack.enter_context(patching)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/usr/lib/python3.12/contextlib.py:526: in enter_context
    result = _enter(cm)
             ^^^^^^^^^^
/usr/lib/python3.12/unittest/mock.py:1458: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/usr/lib/python3.12/unittest/mock.py:1431: in get_original
    raise AttributeError(
E   AttributeError: <module 'app.api.cfo_ai' from '/home/brunogandolfo/cfo-inteligente/backend/app/api/cfo_ai.py'> does not have the attribute 'client'
_____________ TestCasosCriticos.test_caso_gonzalo_recibe_correcto ______________
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: in do_execute
    cursor.execute(statement, parameters)
E   psycopg2.errors.UndefinedTable: relation "socios" does not exist
E   LINE 1: SELECT porcentaje_participacion FROM socios WHERE nombre='Go...
E                                                ^

The above exception was the direct cause of the following exception:
tests/test_integration.py:915: in test_caso_gonzalo_recibe_correcto
    result1 = db_session.execute(text(sql_participacion))
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2362: in execute
    return self._execute_internal(
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2256: in _execute_internal
    result = conn.execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1418: in execute
    return meth(
venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:515: in _execute_on_connection
    return connection._execute_clauseelement(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1640: in _execute_clauseelement
    ret = self._execute_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "socios" does not exist
E   LINE 1: SELECT porcentaje_participacion FROM socios WHERE nombre='Go...
E                                                ^
E   
E   [SQL: SELECT porcentaje_participacion FROM socios WHERE nombre='Gonzalo']
E   (Background on this error at: https://sqlalche.me/e/20/f405)
________________ TestCasosCriticos.test_caso_estamos_creciendo _________________
/usr/lib/python3.12/unittest/mock.py:1387: in patched
    with self.decoration_helper(patched,
/usr/lib/python3.12/contextlib.py:137: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
/usr/lib/python3.12/unittest/mock.py:1369: in decoration_helper
    arg = exit_stack.enter_context(patching)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/usr/lib/python3.12/contextlib.py:526: in enter_context
    result = _enter(cm)
             ^^^^^^^^^^
/usr/lib/python3.12/unittest/mock.py:1458: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/usr/lib/python3.12/unittest/mock.py:1431: in get_original
    raise AttributeError(
E   AttributeError: <module 'app.api.cfo_ai' from '/home/brunogandolfo/cfo-inteligente/backend/app/api/cfo_ai.py'> does not have the attribute 'client'
___________ TestAuthIntegration.test_registro_y_login_flujo_completo ___________
tests/test_integration_real.py:153: in test_registro_y_login_flujo_completo
    assert registro_response.status_code == 201
E   assert 401 == 201
E    +  where 401 = <Response [401 Unauthorized]>.status_code
______________ TestAuthIntegration.test_registro_socio_autorizado ______________
tests/test_integration_real.py:211: in test_registro_socio_autorizado
    assert response.status_code == 201
E   assert 401 == 201
E    +  where 401 = <Response [401 Unauthorized]>.status_code
________________ TestAuthIntegration.test_registro_colaborador _________________
tests/test_integration_real.py:228: in test_registro_colaborador
    assert response.status_code == 201
E   assert 401 == 201
E    +  where 401 = <Response [401 Unauthorized]>.status_code
____________________ test_aggregator_calcula_todas_metricas ____________________
tests/test_metrics_aggregator.py:55: in test_aggregator_calcula_todas_metricas
    metricas = aggregator.aggregate_all()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^
app/services/metrics/metrics_aggregator.py:221: in aggregate_all
    series_temporales = self._calculate_series_temporales()
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
app/services/metrics/metrics_aggregator.py:372: in _calculate_series_temporales
    meses_ordenados = sorted(ops_por_mes.keys())
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: '<' not supported between instances of 'Mock' and 'Mock'
----------------------------- Captured stdout call -----------------------------
2025-12-18 11:30:10 - app.services.metrics.metrics_aggregator - INFO - Iniciando agregación de métricas: 5 operaciones
------------------------------ Captured log call -------------------------------
INFO     app.services.metrics.metrics_aggregator:metrics_aggregator.py:126 Iniciando agregación de métricas: 5 operaciones
_______________________ test_aggregator_totals_correctos _______________________
tests/test_metrics_aggregator.py:81: in test_aggregator_totals_correctos
    metricas = aggregator.aggregate_all()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^
app/services/metrics/metrics_aggregator.py:221: in aggregate_all
    series_temporales = self._calculate_series_temporales()
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
app/services/metrics/metrics_aggregator.py:372: in _calculate_series_temporales
    meses_ordenados = sorted(ops_por_mes.keys())
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: '<' not supported between instances of 'Mock' and 'Mock'
----------------------------- Captured stdout call -----------------------------
2025-12-18 11:30:10 - app.services.metrics.metrics_aggregator - INFO - Iniciando agregación de métricas: 5 operaciones
------------------------------ Captured log call -------------------------------
INFO     app.services.metrics.metrics_aggregator:metrics_aggregator.py:126 Iniciando agregación de métricas: 5 operaciones
_______________________ test_aggregator_margen_correcto ________________________
tests/test_metrics_aggregator.py:95: in test_aggregator_margen_correcto
    metricas = aggregator.aggregate_all()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^
app/services/metrics/metrics_aggregator.py:221: in aggregate_all
    series_temporales = self._calculate_series_temporales()
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
app/services/metrics/metrics_aggregator.py:372: in _calculate_series_temporales
    meses_ordenados = sorted(ops_por_mes.keys())
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: '<' not supported between instances of 'Mock' and 'Mock'
----------------------------- Captured stdout call -----------------------------
2025-12-18 11:30:10 - app.services.metrics.metrics_aggregator - INFO - Iniciando agregación de métricas: 5 operaciones
------------------------------ Captured log call -------------------------------
INFO     app.services.metrics.metrics_aggregator:metrics_aggregator.py:126 Iniciando agregación de métricas: 5 operaciones
__________________________ test_aggregator_area_lider __________________________
tests/test_metrics_aggregator.py:109: in test_aggregator_area_lider
    metricas = aggregator.aggregate_all()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^
app/services/metrics/metrics_aggregator.py:221: in aggregate_all
    series_temporales = self._calculate_series_temporales()
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
app/services/metrics/metrics_aggregator.py:372: in _calculate_series_temporales
    meses_ordenados = sorted(ops_por_mes.keys())
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: '<' not supported between instances of 'Mock' and 'Mock'
----------------------------- Captured stdout call -----------------------------
2025-12-18 11:30:10 - app.services.metrics.metrics_aggregator - INFO - Iniciando agregación de métricas: 5 operaciones
------------------------------ Captured log call -------------------------------
INFO     app.services.metrics.metrics_aggregator:metrics_aggregator.py:126 Iniciando agregación de métricas: 5 operaciones
_______________________ test_aggregator_con_comparacion ________________________
tests/test_metrics_aggregator.py:135: in test_aggregator_con_comparacion
    metricas = aggregator.aggregate_all()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^
app/services/metrics/metrics_aggregator.py:221: in aggregate_all
    series_temporales = self._calculate_series_temporales()
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
app/services/metrics/metrics_aggregator.py:372: in _calculate_series_temporales
    meses_ordenados = sorted(ops_por_mes.keys())
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: '<' not supported between instances of 'Mock' and 'Mock'
----------------------------- Captured stdout call -----------------------------
2025-12-18 11:30:10 - app.services.metrics.metrics_aggregator - INFO - Iniciando agregación de métricas: 5 operaciones
2025-12-18 11:30:10 - app.services.metrics.metrics_aggregator - INFO - Calculando métricas de comparación
------------------------------ Captured log call -------------------------------
INFO     app.services.metrics.metrics_aggregator:metrics_aggregator.py:126 Iniciando agregación de métricas: 5 operaciones
INFO     app.services.metrics.metrics_aggregator:metrics_aggregator.py:162 Calculando métricas de comparación
______________ TestMonthlyAggregator.test_aggregate_octubre_2025 _______________
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: in do_execute
    cursor.execute(statement, parameters)
E   psycopg2.errors.UndefinedTable: relation "operaciones" does not exist
E   LINE 2: FROM operaciones 
E                ^

The above exception was the direct cause of the following exception:
tests/test_monthly_aggregator.py:84: in test_aggregate_octubre_2025
    resultado = aggregator.aggregate(start, end)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
app/services/report_data/base_aggregator.py:73: in aggregate
    operaciones = self.fetch_operations(start_date, end_date, **kwargs)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
app/services/report_data/base_aggregator.py:177: in fetch_operations
    return self.db.query(Operacion).filter(and_(*filtros)).all()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2673: in all
    return self._iter().all()  # type: ignore
           ^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2827: in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2362: in execute
    return self._execute_internal(
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2247: in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py:305: in orm_execute_statement
    result = conn.execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1418: in execute
    return meth(
venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:515: in _execute_on_connection
    return connection._execute_clauseelement(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1640: in _execute_clauseelement
    ret = self._execute_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "operaciones" does not exist
E   LINE 2: FROM operaciones 
E                ^
E   
E   [SQL: SELECT operaciones.id AS operaciones_id, operaciones.tipo_operacion AS operaciones_tipo_operacion, operaciones.fecha AS operaciones_fecha, operaciones.monto_original AS operaciones_monto_original, operaciones.moneda_original AS operaciones_moneda_original, operaciones.tipo_cambio AS operaciones_tipo_cambio, operaciones.monto_uyu AS operaciones_monto_uyu, operaciones.monto_usd AS operaciones_monto_usd, operaciones.area_id AS operaciones_area_id, operaciones.localidad AS operaciones_localidad, operaciones.descripcion AS operaciones_descripcion, operaciones.cliente AS operaciones_cliente, operaciones.proveedor AS operaciones_proveedor, operaciones.deleted_at AS operaciones_deleted_at, operaciones.created_at AS operaciones_created_at, operaciones.updated_at AS operaciones_updated_at 
E   FROM operaciones 
E   WHERE operaciones.fecha >= %(fecha_1)s AND operaciones.fecha <= %(fecha_2)s AND operaciones.deleted_at IS NULL]
E   [parameters: {'fecha_1': datetime.date(2025, 10, 1), 'fecha_2': datetime.date(2025, 10, 31)}]
E   (Background on this error at: https://sqlalche.me/e/20/f405)
----------------------------- Captured stdout call -----------------------------
2025-12-18 11:30:10 - app.services.report_data.base_aggregator - INFO - Agregando datos para MonthlyAggregator: 2025-10-01 a 2025-10-31
------------------------------ Captured log call -------------------------------
INFO     app.services.report_data.base_aggregator:base_aggregator.py:67 Agregando datos para MonthlyAggregator: 2025-10-01 a 2025-10-31
__________ TestMonthlyAggregator.test_aggregate_con_filtro_localidad ___________
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: in do_execute
    cursor.execute(statement, parameters)
E   psycopg2.errors.UndefinedTable: relation "operaciones" does not exist
E   LINE 2: FROM operaciones 
E                ^

The above exception was the direct cause of the following exception:
tests/test_monthly_aggregator.py:118: in test_aggregate_con_filtro_localidad
    resultado = aggregator.aggregate(start, end, localidad="Montevideo")
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
app/services/report_data/base_aggregator.py:73: in aggregate
    operaciones = self.fetch_operations(start_date, end_date, **kwargs)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
app/services/report_data/base_aggregator.py:177: in fetch_operations
    return self.db.query(Operacion).filter(and_(*filtros)).all()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2673: in all
    return self._iter().all()  # type: ignore
           ^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2827: in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2362: in execute
    return self._execute_internal(
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2247: in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py:305: in orm_execute_statement
    result = conn.execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1418: in execute
    return meth(
venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:515: in _execute_on_connection
    return connection._execute_clauseelement(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1640: in _execute_clauseelement
    ret = self._execute_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "operaciones" does not exist
E   LINE 2: FROM operaciones 
E                ^
E   
E   [SQL: SELECT operaciones.id AS operaciones_id, operaciones.tipo_operacion AS operaciones_tipo_operacion, operaciones.fecha AS operaciones_fecha, operaciones.monto_original AS operaciones_monto_original, operaciones.moneda_original AS operaciones_moneda_original, operaciones.tipo_cambio AS operaciones_tipo_cambio, operaciones.monto_uyu AS operaciones_monto_uyu, operaciones.monto_usd AS operaciones_monto_usd, operaciones.area_id AS operaciones_area_id, operaciones.localidad AS operaciones_localidad, operaciones.descripcion AS operaciones_descripcion, operaciones.cliente AS operaciones_cliente, operaciones.proveedor AS operaciones_proveedor, operaciones.deleted_at AS operaciones_deleted_at, operaciones.created_at AS operaciones_created_at, operaciones.updated_at AS operaciones_updated_at 
E   FROM operaciones 
E   WHERE operaciones.fecha >= %(fecha_1)s AND operaciones.fecha <= %(fecha_2)s AND operaciones.deleted_at IS NULL AND operaciones.localidad = %(localidad_1)s]
E   [parameters: {'fecha_1': datetime.date(2025, 10, 1), 'fecha_2': datetime.date(2025, 10, 31), 'localidad_1': 'MONTEVIDEO'}]
E   (Background on this error at: https://sqlalche.me/e/20/f405)
----------------------------- Captured stdout call -----------------------------
2025-12-18 11:30:10 - app.services.report_data.base_aggregator - INFO - Agregando datos para MonthlyAggregator: 2025-10-01 a 2025-10-31
------------------------------ Captured log call -------------------------------
INFO     app.services.report_data.base_aggregator:base_aggregator.py:67 Agregando datos para MonthlyAggregator: 2025-10-01 a 2025-10-31
____________ TestMonthlyAggregator.test_metricas_por_area_ordenadas ____________
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: in do_execute
    cursor.execute(statement, parameters)
E   psycopg2.errors.UndefinedTable: relation "operaciones" does not exist
E   LINE 2: FROM operaciones 
E                ^

The above exception was the direct cause of the following exception:
tests/test_monthly_aggregator.py:131: in test_metricas_por_area_ordenadas
    resultado = aggregator.aggregate(start, end)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
app/services/report_data/base_aggregator.py:73: in aggregate
    operaciones = self.fetch_operations(start_date, end_date, **kwargs)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
app/services/report_data/base_aggregator.py:177: in fetch_operations
    return self.db.query(Operacion).filter(and_(*filtros)).all()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2673: in all
    return self._iter().all()  # type: ignore
           ^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2827: in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2362: in execute
    return self._execute_internal(
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2247: in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py:305: in orm_execute_statement
    result = conn.execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1418: in execute
    return meth(
venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:515: in _execute_on_connection
    return connection._execute_clauseelement(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1640: in _execute_clauseelement
    ret = self._execute_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "operaciones" does not exist
E   LINE 2: FROM operaciones 
E                ^
E   
E   [SQL: SELECT operaciones.id AS operaciones_id, operaciones.tipo_operacion AS operaciones_tipo_operacion, operaciones.fecha AS operaciones_fecha, operaciones.monto_original AS operaciones_monto_original, operaciones.moneda_original AS operaciones_moneda_original, operaciones.tipo_cambio AS operaciones_tipo_cambio, operaciones.monto_uyu AS operaciones_monto_uyu, operaciones.monto_usd AS operaciones_monto_usd, operaciones.area_id AS operaciones_area_id, operaciones.localidad AS operaciones_localidad, operaciones.descripcion AS operaciones_descripcion, operaciones.cliente AS operaciones_cliente, operaciones.proveedor AS operaciones_proveedor, operaciones.deleted_at AS operaciones_deleted_at, operaciones.created_at AS operaciones_created_at, operaciones.updated_at AS operaciones_updated_at 
E   FROM operaciones 
E   WHERE operaciones.fecha >= %(fecha_1)s AND operaciones.fecha <= %(fecha_2)s AND operaciones.deleted_at IS NULL]
E   [parameters: {'fecha_1': datetime.date(2025, 10, 1), 'fecha_2': datetime.date(2025, 10, 31)}]
E   (Background on this error at: https://sqlalche.me/e/20/f405)
----------------------------- Captured stdout call -----------------------------
2025-12-18 11:30:11 - app.services.report_data.base_aggregator - INFO - Agregando datos para MonthlyAggregator: 2025-10-01 a 2025-10-31
------------------------------ Captured log call -------------------------------
INFO     app.services.report_data.base_aggregator:base_aggregator.py:67 Agregando datos para MonthlyAggregator: 2025-10-01 a 2025-10-31
__________________ TestCrearRetiro.test_crear_retiro_solo_uyu __________________
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: in do_execute
    cursor.execute(statement, parameters)
E   psycopg2.errors.UndefinedTable: relation "operaciones" does not exist
E   LINE 1: INSERT INTO operaciones (id, tipo_operacion, fecha, monto_or...
E                       ^

The above exception was the direct cause of the following exception:
tests/test_operacion_service.py:349: in test_crear_retiro_solo_uyu
    operacion = crear_retiro(db_session, data)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
app/services/operacion_service.py:118: in crear_retiro
    db.commit()
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2028: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py:139: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:1313: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py:139: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:1288: in _prepare_impl
    self.session.flush()
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:4352: in flush
    self._flush(objects)
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:4487: in _flush
    with util.safe_reraise():
venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:146: in __exit__
    raise exc_value.with_traceback(exc_tb)
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:4448: in _flush
    flush_context.execute()
venv/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
venv/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
venv/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
venv/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1418: in execute
    return meth(
venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:515: in _execute_on_connection
    return connection._execute_clauseelement(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1640: in _execute_clauseelement
    ret = self._execute_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "operaciones" does not exist
E   LINE 1: INSERT INTO operaciones (id, tipo_operacion, fecha, monto_or...
E                       ^
E   
E   [SQL: INSERT INTO operaciones (id, tipo_operacion, fecha, monto_original, moneda_original, tipo_cambio, monto_uyu, monto_usd, area_id, localidad, descripcion, cliente, proveedor, deleted_at, created_at, updated_at) VALUES (%(id)s::UUID, %(tipo_operacion)s, %(fecha)s, %(monto_original)s, %(moneda_original)s, %(tipo_cambio)s, %(monto_uyu)s, %(monto_usd)s, %(area_id)s::UUID, %(localidad)s, %(descripcion)s, %(cliente)s, %(proveedor)s, %(deleted_at)s, %(created_at)s, %(updated_at)s)]
E   [parameters: {'id': UUID('075f9eda-4c92-4346-924e-3c42f3a25f7d'), 'tipo_operacion': 'RETIRO', 'fecha': datetime.date(2025, 12, 18), 'monto_original': Decimal('10000'), 'moneda_original': 'UYU', 'tipo_cambio': Decimal('40.00'), 'monto_uyu': Decimal('10000'), 'monto_usd': Decimal('2.5E+2'), 'area_id': None, 'localidad': 'MONTEVIDEO', 'descripcion': 'Retiro efectivo Bruno', 'cliente': None, 'proveedor': None, 'deleted_at': None, 'created_at': datetime.datetime(2025, 12, 18, 14, 30, 13, 242931, tzinfo=datetime.timezone.utc), 'updated_at': datetime.datetime(2025, 12, 18, 14, 30, 13, 242935, tzinfo=datetime.timezone.utc)}]
E   (Background on this error at: https://sqlalche.me/e/20/f405)
__________________ TestCrearRetiro.test_crear_retiro_solo_usd __________________
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: in do_execute
    cursor.execute(statement, parameters)
E   psycopg2.errors.UndefinedTable: relation "operaciones" does not exist
E   LINE 1: INSERT INTO operaciones (id, tipo_operacion, fecha, monto_or...
E                       ^

The above exception was the direct cause of the following exception:
tests/test_operacion_service.py:369: in test_crear_retiro_solo_usd
    operacion = crear_retiro(db_session, data)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
app/services/operacion_service.py:118: in crear_retiro
    db.commit()
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2028: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py:139: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:1313: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py:139: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:1288: in _prepare_impl
    self.session.flush()
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:4352: in flush
    self._flush(objects)
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:4487: in _flush
    with util.safe_reraise():
venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:146: in __exit__
    raise exc_value.with_traceback(exc_tb)
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:4448: in _flush
    flush_context.execute()
venv/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
venv/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
venv/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
venv/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1418: in execute
    return meth(
venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:515: in _execute_on_connection
    return connection._execute_clauseelement(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1640: in _execute_clauseelement
    ret = self._execute_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "operaciones" does not exist
E   LINE 1: INSERT INTO operaciones (id, tipo_operacion, fecha, monto_or...
E                       ^
E   
E   [SQL: INSERT INTO operaciones (id, tipo_operacion, fecha, monto_original, moneda_original, tipo_cambio, monto_uyu, monto_usd, area_id, localidad, descripcion, cliente, proveedor, deleted_at, created_at, updated_at) VALUES (%(id)s::UUID, %(tipo_operacion)s, %(fecha)s, %(monto_original)s, %(moneda_original)s, %(tipo_cambio)s, %(monto_uyu)s, %(monto_usd)s, %(area_id)s::UUID, %(localidad)s, %(descripcion)s, %(cliente)s, %(proveedor)s, %(deleted_at)s, %(created_at)s, %(updated_at)s)]
E   [parameters: {'id': UUID('632ae688-30d4-4e8c-89e8-ab5a2e0fb6a3'), 'tipo_operacion': 'RETIRO', 'fecha': datetime.date(2025, 12, 18), 'monto_original': Decimal('500'), 'moneda_original': 'USD', 'tipo_cambio': Decimal('40.00'), 'monto_uyu': Decimal('20000.00'), 'monto_usd': Decimal('500'), 'area_id': None, 'localidad': 'MERCEDES', 'descripcion': 'Retiro USD Agustina', 'cliente': None, 'proveedor': None, 'deleted_at': None, 'created_at': datetime.datetime(2025, 12, 18, 14, 30, 13, 565927, tzinfo=datetime.timezone.utc), 'updated_at': datetime.datetime(2025, 12, 18, 14, 30, 13, 565931, tzinfo=datetime.timezone.utc)}]
E   (Background on this error at: https://sqlalche.me/e/20/f405)
_______________ TestCrearRetiro.test_crear_retiro_ambas_monedas ________________
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: in do_execute
    cursor.execute(statement, parameters)
E   psycopg2.errors.UndefinedTable: relation "operaciones" does not exist
E   LINE 1: INSERT INTO operaciones (id, tipo_operacion, fecha, monto_or...
E                       ^

The above exception was the direct cause of the following exception:
tests/test_operacion_service.py:389: in test_crear_retiro_ambas_monedas
    operacion = crear_retiro(db_session, data)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
app/services/operacion_service.py:118: in crear_retiro
    db.commit()
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2028: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py:139: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:1313: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py:139: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:1288: in _prepare_impl
    self.session.flush()
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:4352: in flush
    self._flush(objects)
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:4487: in _flush
    with util.safe_reraise():
venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:146: in __exit__
    raise exc_value.with_traceback(exc_tb)
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:4448: in _flush
    flush_context.execute()
venv/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
venv/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
venv/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
venv/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1418: in execute
    return meth(
venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:515: in _execute_on_connection
    return connection._execute_clauseelement(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1640: in _execute_clauseelement
    ret = self._execute_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "operaciones" does not exist
E   LINE 1: INSERT INTO operaciones (id, tipo_operacion, fecha, monto_or...
E                       ^
E   
E   [SQL: INSERT INTO operaciones (id, tipo_operacion, fecha, monto_original, moneda_original, tipo_cambio, monto_uyu, monto_usd, area_id, localidad, descripcion, cliente, proveedor, deleted_at, created_at, updated_at) VALUES (%(id)s::UUID, %(tipo_operacion)s, %(fecha)s, %(monto_original)s, %(moneda_original)s, %(tipo_cambio)s, %(monto_uyu)s, %(monto_usd)s, %(area_id)s::UUID, %(localidad)s, %(descripcion)s, %(cliente)s, %(proveedor)s, %(deleted_at)s, %(created_at)s, %(updated_at)s)]
E   [parameters: {'id': UUID('e6c955c9-f50e-459b-a751-0623b2d9d9af'), 'tipo_operacion': 'RETIRO', 'fecha': datetime.date(2025, 12, 18), 'monto_original': Decimal('12000'), 'moneda_original': 'UYU', 'tipo_cambio': Decimal('40.00'), 'monto_uyu': Decimal('12000'), 'monto_usd': Decimal('300'), 'area_id': None, 'localidad': 'MONTEVIDEO', 'descripcion': 'Retiro mixto', 'cliente': None, 'proveedor': None, 'deleted_at': None, 'created_at': datetime.datetime(2025, 12, 18, 14, 30, 13, 889545, tzinfo=datetime.timezone.utc), 'updated_at': datetime.datetime(2025, 12, 18, 14, 30, 13, 889548, tzinfo=datetime.timezone.utc)}]
E   (Background on this error at: https://sqlalche.me/e/20/f405)
______________ TestCrearRetiro.test_crear_retiro_no_requiere_area ______________
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: in do_execute
    cursor.execute(statement, parameters)
E   psycopg2.errors.UndefinedTable: relation "operaciones" does not exist
E   LINE 1: INSERT INTO operaciones (id, tipo_operacion, fecha, monto_or...
E                       ^

The above exception was the direct cause of the following exception:
tests/test_operacion_service.py:410: in test_crear_retiro_no_requiere_area
    operacion = crear_retiro(db_session, data)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
app/services/operacion_service.py:118: in crear_retiro
    db.commit()
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2028: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py:139: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:1313: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py:139: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:1288: in _prepare_impl
    self.session.flush()
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:4352: in flush
    self._flush(objects)
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:4487: in _flush
    with util.safe_reraise():
venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:146: in __exit__
    raise exc_value.with_traceback(exc_tb)
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:4448: in _flush
    flush_context.execute()
venv/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
venv/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
venv/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
venv/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1418: in execute
    return meth(
venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:515: in _execute_on_connection
    return connection._execute_clauseelement(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1640: in _execute_clauseelement
    ret = self._execute_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "operaciones" does not exist
E   LINE 1: INSERT INTO operaciones (id, tipo_operacion, fecha, monto_or...
E                       ^
E   
E   [SQL: INSERT INTO operaciones (id, tipo_operacion, fecha, monto_original, moneda_original, tipo_cambio, monto_uyu, monto_usd, area_id, localidad, descripcion, cliente, proveedor, deleted_at, created_at, updated_at) VALUES (%(id)s::UUID, %(tipo_operacion)s, %(fecha)s, %(monto_original)s, %(moneda_original)s, %(tipo_cambio)s, %(monto_uyu)s, %(monto_usd)s, %(area_id)s::UUID, %(localidad)s, %(descripcion)s, %(cliente)s, %(proveedor)s, %(deleted_at)s, %(created_at)s, %(updated_at)s)]
E   [parameters: {'id': UUID('17692775-03b2-4c3c-a8f1-b3c5aaec1d61'), 'tipo_operacion': 'RETIRO', 'fecha': datetime.date(2025, 12, 18), 'monto_original': Decimal('5000'), 'moneda_original': 'UYU', 'tipo_cambio': Decimal('40.00'), 'monto_uyu': Decimal('5000'), 'monto_usd': Decimal('125'), 'area_id': None, 'localidad': 'MONTEVIDEO', 'descripcion': 'Test', 'cliente': None, 'proveedor': None, 'deleted_at': None, 'created_at': datetime.datetime(2025, 12, 18, 14, 30, 14, 217219, tzinfo=datetime.timezone.utc), 'updated_at': datetime.datetime(2025, 12, 18, 14, 30, 14, 217223, tzinfo=datetime.timezone.utc)}]
E   (Background on this error at: https://sqlalche.me/e/20/f405)
________ TestFiltrosPorLocalidadArea.test_filtrar_operaciones_por_area _________
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: in do_execute
    cursor.execute(statement, parameters)
E   psycopg2.errors.UndefinedTable: relation "areas" does not exist
E   LINE 2: FROM areas 
E                ^

The above exception was the direct cause of the following exception:
tests/test_operacion_service.py:739: in test_filtrar_operaciones_por_area
    area1 = db_session.query(Area).filter(Area.nombre == "Jurídica").first()
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2728: in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2827: in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2362: in execute
    return self._execute_internal(
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2247: in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py:305: in orm_execute_statement
    result = conn.execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1418: in execute
    return meth(
venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:515: in _execute_on_connection
    return connection._execute_clauseelement(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1640: in _execute_clauseelement
    ret = self._execute_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:941: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "areas" does not exist
E   LINE 2: FROM areas 
E                ^
E   
E   [SQL: SELECT areas.id AS areas_id, areas.nombre AS areas_nombre, areas.descripcion AS areas_descripcion, areas.activo AS areas_activo, areas.created_at AS areas_created_at, areas.updated_at AS areas_updated_at 
E   FROM areas 
E   WHERE areas.nombre = %(nombre_1)s 
E    LIMIT %(param_1)s]
E   [parameters: {'nombre_1': 'Jurídica', 'param_1': 1}]
E   (Background on this error at: https://sqlalche.me/e/20/f405)
______ TestCreateAccessToken.test_create_access_token_expiracion_correcta ______
tests/test_security.py:252: in test_create_access_token_expiracion_correcta
    diferencia = exp_datetime - ahora
                 ^^^^^^^^^^^^^^^^^^^^
E   TypeError: can't subtract offset-naive and offset-aware datetimes
__________ TestFuncionesGlobales.test_generar_sql_inteligente_wrapper __________
/usr/lib/python3.12/unittest/mock.py:944: in assert_called_with
    raise AssertionError(_error_message()) from cause
E   AssertionError: expected call not found.
E   Expected: generar_sql_inteligente('Test')
E     Actual: generar_sql_inteligente('Test', contexto=None)

During handling of the above exception, another exception occurred:
/usr/lib/python3.12/unittest/mock.py:956: in assert_called_once_with
    return self.assert_called_with(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   AssertionError: expected call not found.
E   Expected: generar_sql_inteligente('Test')
E     Actual: generar_sql_inteligente('Test', contexto=None)
E   
E   pytest introspection follows:
E   
E   Kwargs:
E   assert {'contexto': None} == {}
E     
E     Left contains 1 more item:
E     {'contexto': None}
E     
E     Full diff:
E     - {}
E     + {
E     +     'contexto': None,
E     + }

During handling of the above exception, another exception occurred:
tests/test_sql_router.py:512: in test_generar_sql_inteligente_wrapper
    mock_router.generar_sql_inteligente.assert_called_once_with(pregunta)
E   AssertionError: expected call not found.
E   Expected: generar_sql_inteligente('Test')
E     Actual: generar_sql_inteligente('Test', contexto=None)
E   
E   pytest introspection follows:
E   
E   Kwargs:
E   assert {'contexto': None} == {}
E     
E     Left contains 1 more item:
E     {'contexto': None}
E     
E     Full diff:
E     - {}
E     + {
E     +     'contexto': None,
E     + }
=============================== warnings summary ===============================
venv/lib/python3.12/site-packages/pydantic/_internal/_config.py:291: 12 warnings
  /home/brunogandolfo/cfo-inteligente/backend/venv/lib/python3.12/site-packages/pydantic/_internal/_config.py:291: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.9/migration/
    warnings.warn(DEPRECATION_MESSAGE, DeprecationWarning)

app/core/database.py:9
  /home/brunogandolfo/cfo-inteligente/backend/app/core/database.py:9: MovedIn20Warning: The ``declarative_base()`` function is now available as sqlalchemy.orm.declarative_base(). (deprecated since: 2.0) (Background on SQLAlchemy 2.0 at: https://sqlalche.me/e/b8d9)
    Base = declarative_base()

venv/lib/python3.12/site-packages/passlib/utils/__init__.py:854
  /home/brunogandolfo/cfo-inteligente/backend/venv/lib/python3.12/site-packages/passlib/utils/__init__.py:854: DeprecationWarning: 'crypt' is deprecated and slated for removal in Python 3.13
    from crypt import crypt as _crypt

tests/test_e2e.py:69
  /home/brunogandolfo/cfo-inteligente/backend/tests/test_e2e.py:69: PytestUnknownMarkWarning: Unknown pytest.mark.e2e - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.e2e

tests/test_e2e.py:105
  /home/brunogandolfo/cfo-inteligente/backend/tests/test_e2e.py:105: PytestUnknownMarkWarning: Unknown pytest.mark.e2e - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.e2e

tests/test_e2e.py:380
  /home/brunogandolfo/cfo-inteligente/backend/tests/test_e2e.py:380: PytestUnknownMarkWarning: Unknown pytest.mark.e2e - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.e2e

tests/test_security.py::TestCreateAccessToken::test_create_access_token_contiene_datos
tests/test_security.py::TestCreateAccessToken::test_create_access_token_contiene_exp
tests/test_security.py::TestCreateAccessToken::test_create_access_token_expiracion_correcta
  /home/brunogandolfo/cfo-inteligente/backend/venv/lib/python3.12/site-packages/jose/jwt.py:311: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    now = timegm(datetime.utcnow().utctimetuple())

tests/test_security.py::TestCreateAccessToken::test_create_access_token_expiracion_correcta
  /home/brunogandolfo/cfo-inteligente/backend/tests/test_security.py:251: DeprecationWarning: datetime.datetime.utcfromtimestamp() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.fromtimestamp(timestamp, datetime.UTC).
    exp_datetime = datetime.utcfromtimestamp(decoded["exp"])

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
FAILED tests/test_ai_components.py::test_fallback_estrategico_genera_insights
FAILED tests/test_ai_components.py::test_fallback_estrategico_identifica_disparidad
FAILED tests/test_auth_endpoints.py::TestRegister::test_register_exitoso_crea_usuario
FAILED tests/test_auth_endpoints.py::TestRegister::test_register_email_duplicado_retorna_400
FAILED tests/test_auth_endpoints.py::TestRegister::test_register_asigna_rol_socio_si_email_autorizado
FAILED tests/test_auth_endpoints.py::TestRegister::test_register_asigna_rol_colaborador_si_email_no_autorizado
FAILED tests/test_auth_endpoints.py::TestRegister::test_register_password_se_hashea
FAILED tests/test_auth_endpoints.py::TestRegister::test_register_usuario_activo_por_defecto
FAILED tests/test_auth_endpoints.py::TestAuthValidation::test_register_email_invalido_retorna_422
FAILED tests/test_auth_endpoints.py::TestAuthValidation::test_register_sin_nombre_retorna_422
FAILED tests/test_auth_endpoints.py::TestSociosAutorizados::test_todos_los_socios_autorizados_son_socios[aborio]
FAILED tests/test_auth_endpoints.py::TestSociosAutorizados::test_todos_los_socios_autorizados_son_socios[falgorta]
FAILED tests/test_auth_endpoints.py::TestSociosAutorizados::test_todos_los_socios_autorizados_son_socios[vcaresani]
FAILED tests/test_auth_endpoints.py::TestSociosAutorizados::test_todos_los_socios_autorizados_son_socios[gtaborda]
FAILED tests/test_auth_endpoints.py::TestSociosAutorizados::test_prefijo_case_insensitive
FAILED tests/test_claude_sql_generator.py::TestInicializacion::test_init_con_api_key_valida
FAILED tests/test_claude_sql_generator.py::TestInicializacion::test_init_sin_api_key
FAILED tests/test_claude_sql_generator.py::TestInicializacion::test_business_context_con_8_reglas
FAILED tests/test_claude_sql_generator.py::TestGenerarSQL::test_generar_sql_error_api
FAILED tests/test_claude_sql_generator.py::TestGenerarSQL::test_generar_sql_timeout
FAILED tests/test_claude_sql_generator.py::TestGenerarSQL::test_generar_sql_rate_limit
FAILED tests/test_claude_sql_generator.py::TestGenerarSQL::test_generar_sql_parametros_correctos
FAILED tests/test_claude_sql_generator.py::TestContextoYPrompt::test_prompt_incluye_ddl
FAILED tests/test_claude_sql_generator.py::TestContextoYPrompt::test_prompt_incluye_business_context
FAILED tests/test_claude_sql_generator.py::TestContextoYPrompt::test_prompt_incluye_pregunta_usuario
FAILED tests/test_claude_sql_generator.py::TestManejoErrores::test_api_connection_error
FAILED tests/test_claude_sql_generator.py::TestManejoErrores::test_authentication_error
FAILED tests/test_claude_sql_generator.py::TestManejoErrores::test_respuesta_sin_content
FAILED tests/test_integration.py::TestChainOfThoughtIntegration::test_obtener_metadatos_temporales
FAILED tests/test_integration.py::TestChainOfThoughtIntegration::test_generar_con_cot_completo
FAILED tests/test_integration.py::TestEndpointCFOAsk::test_endpoint_pregunta_simple
FAILED tests/test_integration.py::TestEndpointCFOAsk::test_endpoint_pregunta_compleja
FAILED tests/test_integration.py::TestEndpointCFOAsk::test_endpoint_sql_invalido
FAILED tests/test_integration.py::TestEndpointCFOAsk::test_endpoint_formato_response
FAILED tests/test_integration.py::TestSQLRouterIntegration::test_sql_ejecutable_en_bd
FAILED tests/test_integration.py::TestSQLRouterIntegration::test_sql_rentabilidad_ejecutable
FAILED tests/test_integration.py::TestValidadorConDatosReales::test_validar_rentabilidad_real
FAILED tests/test_integration.py::TestValidadorConDatosReales::test_validar_distribuciones_reales
FAILED tests/test_integration.py::TestFlujoCompletoEndToEnd::test_flujo_completo_pregunta_facturacion
FAILED tests/test_integration.py::TestFlujoCompletoEndToEnd::test_flujo_con_validacion_pre_sql
FAILED tests/test_integration.py::TestFlujoCompletoEndToEnd::test_flujo_con_chain_of_thought
FAILED tests/test_integration.py::TestQueriesReales::test_query_conteo_operaciones
FAILED tests/test_integration.py::TestQueriesReales::test_query_sum_ingresos
FAILED tests/test_integration.py::TestQueriesReales::test_query_distribuciones_por_socio
FAILED tests/test_integration.py::TestChainOfThoughtAvanzado::test_proyeccion_fin_año_con_metadatos
FAILED tests/test_integration.py::TestChainOfThoughtAvanzado::test_comparacion_mes_vs_mes
FAILED tests/test_integration.py::TestChainOfThoughtAvanzado::test_tendencia_ultimos_3_meses
FAILED tests/test_integration.py::TestChainOfThoughtAvanzado::test_conversion_moneda_multiple
FAILED tests/test_integration.py::TestChainOfThoughtAvanzado::test_metadatos_fecha_actual_correcta
FAILED tests/test_integration.py::TestChainOfThoughtAvanzado::test_meses_con_datos_dinamico
FAILED tests/test_integration.py::TestChainOfThoughtAvanzado::test_ultimo_mes_con_datos
FAILED tests/test_integration.py::TestValidadorPostSQLReal::test_porcentaje_usd_uyu_real
FAILED tests/test_integration.py::TestValidadorPostSQLReal::test_distribucion_por_socio_real
FAILED tests/test_integration.py::TestCasosCriticos::test_caso_retiros_por_socio
FAILED tests/test_integration.py::TestCasosCriticos::test_caso_comparacion_año_anterior
FAILED tests/test_integration.py::TestCasosCriticos::test_caso_gonzalo_recibe_correcto
FAILED tests/test_integration.py::TestCasosCriticos::test_caso_estamos_creciendo
FAILED tests/test_integration_real.py::TestAuthIntegration::test_registro_y_login_flujo_completo
FAILED tests/test_integration_real.py::TestAuthIntegration::test_registro_socio_autorizado
FAILED tests/test_integration_real.py::TestAuthIntegration::test_registro_colaborador
FAILED tests/test_metrics_aggregator.py::test_aggregator_calcula_todas_metricas
FAILED tests/test_metrics_aggregator.py::test_aggregator_totals_correctos - T...
FAILED tests/test_metrics_aggregator.py::test_aggregator_margen_correcto - Ty...
FAILED tests/test_metrics_aggregator.py::test_aggregator_area_lider - TypeErr...
FAILED tests/test_metrics_aggregator.py::test_aggregator_con_comparacion - Ty...
FAILED tests/test_monthly_aggregator.py::TestMonthlyAggregator::test_aggregate_octubre_2025
FAILED tests/test_monthly_aggregator.py::TestMonthlyAggregator::test_aggregate_con_filtro_localidad
FAILED tests/test_monthly_aggregator.py::TestMonthlyAggregator::test_metricas_por_area_ordenadas
FAILED tests/test_operacion_service.py::TestCrearRetiro::test_crear_retiro_solo_uyu
FAILED tests/test_operacion_service.py::TestCrearRetiro::test_crear_retiro_solo_usd
FAILED tests/test_operacion_service.py::TestCrearRetiro::test_crear_retiro_ambas_monedas
FAILED tests/test_operacion_service.py::TestCrearRetiro::test_crear_retiro_no_requiere_area
FAILED tests/test_operacion_service.py::TestFiltrosPorLocalidadArea::test_filtrar_operaciones_por_area
FAILED tests/test_security.py::TestCreateAccessToken::test_create_access_token_expiracion_correcta
FAILED tests/test_sql_router.py::TestFuncionesGlobales::test_generar_sql_inteligente_wrapper
ERROR tests/test_e2e.py::test_pregunta_real_e2e[\xbfCu\xe1nto facturamos este mes?]
ERROR tests/test_e2e.py::test_pregunta_real_e2e[\xbfC\xf3mo viene la rentabilidad?]
ERROR tests/test_e2e.py::test_pregunta_real_e2e[\xbfCu\xe1l es el margen de este mes?]
ERROR tests/test_e2e.py::test_pregunta_real_e2e[\xbfEstamos mejor que el mes pasado?]
ERROR tests/test_e2e.py::test_pregunta_real_e2e[\xbfC\xf3mo vamos en el a\xf1o?]
ERROR tests/test_e2e.py::test_pregunta_real_e2e[\xbfCu\xe1nto ganamos este trimestre?]
ERROR tests/test_e2e.py::test_pregunta_real_e2e[\xbfCu\xe1l es la rentabilidad del \xe1rea Jur\xeddi]
ERROR tests/test_e2e.py::test_pregunta_real_e2e[\xbfQu\xe9 \xe1rea es m\xe1s rentable?]
ERROR tests/test_e2e.py::test_pregunta_real_e2e[\xbfC\xf3mo est\xe1 la rentabilidad de Notarial?]
ERROR tests/test_e2e.py::test_pregunta_real_e2e[Dame un resumen del mes] - At...
ERROR tests/test_e2e.py::test_pregunta_real_e2e[\xbfCu\xe1l fue el mejor mes del a\xf1o?]
ERROR tests/test_e2e.py::test_pregunta_real_e2e[\xbfVenimos mejorando la rentabilidad?]
ERROR tests/test_e2e.py::test_pregunta_real_e2e[\xbfCu\xe1nto es el resultado operativo?]
ERROR tests/test_e2e.py::test_pregunta_real_e2e[\xbfC\xf3mo viene el margen comparado con el a]
ERROR tests/test_e2e.py::test_pregunta_real_e2e[\xbfProyectamos bien el cierre de a\xf1o?]
ERROR tests/test_e2e.py::test_pregunta_real_e2e[\xbfCu\xe1nto le toca a Bruno este a\xf1o?]
ERROR tests/test_e2e.py::test_pregunta_real_e2e[\xbfCu\xe1nto recibi\xf3 Agustina en distribucion]
ERROR tests/test_e2e.py::test_pregunta_real_e2e[\xbfQu\xe9 socio retir\xf3 m\xe1s plata?]
ERROR tests/test_e2e.py::test_pregunta_real_e2e[\xbfCu\xe1ndo fue la \xfaltima distribuci\xf3n?]
ERROR tests/test_e2e.py::test_pregunta_real_e2e[\xbfCu\xe1nto se distribuy\xf3 este trimestre?]
ERROR tests/test_e2e.py::test_pregunta_real_e2e[\xbfEst\xe1n bien los porcentajes de cada soci]
ERROR tests/test_e2e.py::test_pregunta_real_e2e[\xbfCu\xe1nto llev\xf3 Viviana en el a\xf1o?]
ERROR tests/test_e2e.py::test_pregunta_real_e2e[\xbfQu\xe9 socio tiene m\xe1s retiros?]
ERROR tests/test_e2e.py::test_pregunta_real_e2e[\xbfCu\xe1nto se reparti\xf3 en total?]
ERROR tests/test_e2e.py::test_pregunta_real_e2e[\xbfGonzalo est\xe1 recibiendo lo que correspo]
ERROR tests/test_e2e.py::test_pregunta_real_e2e[\xbfFacturamos m\xe1s este mes que el anterior]
ERROR tests/test_e2e.py::test_pregunta_real_e2e[\xbfC\xf3mo se compara este trimestre con el p]
ERROR tests/test_e2e.py::test_pregunta_real_e2e[\xbfEstamos creciendo o bajando?]
ERROR tests/test_e2e.py::test_pregunta_real_e2e[\xbfQu\xe9 trimestre fue mejor?]
ERROR tests/test_e2e.py::test_pregunta_real_e2e[\xbfC\xf3mo va octubre comparado con septiembr]
ERROR tests/test_e2e.py::test_pregunta_real_e2e[\xbfMejoramos respecto al a\xf1o pasado?]
ERROR tests/test_e2e.py::test_pregunta_real_e2e[\xbfCu\xe1l fue el peor mes?]
ERROR tests/test_e2e.py::test_pregunta_real_e2e[\xbfLa tendencia es positiva o negativa?]
ERROR tests/test_e2e.py::test_pregunta_real_e2e[\xbfEstamos en alza o en baja?]
ERROR tests/test_e2e.py::test_pregunta_real_e2e[\xbfC\xf3mo viene la facturaci\xf3n mes a mes?]
ERROR tests/test_e2e.py::test_pregunta_real_e2e[\xbfCu\xe1nto facturamos en d\xf3lares este mes?]
ERROR tests/test_e2e.py::test_pregunta_real_e2e[\xbfCu\xe1nto gastamos en pesos?]
ERROR tests/test_e2e.py::test_pregunta_real_e2e[\xbfQu\xe9 porcentaje de facturaci\xf3n es en USD]
ERROR tests/test_e2e.py::test_pregunta_real_e2e[\xbfCu\xe1nto se distribuy\xf3 en d\xf3lares?]
ERROR tests/test_e2e.py::test_pregunta_real_e2e[\xbfOperamos m\xe1s en pesos o d\xf3lares?]
ERROR tests/test_e2e.py::test_pregunta_real_e2e[\xbfCu\xe1l es el tipo de cambio promedio que ]
ERROR tests/test_e2e.py::test_pregunta_real_e2e[\xbfQu\xe9 \xe1rea factura m\xe1s en d\xf3lares?]
ERROR tests/test_e2e.py::test_pregunta_real_e2e[\xbfCu\xe1nto es todo en d\xf3lares?]
ERROR tests/test_e2e.py::test_pregunta_real_e2e[\xbfQu\xe9 \xe1rea genera m\xe1s ingresos?]
ERROR tests/test_e2e.py::test_pregunta_real_e2e[\xbfCu\xe1nto factura Montevideo vs Mercedes?]
ERROR tests/test_e2e.py::test_pregunta_real_e2e[\xbfQu\xe9 oficina es m\xe1s rentable?]
ERROR tests/test_e2e.py::test_pregunta_real_e2e[\xbfC\xf3mo est\xe1 Mercedes este mes?]
ERROR tests/test_e2e.py::test_pregunta_real_e2e[\xbfCu\xe1nto gast\xf3 Contable?]
ERROR tests/test_e2e.py::test_pregunta_real_e2e[\xbfQu\xe9 \xe1rea tiene m\xe1s gastos?]
ERROR tests/test_e2e.py::test_pregunta_real_e2e[\xbfCu\xe1l es la facturaci\xf3n de cada \xe1rea?]
ERROR tests/test_e2e.py::TestMetricasPrecision::test_tasa_respuesta_exitosa
ERROR tests/test_e2e.py::TestMetricasPrecision::test_metadata_presente_en_exitosas
ERROR tests/test_e2e.py::TestMetricasPrecision::test_tiempo_respuesta_razonable
ERROR tests/test_integration_real.py::TestOperacionesIntegration::test_crear_ingreso_completo
ERROR tests/test_integration_real.py::TestOperacionesIntegration::test_crear_gasto_completo
ERROR tests/test_integration_real.py::TestOperacionesIntegration::test_crear_retiro_completo
ERROR tests/test_integration_real.py::TestOperacionesIntegration::test_operacion_calcula_monto_usd_correctamente
ERROR tests/test_integration_real.py::TestOperacionesIntegration::test_listar_operaciones_con_filtros
ERROR tests/test_integration_real.py::TestCFOAIIntegration::test_pregunta_simple_retorna_respuesta
ERROR tests/test_integration_real.py::TestCFOAIIntegration::test_pregunta_genera_sql_valido
ERROR tests/test_integration_real.py::TestDatosConsistencia::test_soft_delete_operacion
ERROR tests/test_integration_real.py::TestDatosConsistencia::test_relacion_operacion_area
ERROR tests/test_operacion_service.py::TestCrearOperacionBase::test_crear_operacion_base_ingreso
ERROR tests/test_operacion_service.py::TestCrearOperacionBase::test_crear_operacion_base_gasto
ERROR tests/test_operacion_service.py::TestCrearOperacionBase::test_crear_operacion_base_localidad_normalizada
ERROR tests/test_operacion_service.py::TestCrearIngreso::test_crear_ingreso_uyu
ERROR tests/test_operacion_service.py::TestCrearIngreso::test_crear_ingreso_usd
ERROR tests/test_operacion_service.py::TestCrearGasto::test_crear_gasto_uyu
ERROR tests/test_operacion_service.py::TestCrearGasto::test_crear_gasto_usd
ERROR tests/test_operacion_service.py::TestCrearDistribucion::test_crear_distribucion_5_socios_completa
ERROR tests/test_operacion_service.py::TestCrearDistribucion::test_crear_distribucion_parcial_3_socios
ERROR tests/test_operacion_service.py::TestCrearDistribucion::test_crear_distribucion_detecta_moneda_original
ERROR tests/test_operacion_service.py::TestCrearDistribucion::test_crear_distribucion_no_requiere_area
ERROR tests/test_operacion_service.py::TestCrearDistribucion::test_crear_distribucion_porcentaje_20
ERROR tests/test_operacion_service.py::TestCasosEdge::test_crear_ingreso_sin_cliente
ERROR tests/test_operacion_service.py::TestFiltrosPorLocalidadArea::test_crear_operaciones_diferentes_localidades
= 75 failed, 398 passed, 8 xfailed, 3 xpassed, 21 warnings, 76 errors in 68.40s (0:01:08) =
