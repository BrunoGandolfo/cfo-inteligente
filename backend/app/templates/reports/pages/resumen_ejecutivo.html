{# Página 2: Resumen Ejecutivo - Big 4 Professional Layout #}
{% include 'reports/components/header.html' %}

<section class="page resumen-ejecutivo">
    <h2 class="section-title">Resumen Ejecutivo</h2>
    
    {# ═══════════════════════════════════════════════════════════════
       FILA DE KPIs PRINCIPALES - 4 cards
       ═══════════════════════════════════════════════════════════════ #}
    <div class="kpi-row">
        <div class="kpi-card">
            <div class="kpi-value">{{ ingresos_uyu | format_currency }}</div>
            <div class="kpi-label">Ingresos</div>
            {% if variacion_mom_ingresos %}
            <div class="kpi-change {% if variacion_mom_ingresos > 0 %}positive{% else %}negative{% endif %}">
                {% if variacion_mom_ingresos > 0 %}+{% endif %}{{ variacion_mom_ingresos | format_percentage }} vs anterior
            </div>
            {% endif %}
        </div>
        <div class="kpi-card">
            <div class="kpi-value">{{ rentabilidad_neta | format_percentage }}</div>
            <div class="kpi-label">Rentabilidad Neta</div>
            {% if variacion_mom_rentabilidad %}
            <div class="kpi-change {% if variacion_mom_rentabilidad > 0 %}positive{% else %}negative{% endif %}">
                {% if variacion_mom_rentabilidad > 0 %}+{% endif %}{{ variacion_mom_rentabilidad | format_percentage(include_symbol=False) }}pp vs anterior
            </div>
            {% endif %}
        </div>
        <div class="kpi-card">
            <div class="kpi-value">{{ utilidad_neta_uyu | format_currency }}</div>
            <div class="kpi-label">Utilidad Neta</div>
        </div>
        <div class="kpi-card">
            <div class="kpi-value">{{ cantidad_operaciones | default(0) }}</div>
            <div class="kpi-label">Operaciones</div>
        </div>
    </div>
    
    {# ═══════════════════════════════════════════════════════════════
       SÍNTESIS NARRATIVA
       ═══════════════════════════════════════════════════════════════ #}
    <div class="executive-summary-text">
        <p>
            {% if narrativa_resumen %}
            {{ narrativa_resumen }}
            {% else %}
            Durante el período <strong>{{ period_label }}</strong>, la empresa registró ingresos por 
            <strong>{{ ingresos_uyu | format_currency }}</strong> con una rentabilidad neta de 
            <strong>{{ rentabilidad_neta | format_percentage }}</strong>. 
            {% if utilidad_neta_uyu > 0 %}
            El resultado neto fue positivo con una utilidad de <strong>{{ utilidad_neta_uyu | format_currency }}</strong>.
            {% else %}
            El resultado neto fue negativo, requiriendo análisis de estructura de costos.
            {% endif %}
            {% if area_lider and area_lider.nombre %}
            El área <strong>{{ area_lider.nombre }}</strong> lideró la facturación con 
            <strong>{{ area_lider.porcentaje | format_percentage }}</strong> del total.
            {% endif %}
            {% endif %}
        </p>
    </div>
    
    {# ═══════════════════════════════════════════════════════════════
       HIGHLIGHTS DEL PERÍODO
       ═══════════════════════════════════════════════════════════════ #}
    <div class="highlights-section">
        <h3 class="section-subtitle">Highlights del Período</h3>
        <table class="highlights-table">
            {% if area_lider and area_lider.nombre %}
            <tr>
                <td class="highlight-label">Área líder</td>
                <td class="highlight-value">{{ area_lider.nombre }} ({{ area_lider.porcentaje | format_percentage }})</td>
            </tr>
            {% endif %}
            {% if variacion_yoy_ingresos %}
            <tr>
                <td class="highlight-label">Crecimiento YoY</td>
                <td class="highlight-value">
                    <span class="{% if variacion_yoy_ingresos > 0 %}positive{% else %}negative{% endif %}">
                        {% if variacion_yoy_ingresos > 0 %}+{% endif %}{{ variacion_yoy_ingresos | format_percentage }}
                    </span>
                </td>
            </tr>
            {% endif %}
            <tr>
                <td class="highlight-label">Ticket promedio</td>
                <td class="highlight-value">{{ ticket_promedio_ingreso | format_currency if ticket_promedio_ingreso else 'N/A' }}</td>
            </tr>
            <tr>
                <td class="highlight-label">Gastos operativos</td>
                <td class="highlight-value">{{ gastos_uyu | format_currency }}</td>
            </tr>
            <tr>
                <td class="highlight-label">Estado general</td>
                <td class="highlight-value">
                    {% if rentabilidad_neta >= 30 %}
                    <span class="badge badge-success">Excelente</span>
                    {% elif rentabilidad_neta >= 15 %}
                    <span class="badge badge-success">Saludable</span>
                    {% elif rentabilidad_neta >= 0 %}
                    <span class="badge badge-warning">Moderado</span>
                    {% else %}
                    <span class="badge badge-danger">Requiere Atención</span>
                    {% endif %}
                </td>
            </tr>
        </table>
    </div>
    
    {# ═══════════════════════════════════════════════════════════════
       COMPARACIÓN CON PERÍODO ANTERIOR (si disponible)
       ═══════════════════════════════════════════════════════════════ #}
    {% if tiene_comparacion %}
    <div class="comparison-section">
        <h3 class="section-subtitle">Comparación con Período Anterior</h3>
        
        <table class="comparison-table">
            <thead>
                <tr>
                    <th>Métrica</th>
                    <th class="text-right">Período Anterior</th>
                    <th class="text-right">Período Actual</th>
                    <th class="text-center">Variación</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Ingresos</td>
                    <td class="text-right">{{ (ingresos_uyu / (1 + variacion_mom_ingresos/100)) | format_currency if variacion_mom_ingresos else '—' }}</td>
                    <td class="text-right"><strong>{{ ingresos_uyu | format_currency }}</strong></td>
                    <td class="text-center">
                        {% if variacion_mom_ingresos %}
                        <span class="{% if variacion_mom_ingresos > 0 %}positive{% else %}negative{% endif %}">
                            {% if variacion_mom_ingresos > 0 %}+{% endif %}{{ variacion_mom_ingresos | format_percentage }}
                        </span>
                        {% else %}—{% endif %}
                    </td>
                </tr>
                <tr>
                    <td>Gastos</td>
                    <td class="text-right">{{ (gastos_uyu / (1 + variacion_mom_gastos/100)) | format_currency if variacion_mom_gastos else '—' }}</td>
                    <td class="text-right"><strong>{{ gastos_uyu | format_currency }}</strong></td>
                    <td class="text-center">
                        {% if variacion_mom_gastos %}
                        <span class="{% if variacion_mom_gastos < 0 %}positive{% else %}negative{% endif %}">
                            {% if variacion_mom_gastos > 0 %}+{% endif %}{{ variacion_mom_gastos | format_percentage }}
                        </span>
                        {% else %}—{% endif %}
                    </td>
                </tr>
                <tr>
                    <td>Rentabilidad Neta</td>
                    <td class="text-right">{{ (rentabilidad_neta - variacion_mom_rentabilidad) | format_percentage if variacion_mom_rentabilidad else '—' }}</td>
                    <td class="text-right"><strong>{{ rentabilidad_neta | format_percentage }}</strong></td>
                    <td class="text-center">
                        {% if variacion_mom_rentabilidad %}
                        <span class="{% if variacion_mom_rentabilidad > 0 %}positive{% else %}negative{% endif %}">
                            {% if variacion_mom_rentabilidad > 0 %}+{% endif %}{{ variacion_mom_rentabilidad | format_percentage(include_symbol=False) }}pp
                        </span>
                        {% else %}—{% endif %}
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
    {% endif %}
    
    {# ═══════════════════════════════════════════════════════════════
       COMPARACIONES YoY y QoQ (si disponibles)
       ═══════════════════════════════════════════════════════════════ #}
    {% if variacion_yoy_ingresos or variacion_qoq_ingresos %}
    <div class="annual-quarterly-section">
        <div class="row">
            {% if variacion_yoy_ingresos %}
            <div class="col-6">
                <div class="card yoy-card">
                    <h4>Year-over-Year (YoY)</h4>
                    <table>
                        <tr>
                            <td>Ingresos</td>
                            <td class="text-right">
                                <span class="{% if variacion_yoy_ingresos > 0 %}positive{% else %}negative{% endif %}">
                                    {% if variacion_yoy_ingresos > 0 %}+{% endif %}{{ variacion_yoy_ingresos | format_percentage }}
                                </span>
                            </td>
                        </tr>
                        {% if variacion_yoy_gastos %}
                        <tr>
                            <td>Gastos</td>
                            <td class="text-right">
                                <span class="{% if variacion_yoy_gastos < 0 %}positive{% else %}negative{% endif %}">
                                    {% if variacion_yoy_gastos > 0 %}+{% endif %}{{ variacion_yoy_gastos | format_percentage }}
                                </span>
                            </td>
                        </tr>
                        {% endif %}
                    </table>
                </div>
            </div>
            {% endif %}
            
            {% if variacion_qoq_ingresos %}
            <div class="col-6">
                <div class="card qoq-card">
                    <h4>Quarter-over-Quarter (QoQ)</h4>
                    <table>
                        <tr>
                            <td>Ingresos</td>
                            <td class="text-right">
                                <span class="{% if variacion_qoq_ingresos > 0 %}positive{% else %}negative{% endif %}">
                                    {% if variacion_qoq_ingresos > 0 %}+{% endif %}{{ variacion_qoq_ingresos | format_percentage }}
                                </span>
                            </td>
                        </tr>
                    </table>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
    {% endif %}
</section>

<style>
/* ═══════════════════════════════════════════════════════════════
   ESTILOS RESUMEN EJECUTIVO - Big 4 Professional
   ═══════════════════════════════════════════════════════════════ */

.kpi-row {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 20px;
    margin-bottom: 32px;
}

.kpi-card {
    background: #F9FAFB;
    border: 1px solid #E5E7EB;
    border-radius: 8px;
    padding: 20px;
    text-align: center;
}

.kpi-value {
    font-size: 24pt;
    font-weight: 700;
    color: #1E3A5F;
    line-height: 1.2;
}

.kpi-label {
    font-size: 10pt;
    color: #6B7280;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-top: 8px;
}

.kpi-change {
    font-size: 9pt;
    margin-top: 6px;
    font-weight: 500;
}

.kpi-change.positive { color: #047857; }
.kpi-change.negative { color: #B91C1C; }

.executive-summary-text {
    background: #FEFCE8;
    border-left: 4px solid #B45309;
    padding: 20px;
    margin-bottom: 32px;
    font-size: 12pt;
    line-height: 1.6;
}

.highlights-section {
    margin-bottom: 32px;
}

.highlights-table {
    width: 60%;
}

.highlights-table td {
    padding: 10px 16px;
    border-bottom: 1px solid #E5E7EB;
}

.highlight-label {
    color: #6B7280;
    font-weight: 500;
    width: 40%;
}

.highlight-value {
    text-align: right;
    font-weight: 600;
    color: #1E3A5F;
}

.comparison-section {
    margin-top: 32px;
    margin-bottom: 32px;
}

.comparison-table {
    width: 100%;
}

.comparison-table thead {
    background: #1E3A5F;
    color: white;
}

.comparison-table th {
    padding: 14px 16px;
    font-weight: 600;
    color: white;
}

.annual-quarterly-section {
    margin-top: 24px;
}

.yoy-card {
    background: #F0FDF4;
    border-left: 4px solid #047857;
}

.qoq-card {
    background: #EFF6FF;
    border-left: 4px solid #1E3A5F;
}

.yoy-card h4, .qoq-card h4 {
    font-size: 14pt;
    font-weight: 600;
    margin-bottom: 12px;
    color: #1E3A5F;
}

.positive { color: #047857; font-weight: 600; }
.negative { color: #B91C1C; font-weight: 600; }
</style>

<div class="page-break"></div>
