{# Página: Top 10 Clientes por Facturación #}
{% include 'reports/components/header.html' %}

<div class="section">
    <h2 class="section-title">Top 10 Clientes por Facturación</h2>
    
    <p class="mb-20 text-muted">
        Los siguientes clientes representan la mayor fuente de ingresos del período analizado.
    </p>

    {# Tabla Top 10 #}
    {% if top_clientes %}
    <table>
        <thead>
            <tr>
                <th style="width: 50px;">#</th>
                <th>Cliente</th>
                <th class="text-right">Facturación</th>
                <th class="text-right">% del Total</th>
                <th>Área Principal</th>
            </tr>
        </thead>
        <tbody>
            {% for cliente in top_clientes[:10] %}
            <tr>
                <td class="text-center font-bold" style="color: var(--primary);">{{ loop.index }}</td>
                <td class="font-semibold">{{ cliente.get('cliente', 'N/A') }}</td>
                <td class="text-right">{{ cliente.get('facturacion', 0) | format_currency }}</td>
                <td class="text-right">{{ cliente.get('porcentaje', 0) | format_percentage }}</td>
                <td>{{ cliente.get('area_principal', 'N/A') }}</td>
            </tr>
            {% endfor %}
        </tbody>
        <tfoot>
            <tr style="background: var(--gray-100); font-weight: bold;">
                <td colspan="2">Total Top 10</td>
                <td class="text-right">
                    {{ (top_clientes[:10] | sum(attribute='facturacion')) | format_currency }}
                </td>
                <td class="text-right">
                    {{ (top_clientes[:10] | sum(attribute='porcentaje')) | format_percentage }}
                </td>
                <td></td>
            </tr>
        </tfoot>
    </table>
    {% else %}
    <div class="card text-center" style="padding: 40px;">
        <p class="text-muted">No hay datos de clientes disponibles.</p>
    </div>
    {% endif %}

    {# Gráfico de barras #}
    {% if bar_top_clientes_chart_path %}
    <div class="chart-container mt-30">
        <img src="{{ bar_top_clientes_chart_path }}" alt="Top 10 Clientes" class="chart-image">
    </div>
    {% endif %}
    
    {# Insight #}
    <div class="card mt-20" style="background: linear-gradient(135deg, #F0F9FF 0%, #E0F2FE 100%); border-left: 4px solid var(--primary);">
        <h3 class="section-subtitle">Análisis</h3>
        <p style="line-height: 1.8;">
            Los 10 principales clientes concentran una parte significativa de la facturación total.
            Esta concentración debe monitorearse para gestionar el riesgo de dependencia comercial.
        </p>
    </div>
</div>

<div class="page-break"></div>

