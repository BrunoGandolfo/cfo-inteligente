{# Página: Análisis de Concentración Pareto 80/20 #}
{% include 'reports/components/header.html' %}

<div class="section">
    <h2 class="section-title">Análisis de Concentración (Pareto 80/20)</h2>
    
    <p class="mb-20 text-muted">
        El análisis Pareto identifica qué porcentaje de clientes genera el 80% de los ingresos totales.
    </p>

    {# KPIs de concentración #}
    <div class="row mb-30">
        <div class="col-4">
            <div class="metric-box" style="background: linear-gradient(135deg, var(--primary) 0%, #1E40AF 100%); color: white;">
                <div class="label">Principio Pareto</div>
                <div class="value" style="font-size: 28pt;">
                    {% if analisis_pareto and analisis_pareto.get('porcentaje_clientes_80') %}
                        {{ analisis_pareto.get('porcentaje_clientes_80') | round(1) }}%
                    {% else %}
                        N/A
                    {% endif %}
                </div>
                <div class="sublabel">de clientes generan 80% de ingresos</div>
            </div>
        </div>
        <div class="col-4">
            <div class="metric-box">
                <div class="label">Índice HHI</div>
                <div class="value" style="font-size: 28pt; color: var(--secondary);">
                    {% if indice_hhi and indice_hhi.get('hhi') %}
                        {{ indice_hhi.get('hhi') | round(0) }}
                    {% else %}
                        N/A
                    {% endif %}
                </div>
                <div class="sublabel">
                    {% if indice_hhi and indice_hhi.get('interpretacion') %}
                        {{ indice_hhi.get('interpretacion') }}
                    {% else %}
                        Índice de concentración
                    {% endif %}
                </div>
            </div>
        </div>
        <div class="col-4">
            <div class="metric-box">
                <div class="label">Cliente Líder</div>
                <div class="value" style="font-size: 28pt; color: var(--success);">
                    {% if top_clientes and top_clientes|length > 0 %}
                        {{ top_clientes[0].get('porcentaje', 0) | format_percentage }}
                    {% else %}
                        N/A
                    {% endif %}
                </div>
                <div class="sublabel">del total de ingresos</div>
            </div>
        </div>
    </div>

    {# Gráfico Pareto - ELIMINADO temporalmente (requiere datos adicionales) #}
    {# {% if pareto_clientes_chart_path %}
    <div class="chart-container mb-30">
        <img src="{{ pareto_clientes_chart_path }}" alt="Análisis Pareto 80/20" class="chart-image">
    </div>
    {% endif %} #}

    {# Interpretación del HHI #}
    <div class="card" style="background: linear-gradient(135deg, #F0FDF4 0%, #DCFCE7 100%); border-left: 4px solid var(--success);">
        <h3 class="section-subtitle">Interpretación del Índice HHI (Herfindahl-Hirschman)</h3>
        <table style="width: 100%; margin-top: 15px;">
            <thead>
                <tr style="background: rgba(0,0,0,0.05);">
                    <th>Rango HHI</th>
                    <th>Interpretación</th>
                    <th>Riesgo</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td class="font-semibold">HHI < 1500</td>
                    <td>Cartera diversificada</td>
                    <td><span class="badge badge-success">✅ Bajo</span></td>
                </tr>
                <tr>
                    <td class="font-semibold">HHI 1500-2500</td>
                    <td>Concentración moderada</td>
                    <td><span class="badge badge-warning">⚠️ Moderado</span></td>
                </tr>
                <tr>
                    <td class="font-semibold">HHI > 2500</td>
                    <td>Alta concentración</td>
                    <td><span class="badge badge-danger">❌ Alto</span></td>
                </tr>
            </tbody>
        </table>
    </div>

    {# Recomendación #}
    <div class="card mt-20" style="border-left: 4px solid var(--primary);">
        <h3 class="section-subtitle">Recomendación</h3>
        <p style="line-height: 1.8;">
            {% if indice_hhi and indice_hhi.get('hhi') and indice_hhi.get('hhi') > 2500 %}
                Su cartera presenta <strong>alta concentración</strong>. Se recomienda:
                <ul style="margin-left: 20px; margin-top: 10px;">
                    <li>Desarrollar estrategias de diversificación de clientes</li>
                    <li>Establecer planes de fidelización para clientes clave</li>
                    <li>Identificar nuevos segmentos de mercado</li>
                </ul>
            {% elif indice_hhi and indice_hhi.get('hhi') and indice_hhi.get('hhi') > 1500 %}
                Su cartera presenta <strong>concentración moderada</strong>. Se recomienda:
                <ul style="margin-left: 20px; margin-top: 10px;">
                    <li>Monitorear la dependencia de clientes principales</li>
                    <li>Continuar con esfuerzos de diversificación</li>
                </ul>
            {% else %}
                Su cartera está <strong>bien diversificada</strong>. Mantener estrategias actuales.
            {% endif %}
        </p>
    </div>
</div>

<div class="page-break"></div>

