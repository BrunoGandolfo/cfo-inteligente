{# Página 3: Métricas Principales #}
{% include 'reports/components/header.html' %}

<div class="section">
    <h2 class="section-title">Métricas Principales</h2>
    
    {# Tabla de KPIs con fallback #}
    {% if kpis and kpis|length > 0 %}
    {% include 'reports/components/kpi_table.html' %}
    {% else %}
    <div class="card" style="background: #FEF3C7; border-left: 4px solid #F59E0B; padding: 20px; margin-bottom: 20px;">
        <p style="color: #92400E; margin: 0;"><strong>ATENCIÓN: Datos de KPIs no disponibles</strong> - Verificar período seleccionado</p>
    </div>
    {% endif %}
    
    {# Gráfico de waterfall con fallback #}
    {% if waterfall_chart_path %}
    {% set title = 'Flujo de Rentabilidad' %}
    {% set chart_path = waterfall_chart_path %}
    {% set description = 'Evolución desde ingresos hasta resultado neto' %}
    {% include 'reports/components/chart.html' %}
    {% else %}
    <div class="card" style="background: #FEE2E2; border-left: 4px solid #EF4444; padding: 20px;">
        <p style="color: #991B1B; margin: 0;"><strong>ATENCIÓN: Gráfico de flujo no generado</strong> - Verificar log del servidor</p>
    </div>
    {% endif %}
</div>

{# Evolución Temporal - Sección separada para evitar corte #}
{% if line_temporal_chart_path %}
<div class="section" style="page-break-before: always;">
    <h2 class="section-title">Evolución Temporal</h2>
    <p style="color: #6B7280; margin-bottom: 20px;">
        Tendencia de Ingresos, Gastos y Utilidad durante los últimos 12 meses
    </p>
    
    <div class="chart-container">
        <img src="{{ line_temporal_chart_path }}" 
             alt="Evolución Temporal"
             style="width: 95%; max-width: 95%; height: auto;">
    </div>
</div>
<div class="page-break"></div>
{% endif %}

