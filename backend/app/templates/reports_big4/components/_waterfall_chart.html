{# Gráfico cascada SVG: Ingresos → Gastos → Resultado #}
{# Calcular alturas proporcionales basadas en ingresos como referencia (max_height = 120px) #}
{% set max_height = 120 %}
{% set ingresos_height = max_height %}
{% set gastos_height = ((gastos / ingresos * max_height) | round | int) if ingresos > 0 else 0 %}
{% set resultado_height = ((resultado / ingresos * max_height) | round | int) if ingresos > 0 else 0 %}

<svg viewBox="0 0 640 180" class="chart-svg">
    <!-- Barra Ingresos -->
    <rect x="50" y="{{ 150 - ingresos_height }}" width="120" height="{{ ingresos_height }}" fill="#1a2b4a"/>
    <text x="110" y="{{ 150 - ingresos_height - 8 }}" text-anchor="middle" class="chart-label" fill="#1a2b4a">{{ ingresos | format_currency_short }}</text>
    <text x="110" y="170" text-anchor="middle" class="chart-axis-label">Ingresos</text>
    
    <!-- Barra Gastos (roja, descendente) -->
    <rect x="200" y="{{ 150 - ingresos_height }}" width="120" height="{{ gastos_height }}" fill="#b91c1c"/>
    <text x="260" y="{{ 150 - ingresos_height + gastos_height / 2 + 3 }}" text-anchor="middle" fill="white" class="chart-label">-{{ gastos | format_currency_short }}</text>
    <text x="260" y="170" text-anchor="middle" class="chart-axis-label">Gastos</text>
    
    <!-- Barra Resultado -->
    <rect x="350" y="{{ 150 - resultado_height }}" width="120" height="{{ resultado_height }}" fill="#1e6b4a"/>
    <text x="410" y="{{ 150 - resultado_height - 8 }}" text-anchor="middle" class="chart-label" fill="#1e6b4a">{{ resultado | format_currency_short }}</text>
    <text x="410" y="170" text-anchor="middle" class="chart-axis-label">Resultado</text>
</svg>



